const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./indexeddb-Yp6PkC1q.js","./vendor-idb-Dob3nYDb.js","./module-gl-DpMMjp0h.js","./module-entity-IhVmVdGG.js","./module-job-DtsScTih.js","./module-ap-B_XWtQd0.js","./module-ar-BpiLPgFv.js","./module-payroll-BiNg3vGY.js","./module-union-DwO_sw-X.js","./module-equip-el6caXSc.js","./module-sub-D3FNihgU.js","./module-po-8bdLq1X9.js","./module-reports-LIqWR9hi.js","./module-dashboard-E_rEH6aF.js","./module-estimating-t8Ijix0a.js","./module-doc-DVPWWJ-O.js","./module-import-export-KgoEkhvY.js","./module-auth-CxAPXCJY.js","./module-tenant-BbjS9uG8.js","./module-project-CPE_XAvH.js","./module-change-order-BIKrvmeP.js","./module-service-mgmt-Cy4fj-65.js"])))=>i.map(i=>d[i]);
import{_ as L,g as V}from"./module-gl-DpMMjp0h.js";import{e as W}from"./module-entity-IhVmVdGG.js";import{j as G}from"./module-job-DtsScTih.js";import{a as Q}from"./module-ap-B_XWtQd0.js";import{a as Y}from"./module-ar-BpiLPgFv.js";import{p as Z}from"./module-payroll-BiNg3vGY.js";import{u as X}from"./module-union-DwO_sw-X.js";import{e as ee}from"./module-equip-el6caXSc.js";import{s as te}from"./module-sub-D3FNihgU.js";import{p as ne}from"./module-po-8bdLq1X9.js";import{r as ae}from"./module-reports-LIqWR9hi.js";import{d as re}from"./module-dashboard-E_rEH6aF.js";import{e as ie}from"./module-estimating-t8Ijix0a.js";import{d as oe}from"./module-doc-DVPWWJ-O.js";import{i as le}from"./module-import-export-KgoEkhvY.js";import{a as se}from"./module-auth-CxAPXCJY.js";import{t as ce}from"./module-tenant-BbjS9uG8.js";import{p as de}from"./module-project-CPE_XAvH.js";import{c as ue}from"./module-change-order-BIKrvmeP.js";import{s as me}from"./module-service-mgmt-Cy4fj-65.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(a){if(a.ep)return;a.ep=!0;const r=t(a);fetch(a.href,r)}})();class k{entries=[];maxEntries;minLevel;static LEVELS={debug:0,info:1,warn:2,error:3,fatal:4};constructor(e="info",t=500){this.minLevel=e,this.maxEntries=t}debug(e,t,n){this.log("debug",e,t,n)}info(e,t,n){this.log("info",e,t,n)}warn(e,t,n){this.log("warn",e,t,n)}error(e,t,n){this.log("error",e,t,n)}fatal(e,t,n){this.log("fatal",e,t,n)}log(e,t,n,a){if(k.LEVELS[e]<k.LEVELS[this.minLevel])return;let r;a instanceof Error&&(r=a.stack);const i={level:e,module:t,message:n,data:a instanceof Error?{name:a.name,message:a.message}:a,timestamp:Date.now(),stack:r};this.entries.push(i),this.entries.length>this.maxEntries&&this.entries.splice(0,this.entries.length-this.maxEntries);const o=`[${e.toUpperCase()}][${t}]`;switch(e){case"debug":console.debug(o,n,a??"");break;case"info":console.info(o,n,a??"");break;case"warn":console.warn(o,n,a??"");break;case"error":console.error(o,n,a??"");break;case"fatal":console.error(`${o} FATAL:`,n,a??"");break}}getEntries(e){let t=[...this.entries];if(e?.level){const n=k.LEVELS[e.level];t=t.filter(a=>k.LEVELS[a.level]>=n)}if(e?.module){const n=e.module;t=t.filter(a=>a.module===n)}return e?.limit&&e.limit>0&&(t=t.slice(-e.limit)),t}clear(){this.entries=[]}export(){return[...this.entries]}setLevel(e){this.minLevel=e}getLevel(){return this.minLevel}count(){return this.entries.length}}class pe{logger;installed=!1;toastContainer=null;errorHandler=null;rejectionHandler=null;constructor(e){this.logger=e}install(){this.installed||(this.installed=!0,this.errorHandler=(e,t,n,a,r)=>{const i=r??new Error(typeof e=="string"?e:"Unknown error");return this.logger.error("ErrorBoundary",`Unhandled error: ${i.message}`,{source:t,lineno:n,colno:a,stack:i.stack}),this.showError(i,"Unhandled exception"),!0},window.onerror=this.errorHandler,this.rejectionHandler=e=>{const t=e.reason,n=t instanceof Error?t:new Error(String(t??"Unhandled promise rejection"));this.logger.error("ErrorBoundary",`Unhandled promise rejection: ${n.message}`,{stack:n.stack}),this.showError(n,"Unhandled promise rejection")},window.addEventListener("unhandledrejection",this.rejectionHandler))}uninstall(){this.installed&&(this.installed=!1,window.onerror=null,this.rejectionHandler&&(window.removeEventListener("unhandledrejection",this.rejectionHandler),this.rejectionHandler=null),this.errorHandler=null)}showFatalError(e){this.logger.fatal("ErrorBoundary",`Fatal error: ${e.message}`,e);const n=this.logger.getEntries({limit:50}).map(r=>{const i=new Date(r.timestamp).toISOString(),o=r.data?` | ${JSON.stringify(r.data)}`:"";return`<div style="font-family:monospace;font-size:12px;padding:2px 0;color:${this.getLevelColor(r.level)}">[${i}][${r.level.toUpperCase()}][${r.module}] ${this.escapeHtml(r.message)}${this.escapeHtml(o)}</div>`}).join(""),a=`
      <div style="
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        max-width: 800px;
        margin: 60px auto;
        padding: 40px;
        background: #1a1a2e;
        color: #e0e0e0;
        border-radius: 12px;
        border: 1px solid #333;
      ">
        <h1 style="color: #ff6b6b; margin-top: 0; font-size: 24px;">
          Something went wrong
        </h1>
        <p style="color: #aaa; font-size: 16px; line-height: 1.6;">
          The application encountered a fatal error and cannot continue.
          Please try reloading the page.
        </p>
        <div style="
          background: #0d0d1a;
          border-radius: 8px;
          padding: 16px;
          margin: 20px 0;
          overflow-x: auto;
        ">
          <code style="color: #ff6b6b; font-size: 14px;">
            ${this.escapeHtml(e.message)}
          </code>
          ${e.stack?`<pre style="color: #888; font-size: 12px; margin-top: 8px; white-space: pre-wrap;">${this.escapeHtml(e.stack)}</pre>`:""}
        </div>
        <div style="margin-top: 20px;">
          <button onclick="window.location.reload()" style="
            background: #4a90d9;
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 8px;
          ">
            Reload Application
          </button>
          <button onclick="localStorage.removeItem('concrete_data'); window.location.reload()" style="
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
          ">
            Reset & Reload
          </button>
        </div>
        <details style="margin-top: 30px;">
          <summary style="cursor: pointer; color: #888; font-size: 14px;">
            Diagnostic Logs (last 50 entries)
          </summary>
          <div style="
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
            background: #0d0d1a;
            border-radius: 8px;
            padding: 12px;
          ">
            ${n||'<div style="color:#666;">No log entries available</div>'}
          </div>
        </details>
      </div>
    `;document.body.innerHTML=a}showError(e,t){this.logger.error("ErrorBoundary",t?`${t}: ${e.message}`:e.message,e),this.toastContainer||(this.toastContainer=document.createElement("div"),this.toastContainer.id="concrete-error-toasts",Object.assign(this.toastContainer.style,{position:"fixed",top:"16px",right:"16px",zIndex:"10000",display:"flex",flexDirection:"column",gap:"8px",maxWidth:"420px"}),document.body.appendChild(this.toastContainer));const n=document.createElement("div");Object.assign(n.style,{background:"#2d1b1b",color:"#ff8888",border:"1px solid #ff4444",borderRadius:"8px",padding:"12px 16px",fontSize:"14px",fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",animation:"fadeIn 0.3s ease-out",position:"relative"});const a=t??"Error";n.innerHTML=`
      <div style="font-weight: 600; margin-bottom: 4px;">${this.escapeHtml(a)}</div>
      <div style="color: #cc8888; font-size: 13px;">${this.escapeHtml(e.message)}</div>
      <button style="
        position: absolute;
        top: 8px;
        right: 8px;
        background: none;
        border: none;
        color: #ff8888;
        cursor: pointer;
        font-size: 16px;
        padding: 0;
        line-height: 1;
      " aria-label="Dismiss">&times;</button>
    `;const r=n.querySelector("button");r&&r.addEventListener("click",()=>{this.dismissToast(n)}),this.toastContainer.appendChild(n),setTimeout(()=>{this.dismissToast(n)},8e3)}dismissToast(e){e.parentElement&&(e.style.opacity="0",e.style.transition="opacity 0.3s ease-out",setTimeout(()=>{e.remove(),this.toastContainer&&this.toastContainer.children.length===0&&(this.toastContainer.remove(),this.toastContainer=null)},300))}escapeHtml(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,n=>t[n]??n)}getLevelColor(e){switch(e){case"debug":return"#888";case"info":return"#4a90d9";case"warn":return"#f0ad4e";case"error":return"#ff6b6b";case"fatal":return"#ff0000";default:return"#ccc"}}}class ye{config={};storageKey="concrete_config";events;constructor(e){this.events=e}async load(){const e=localStorage.getItem(this.storageKey);if(e)try{this.config=JSON.parse(e)}catch{this.config=this.getDefaults(),this.persist()}else this.config=this.getDefaults()}get(e,t){const n=e.split(".");let a=this.config;for(const r of n){if(a==null||typeof a!="object")return t;a=a[r]}return a??t}set(e,t){const n=e.split(".");let a=this.config;for(let r=0;r<n.length-1;r++)n[r]in a||(a[n[r]]={}),a=a[n[r]];a[n[n.length-1]]=t,this.persist(),this.events.emit("config.changed",{key:e,value:t})}getAll(){return{...this.config}}reset(){this.config=this.getDefaults(),this.persist()}export(){return JSON.stringify(this.config,null,2)}import(e){this.config=JSON.parse(e),this.persist()}persist(){localStorage.setItem(this.storageKey,JSON.stringify(this.config))}getDefaults(){return{org:{name:"My Company",currency:"USD",fiscalYearStart:1,dateFormat:"MM/DD/YYYY",mode:"full"},locale:"en-US",timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,theme:"dark",features:{intercompanyElimination:!0,budgetTracking:!0,alertsEnabled:!0,fuzzyMatching:!0,anomalyDetection:!1},ui:{sidebarCollapsed:!1,defaultPeriod:"ytd",defaultEntity:"__all__"}}}}class be{config;constructor(e){this.config=e}isEnabled(e){return this.config.get(`features.${e}`,!1)}enable(e){this.config.set(`features.${e}`,!0)}disable(e){this.config.set(`features.${e}`,!1)}toggle(e){const t=this.isEnabled(e);return t?this.disable(e):this.enable(e),!t}getAll(){return{...this.config.get("features",{})}}}class ge{mode;buildTarget;isDev;isProd;isStaging;isStatic;hasBackend;constructor(){this.mode="production",this.buildTarget="static",this.isDev=this.mode==="development",this.isProd=this.mode==="production",this.isStaging=this.mode==="staging",this.isStatic=this.buildTarget==="static",this.hasBackend=this.buildTarget==="cloudflare"||this.buildTarget==="php"}}let B=0;function $(){return B+=1,`listener_${B}`}function O(l,e){if(l==="*")return!0;const n="^"+l.replace(/[.+?^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*")+"$";return new RegExp(n).test(e)}class fe{listeners;history;maxHistory;constructor(e=1e3){this.listeners=new Map,this.history=[],this.maxHistory=e}emit(e,t){this.recordHistory(e,t);const n=this.collectHandlers(e);for(const a of n){try{const r=a.handler(t);r&&typeof r.catch=="function"&&r.catch(()=>{})}catch{}a.once&&this.removeListener(a.pattern,a.id)}}async emitAsync(e,t){this.recordHistory(e,t);const n=this.collectHandlers(e),a=[];for(const r of n){try{const i=r.handler(t);i&&typeof i.then=="function"&&a.push(i)}catch(i){a.push(Promise.reject(i))}r.once&&this.removeListener(r.pattern,r.id)}await Promise.all(a)}on(e,t,n=0){const a={id:$(),handler:t,priority:n,once:!1};return this.addListener(e,a),()=>{this.removeListener(e,a.id)}}once(e,t,n=0){const a={id:$(),handler:t,priority:n,once:!0};return this.addListener(e,a),()=>{this.removeListener(e,a.id)}}off(e){this.listeners.delete(e)}clear(){this.listeners.clear()}getHistory(e){return e?this.history.filter(t=>t.event===e?!0:e.includes("*")?O(e,t.event):!1):[...this.history]}debounce(e,t){let n=null;return a=>{n!==null&&clearTimeout(n),n=setTimeout(()=>{n=null,this.emit(e,a)},t)}}throttle(e,t){let n=0,a=null;return r=>{const i=Date.now(),o=i-n;o>=t?(n=i,this.emit(e,r)):a===null&&(a=setTimeout(()=>{n=Date.now(),a=null,this.emit(e,r)},t-o))}}addListener(e,t){const n=this.listeners.get(e);n?n.push(t):this.listeners.set(e,[t])}removeListener(e,t){const n=this.listeners.get(e);if(!n)return;const a=n.findIndex(r=>r.id===t);a!==-1&&n.splice(a,1),n.length===0&&this.listeners.delete(e)}collectHandlers(e){const t=[];for(const[n,a]of this.listeners){const r=n===e,i=!r&&n.includes("*")&&O(n,e);if(r||i)for(const o of a)t.push({...o,pattern:n,isExact:r})}return t.sort((n,a)=>a.priority!==n.priority?a.priority-n.priority:n.isExact&&!a.isExact?-1:!n.isExact&&a.isExact?1:0),t}recordHistory(e,t){this.history.push({event:e,payload:t,timestamp:Date.now()}),this.history.length>this.maxHistory&&(this.history=this.history.slice(this.history.length-this.maxHistory))}}function j(l,e){const t=e.split(".");let n=l;for(const a of t){if(n==null||typeof n!="object")return;n=n[a]}return n}function he(l,e){const t=j(l,e.field),n=e.value;switch(e.operator){case"=":return t===n;case"!=":return t!==n;case">":return t>n;case"<":return t<n;case">=":return t>=n;case"<=":return t<=n;case"in":return Array.isArray(n)&&n.includes(t);case"notIn":return Array.isArray(n)&&!n.includes(t);case"contains":return typeof t=="string"&&typeof n=="string"&&t.includes(n);case"startsWith":return typeof t=="string"&&typeof n=="string"&&t.startsWith(n);case"between":{if(!Array.isArray(n)||n.length!==2)return!1;const a=t;return a>=n[0]&&a<=n[1]}case"isNull":return t==null;case"isNotNull":return t!=null;default:return e.operator,!1}}function R(l,e){return l.filter(t=>e.every(n=>he(t,n)))}function ve(l,e){const t=[...l];return t.sort((n,a)=>{for(const{field:r,direction:i}of e){const o=j(n,r),s=j(a,r);let c=0;if(o==null&&s==null?c=0:o==null?c=-1:s==null?c=1:typeof o=="string"&&typeof s=="string"?c=o.localeCompare(s):typeof o=="number"&&typeof s=="number"?c=o-s:c=String(o).localeCompare(String(s)),c!==0)return i==="desc"?-c:c}return 0}),t}const F="concrete",Ie=100;class qe{cache=new Map;loaded=!1;persistTimer=null;ensureLoaded(){if(!this.loaded){try{const e=localStorage.getItem(F);if(e){const t=JSON.parse(e);for(const[n,a]of Object.entries(t))Array.isArray(a)&&this.cache.set(n,a)}}catch{this.cache.clear()}this.loaded=!0}}schedulePersist(){this.persistTimer!==null&&clearTimeout(this.persistTimer),this.persistTimer=setTimeout(()=>{this.persistTimer=null,this.persistNow()},Ie)}persistNow(){const e={};for(const[t,n]of this.cache.entries())e[t]=n;try{localStorage.setItem(F,JSON.stringify(e))}catch(t){if(t instanceof DOMException&&(t.name==="QuotaExceededError"||t.code===22))console.warn("[LocalStorageAdapter] localStorage quota exceeded. Data persisted only in memory.");else throw t}}flush(){this.persistTimer!==null&&(clearTimeout(this.persistTimer),this.persistTimer=null),this.persistNow()}getCollection(e){return this.ensureLoaded(),this.cache.has(e)||this.cache.set(e,[]),this.cache.get(e)}async get(e,t){return this.getCollection(e).find(a=>a.id===t)??null}async getAll(e){return[...this.getCollection(e)]}async insert(e,t){const n=this.getCollection(e),a={...t};return n.push(a),this.schedulePersist(),a}async update(e,t,n){const a=this.getCollection(e),r=a.findIndex(o=>o.id===t);if(r===-1)throw new Error(`[LocalStorageAdapter] Record not found: ${e}/${t}`);const i={...a[r],...n};return a[r]=i,this.schedulePersist(),i}async upsert(e,t){const n=t.id;return n&&await this.get(e,n)?this.update(e,n,t):this.insert(e,t)}async remove(e,t){const n=this.getCollection(e),a=n.findIndex(r=>r.id===t);a!==-1&&(n.splice(a,1),this.schedulePersist())}async query(e,t){let n=[...this.getCollection(e)];return t.filters&&t.filters.length>0&&(n=R(n,t.filters)),t.orderBy&&t.orderBy.length>0&&(n=ve(n,t.orderBy)),t.offset!=null&&t.offset>0&&(n=n.slice(t.offset)),t.limit!=null&&t.limit>0&&(n=n.slice(0,t.limit)),n}async count(e,t){let n=this.getCollection(e);return t&&t.length>0&&(n=R(n,t)),n.length}async bulkInsert(e,t,n){const a=this.getCollection(e),r=[],i=t.length;for(let o=0;o<i;o++){const s={...t[o]};a.push(s),r.push(s),n?.onProgress&&i>0&&n.onProgress(Math.round((o+1)/i*100))}return this.schedulePersist(),r}async bulkUpdate(e,t,n){const a=this.getCollection(e),r=[],i=t.length;for(let o=0;o<i;o++){const{id:s,changes:c}=t[o],y=a.findIndex(u=>u.id===s);if(y===-1)throw new Error(`[LocalStorageAdapter] Record not found: ${e}/${s}`);const b={...a[y],...c};a[y]=b,r.push(b),n?.onProgress&&i>0&&n.onProgress(Math.round((o+1)/i*100))}return this.schedulePersist(),r}async bulkRemove(e,t,n){const a=this.getCollection(e),r=new Set(t),i=t.length;let o=0;for(let s=a.length-1;s>=0;s--)r.has(a[s].id)&&(a.splice(s,1),o++,n?.onProgress&&i>0&&n.onProgress(Math.round(o/i*100)));this.schedulePersist()}async aggregate(e,t){let n=[...this.getCollection(e)];t.filters&&t.filters.length>0&&(n=R(n,t.filters));const a=t.groupBy??[],r=new Map;for(const o of n){const s=a.map(c=>String(j(o,c)??"")).join("||");r.has(s)||r.set(s,[]),r.get(s).push(o)}a.length===0&&!r.has("")&&r.set("",n);const i=[];for(const[o,s]of r.entries()){const c={};if(a.length>0){const b=o.split("||");for(let u=0;u<a.length;u++)c[a[u]]=b[u]}const y={};for(const b of t.aggregates){const u=`${b.fn}_${b.field}`;switch(b.fn){case"count":y[u]=s.length;break;case"sum":{let m=0;for(const d of s){const p=j(d,b.field);typeof p=="number"&&(m+=p)}y[u]=m;break}case"avg":{let m=0,d=0;for(const p of s){const v=j(p,b.field);typeof v=="number"&&(m+=v,d++)}y[u]=d>0?m/d:0;break}case"min":{let m=1/0;for(const d of s){const p=j(d,b.field);typeof p=="number"&&p<m&&(m=p)}y[u]=m===1/0?0:m;break}case"max":{let m=-1/0;for(const d of s){const p=j(d,b.field);typeof p=="number"&&p>m&&(m=p)}y[u]=m===-1/0?0:m;break}}}i.push({groups:c,values:y})}return i}async clear(e){this.cache.set(e,[]),this.schedulePersist()}async exportCollection(e){return[...this.getCollection(e)]}async importCollection(e,t,n=!1){if(n){const a=this.getCollection(e),r=new Set(a.map(i=>i.id));for(const i of t){const o=i.id;if(o&&r.has(o)){const s=a.findIndex(c=>c.id===o);a[s]={...a[s],...i}}else a.push({...i})}}else this.cache.set(e,t.map(a=>({...a})));this.schedulePersist()}}function x(){return`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,9)}`}function g(){return new Date().toISOString()}class H{_collection;adapter;_filters=[];_orderBy=[];_limit;_offset;_includes=[];constructor(e,t){this._collection=e,this.adapter=t}where(e,t,n){return this._filters.push({field:e,operator:t,value:n}),this}whereEq(e,t){return this.where(e,"=",t)}whereIn(e,t){return this.where(e,"in",t)}whereNull(e){return this.where(e,"isNull",null)}whereNotNull(e){return this.where(e,"isNotNull",null)}whereBetween(e,t,n){return this.where(e,"between",[t,n])}orderBy(e,t="asc"){return this._orderBy.push({field:e,direction:t}),this}limit(e){return this._limit=e,this}offset(e){return this._offset=e,this}include(e){return this._includes.push(e),this}build(){const e={};return this._filters.length>0&&(e.filters=[...this._filters]),this._orderBy.length>0&&(e.orderBy=[...this._orderBy]),this._limit!=null&&(e.limit=this._limit),this._offset!=null&&(e.offset=this._offset),this._includes.length>0&&(e.include=[...this._includes]),e}async execute(){return await this.adapter.query(this._collection,this.build())}async first(){const e=this._limit;this._limit=1;const t=await this.execute();return this._limit=e,t.length>0?t[0]:null}async count(){return this.adapter.count(this._collection,this._filters)}async sum(e){const t=await this.adapter.aggregate(this._collection,{aggregates:[{field:e,fn:"sum"}],filters:this._filters.length>0?this._filters:void 0});return t.length>0?t[0].values[`sum_${e}`]??0:0}async avg(e){const t=await this.adapter.aggregate(this._collection,{aggregates:[{field:e,fn:"avg"}],filters:this._filters.length>0?this._filters:void 0});return t.length>0?t[0].values[`avg_${e}`]??0:0}async min(e){const t=await this.adapter.aggregate(this._collection,{aggregates:[{field:e,fn:"min"}],filters:this._filters.length>0?this._filters:void 0});return t.length>0?t[0].values[`min_${e}`]??0:0}async max(e){const t=await this.adapter.aggregate(this._collection,{aggregates:[{field:e,fn:"max"}],filters:this._filters.length>0?this._filters:void 0});return t.length>0?t[0].values[`max_${e}`]??0:0}}class we{name;adapter;schemas;events;constructor(e,t,n,a){this.name=e,this.adapter=t,this.schemas=n,this.events=a}async get(e){const t=await this.adapter.get(this.name,e);return!t||t.deletedAt!=null?null:t}async getIncludingDeleted(e){const t=await this.adapter.get(this.name,e);return t||null}async getAll(){return(await this.adapter.getAll(this.name)).filter(t=>t.deletedAt==null)}query(){const e=new H(this.name,this.adapter);return e.whereNull("deletedAt"),e}queryIncludingDeleted(){return new H(this.name,this.adapter)}async count(e){const t=[{field:"deletedAt",operator:"isNull",value:null},...e??[]];return this.adapter.count(this.name,t)}async insert(e){const t={...e,id:e.id??x(),createdAt:g(),updatedAt:g(),deletedAt:null,version:1};this.validate(t),this.events.emit(`${this.name}.before.insert`,{collection:this.name,record:t});const n=await this.adapter.insert(this.name,t);return this.events.emit(`${this.name}.after.insert`,{collection:this.name,record:n}),this.events.emit(`${this.name}.change`,{type:"insert",collection:this.name,records:[n]}),n}async update(e,t){const n=await this.adapter.get(this.name,e);if(!n)throw new Error(`[Collection:${this.name}] Record not found: ${e}`);const a={...n,...t,id:e,updatedAt:g(),version:(n.version??0)+1};this.validate(a),this.events.emit(`${this.name}.before.update`,{collection:this.name,id:e,changes:t,previous:n});const r=await this.adapter.update(this.name,e,{...t,updatedAt:a.updatedAt,version:a.version});return this.events.emit(`${this.name}.after.update`,{collection:this.name,record:r,previous:n}),this.events.emit(`${this.name}.change`,{type:"update",collection:this.name,records:[r]}),r}async upsert(e){const t=e.id;return t&&await this.adapter.get(this.name,t)?this.update(t,e):this.insert(e)}async remove(e){const t=await this.adapter.get(this.name,e);if(!t)throw new Error(`[Collection:${this.name}] Record not found: ${e}`);this.events.emit(`${this.name}.before.remove`,{collection:this.name,id:e,record:t}),await this.adapter.update(this.name,e,{deletedAt:g(),updatedAt:g(),version:(t.version??0)+1}),this.events.emit(`${this.name}.after.remove`,{collection:this.name,id:e,record:t}),this.events.emit(`${this.name}.change`,{type:"remove",collection:this.name,ids:[e]})}async hardRemove(e){const t=await this.adapter.get(this.name,e);if(!t)throw new Error(`[Collection:${this.name}] Record not found: ${e}`);this.events.emit(`${this.name}.before.hardRemove`,{collection:this.name,id:e,record:t}),await this.adapter.remove(this.name,e),this.events.emit(`${this.name}.after.hardRemove`,{collection:this.name,id:e,record:t}),this.events.emit(`${this.name}.change`,{type:"remove",collection:this.name,ids:[e]})}async restore(e){const t=await this.adapter.get(this.name,e);if(!t)throw new Error(`[Collection:${this.name}] Record not found: ${e}`);if(t.deletedAt==null)throw new Error(`[Collection:${this.name}] Record is not deleted: ${e}`);this.events.emit(`${this.name}.before.restore`,{collection:this.name,id:e});const n=await this.adapter.update(this.name,e,{deletedAt:null,updatedAt:g(),version:(t.version??0)+1});return this.events.emit(`${this.name}.after.restore`,{collection:this.name,record:n}),this.events.emit(`${this.name}.change`,{type:"restore",collection:this.name,records:[n]}),n}async bulkInsert(e,t){const n=e.map(r=>{const i={...r,id:r.id??x(),createdAt:g(),updatedAt:g(),deletedAt:null,version:1};return this.validate(i),i});this.events.emit(`${this.name}.before.bulkInsert`,{collection:this.name,count:n.length});const a=await this.adapter.bulkInsert(this.name,n,t);return this.events.emit(`${this.name}.after.bulkInsert`,{collection:this.name,records:a}),this.events.emit(`${this.name}.change`,{type:"bulkInsert",collection:this.name,records:a}),a}async bulkUpdate(e,t){const n=[];for(const{id:r,changes:i}of e){const o=await this.adapter.get(this.name,r);if(!o)throw new Error(`[Collection:${this.name}] Record not found: ${r}`);n.push({id:r,changes:{...i,updatedAt:g(),version:(o.version??0)+1}})}this.events.emit(`${this.name}.before.bulkUpdate`,{collection:this.name,count:n.length});const a=await this.adapter.bulkUpdate(this.name,n,t);return this.events.emit(`${this.name}.after.bulkUpdate`,{collection:this.name,records:a}),this.events.emit(`${this.name}.change`,{type:"bulkUpdate",collection:this.name,records:a}),a}async bulkRemove(e,t){const n=[];for(const a of e){const r=await this.adapter.get(this.name,a);r&&n.push({id:a,changes:{deletedAt:g(),updatedAt:g(),version:(r.version??0)+1}})}this.events.emit(`${this.name}.before.bulkRemove`,{collection:this.name,ids:e}),n.length>0&&await this.adapter.bulkUpdate(this.name,n,t),this.events.emit(`${this.name}.after.bulkRemove`,{collection:this.name,ids:e}),this.events.emit(`${this.name}.change`,{type:"bulkRemove",collection:this.name,ids:e})}onChange(e){return this.events.on(`${this.name}.change`,e)}async exportJSON(){return await this.adapter.exportCollection(this.name)}async importJSON(e,t={}){const n=e.map(a=>({...a,id:a.id??x(),createdAt:a.createdAt??g(),updatedAt:a.updatedAt??g(),deletedAt:a.deletedAt??null,version:a.version??1}));await this.adapter.importCollection(this.name,n,t.merge??!1),this.events.emit(`${this.name}.change`,{type:"bulkInsert",collection:this.name,records:n})}validate(e){try{this.schemas.get(this.name)&&this.schemas.validate(this.name,e)}catch{}}}class Te{operations=[];committed=!1;rolledBack=!1;enqueue(e){if(this.committed||this.rolledBack)throw new Error("[Transaction] Cannot enqueue: transaction already finalized.");this.operations.push(e)}async commit(){if(this.committed)throw new Error("[Transaction] Already committed.");if(this.rolledBack)throw new Error("[Transaction] Already rolled back.");this.committed=!0;for(const e of this.operations)await e()}rollback(){this.rolledBack=!0,this.operations=[]}}const xe=5e3;class Se{schemas;events;logger;adapter=null;collections=new Map;initialized=!1;constructor(e,t,n){this.schemas=e,this.events=t,this.logger=n}async initialize(){if(this.initialized){this.logger.warn("store","Store already initialized");return}if(this.logger.info("store","Initializing data store..."),this.adapter=new qe,this.shouldUseIndexedDB())try{const{IndexedDBAdapter:e}=await L(async()=>{const{IndexedDBAdapter:n}=await import("./indexeddb-Yp6PkC1q.js");return{IndexedDBAdapter:n}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]),import.meta.url),t=new e;await this.migrateAdapter(this.adapter,t),this.adapter=t,this.logger.info("store","Upgraded to IndexedDB adapter for large dataset")}catch(e){this.logger.warn("store","IndexedDB not available, staying with localStorage",e)}this.initialized=!0,this.events.emit("store.initialized",{adapter:this.adapter.constructor.name}),this.logger.info("store",`Store initialized with ${this.adapter.constructor.name}`)}shouldUseIndexedDB(){if(typeof indexedDB>"u")return!1;try{const e=localStorage.getItem("concrete");if(!e)return!1;const t=JSON.parse(e);let n=0;for(const a of Object.values(t))Array.isArray(a)&&(n+=a.length);return n>xe}catch{return!1}}async migrateAdapter(e,t){try{const n=localStorage.getItem("concrete");if(!n)return;const a=JSON.parse(n);for(const[r,i]of Object.entries(a))Array.isArray(i)&&i.length>0&&await t.importCollection(r,i)}catch(n){throw this.logger.error("store","Migration failed",n),n}}setAdapter(e){this.adapter=e,this.collections.clear(),this.logger.info("store",`Adapter switched to ${e.constructor.name}`)}getAdapter(){return this.ensureInitialized(),this.adapter}ensureInitialized(){if(!this.initialized||!this.adapter)throw new Error("[Store] Not initialized. Call initialize() first.")}collection(e){if(this.ensureInitialized(),!this.collections.has(e)){const t=new we(e,this.adapter,this.schemas,this.events);this.collections.set(e,t)}return this.collections.get(e)}async transaction(e){const t=new Te;try{await e(t),await t.commit(),this.events.emit("store.transaction.commit")}catch(n){throw t.rollback(),this.events.emit("store.transaction.rollback",{error:n}),n}}async exportAll(){this.ensureInitialized();const e={};for(const[t,n]of this.collections.entries())e[t]=await n.exportJSON();try{const t=localStorage.getItem("concrete");if(t){const n=JSON.parse(t);for(const[a,r]of Object.entries(n))!e[a]&&Array.isArray(r)&&(e[a]=r)}}catch{}return e}async importAll(e){this.ensureInitialized();const t=e.__version??1,n=this.migrateData(e,t);for(const[a,r]of Object.entries(n)){if(a.startsWith("__")||!Array.isArray(r))continue;await this.collection(a).importJSON(r,{merge:!1})}this.events.emit("store.imported",{collections:Object.keys(n)}),this.logger.info("store","Data imported successfully")}migrateData(e,t){return e}async seed(e){this.ensureInitialized(),this.logger.info("store",`Seeding data with profile: ${e}`),this.events.emit("store.seed",{profile:e})}async reset(){this.ensureInitialized(),this.logger.warn("store","Resetting all store data");for(const[e]of this.collections.entries())await this.adapter.clear(e);try{localStorage.removeItem("concrete")}catch{}this.collections.clear(),this.events.emit("store.reset"),this.logger.info("store","Store reset complete")}async getStats(){this.ensureInitialized();const e={};for(const[t]of this.collections.entries())e[t]=await this.adapter.count(t);try{const t=localStorage.getItem("concrete");if(t){const n=JSON.parse(t);for(const[a,r]of Object.entries(n))!e[a]&&Array.isArray(r)&&(e[a]=r.length)}}catch{}return e}}function Ce(l,e){if(e.required&&(l==null||l===""))return`${e.label??e.name} is required`;if(l==null)return null;switch(e.type){case"string":case"id":case"date":{if(typeof l!="string")return`${e.label??e.name} must be a string`;break}case"number":case"currency":case"percentage":{if(typeof l!="number"||Number.isNaN(l))return`${e.label??e.name} must be a number`;break}case"boolean":{if(typeof l!="boolean")return`${e.label??e.name} must be a boolean`;break}case"enum":{if(e.enum&&!e.enum.includes(l))return`${e.label??e.name} must be one of: ${e.enum.join(", ")}`;break}case"array":{if(!Array.isArray(l))return`${e.label??e.name} must be an array`;break}case"object":{if(typeof l!="object"||Array.isArray(l))return`${e.label??e.name} must be an object`;break}}if((e.type==="number"||e.type==="currency"||e.type==="percentage")&&typeof l=="number"){if(e.min!==void 0&&l<e.min)return`${e.label??e.name} must be at least ${e.min}`;if(e.max!==void 0&&l>e.max)return`${e.label??e.name} must be at most ${e.max}`}if(e.type==="string"&&typeof l=="string"){if(e.min!==void 0&&l.length<e.min)return`${e.label??e.name} must be at least ${e.min} characters`;if(e.max!==void 0&&l.length>e.max)return`${e.label??e.name} must be at most ${e.max} characters`}if(e.pattern&&typeof l=="string"&&!new RegExp(e.pattern).test(l))return`${e.label??e.name} does not match the required pattern`;if(e.validators)for(const t of e.validators){const n=t(l,e,{});if(n)return n}return null}function je(l,e){const t=[];for(const n of e.fields){const a=l[n.name],r=Ce(a,n);if(r&&t.push(r),n.validators)for(const i of n.validators){const o=i(a,n,l);o&&!t.includes(o)&&t.push(o)}}if(e.validators)for(const n of e.validators){const a=n(l,e);t.push(...a)}return t}class Ae{schemas;constructor(e){this.schemas=e}getCurrentVersion(e){const t=this.schemas.get(e);if(!t)throw new Error(`Schema not found for collection: ${e}`);return t.version}getMigrations(e,t,n){const a=this.schemas.get(e);if(!a)throw new Error(`Schema not found for collection: ${e}`);return(a.migrations??[]).filter(i=>i.version>t&&i.version<=n).sort((i,o)=>i.version-o.version)}run(e,t,n,a){const r=this.getMigrations(e,n,a);if(r.length===0)return t;let i=[...t];for(const o of r)i=o.up(i);return i}}const De=[{collection:"core/company",module:"core",version:1,fields:[{name:"name",type:"string",required:!0,label:"Company Name"},{name:"legalName",type:"string",label:"Legal Name"},{name:"taxId",type:"string",label:"Tax ID / EIN"},{name:"status",type:"enum",enum:["active","inactive","suspended"],label:"Status"}],relations:[]},{collection:"core/user",module:"core",version:1,fields:[{name:"email",type:"string",required:!0,label:"Email"},{name:"displayName",type:"string",required:!0,label:"Display Name"},{name:"roleIds",type:"array",label:"Role IDs"},{name:"status",type:"enum",enum:["active","inactive","locked"],label:"Status"}],relations:[{foreignKey:"roleIds",collection:"core/role",type:"manyToMany",cascade:"nullify"}]},{collection:"core/role",module:"core",version:1,fields:[{name:"name",type:"string",required:!0,label:"Role Name"},{name:"description",type:"string",label:"Description"},{name:"permissions",type:"array",label:"Permissions"}],relations:[]},{collection:"core/permission",module:"core",version:1,fields:[{name:"resource",type:"string",required:!0,label:"Resource"},{name:"action",type:"string",required:!0,label:"Action"},{name:"description",type:"string",label:"Description"}],relations:[]},{collection:"core/auditLog",module:"core",version:1,fields:[{name:"userId",type:"id",required:!0,label:"User"},{name:"action",type:"string",required:!0,label:"Action"},{name:"collection",type:"string",label:"Collection"},{name:"recordId",type:"id",label:"Record ID"}],relations:[{foreignKey:"userId",collection:"core/user",type:"belongsTo",cascade:"nullify"}]},{collection:"core/config",module:"core",version:1,fields:[{name:"key",type:"string",required:!0,label:"Key"},{name:"value",type:"object",label:"Value"},{name:"scope",type:"enum",enum:["system","tenant","user"],label:"Scope"}],relations:[]},{collection:"core/notification",module:"core",version:1,fields:[{name:"title",type:"string",required:!0,label:"Title"},{name:"message",type:"string",required:!0,label:"Message"},{name:"type",type:"enum",enum:["critical","warning","info","success","action-required"],label:"Type"},{name:"read",type:"boolean",label:"Read"}],relations:[]},{collection:"core/attachment",module:"core",version:1,fields:[{name:"fileName",type:"string",required:!0,label:"File Name"},{name:"mimeType",type:"string",label:"MIME Type"},{name:"size",type:"number",label:"File Size"},{name:"entityId",type:"id",label:"Attached To"}],relations:[]},{collection:"core/comment",module:"core",version:1,fields:[{name:"text",type:"string",required:!0,label:"Comment"},{name:"authorId",type:"id",required:!0,label:"Author"},{name:"entityId",type:"id",required:!0,label:"Entity"}],relations:[{foreignKey:"authorId",collection:"core/user",type:"belongsTo",cascade:"nullify"}]},{collection:"core/tag",module:"core",version:1,fields:[{name:"name",type:"string",required:!0,label:"Tag Name"},{name:"color",type:"string",label:"Color"}],relations:[]},{collection:"core/customField",module:"core",version:1,fields:[{name:"name",type:"string",required:!0,label:"Field Name"},{name:"type",type:"enum",enum:["string","number","boolean","date","enum"],label:"Field Type"},{name:"collection",type:"string",required:!0,label:"Target Collection"}],relations:[]},{collection:"core/savedFilter",module:"core",version:1,fields:[{name:"name",type:"string",required:!0,label:"Filter Name"},{name:"collection",type:"string",required:!0,label:"Collection"},{name:"filters",type:"object",required:!0,label:"Filter Criteria"}],relations:[]}],_e=[{collection:"gl/account",module:"gl",version:2,fields:[{name:"number",type:"string",required:!0,label:"Account Number"},{name:"name",type:"string",required:!0,label:"Account Name"},{name:"type",type:"enum",enum:["asset","liability","equity","revenue","expense","costOfRevenue"],required:!0,label:"Account Type"},{name:"normalBalance",type:"enum",enum:["debit","credit"],required:!0,label:"Normal Balance"},{name:"parentId",type:"id",label:"Parent Account"},{name:"description",type:"string",label:"Description"},{name:"isActive",type:"boolean",label:"Active"},{name:"depth",type:"number",label:"Hierarchy Depth"},{name:"path",type:"string",label:"Account Path"},{name:"isSummary",type:"boolean",label:"Summary Account"}],relations:[{foreignKey:"parentId",collection:"gl/account",type:"belongsTo",cascade:"nullify"}]},{collection:"gl/journalEntry",module:"gl",version:2,fields:[{name:"entryNumber",type:"string",required:!0,label:"Entry Number"},{name:"date",type:"date",required:!0,label:"Entry Date"},{name:"reference",type:"string",label:"Reference"},{name:"description",type:"string",label:"Description"},{name:"status",type:"enum",enum:["draft","posted","voided"],label:"Status"},{name:"totalDebit",type:"currency",label:"Total Debit"},{name:"totalCredit",type:"currency",label:"Total Credit"},{name:"postedAt",type:"date",label:"Posted At"},{name:"voidedAt",type:"date",label:"Voided At"},{name:"voidReason",type:"string",label:"Void Reason"},{name:"sourceModule",type:"string",label:"Source Module"},{name:"sourceId",type:"string",label:"Source ID"},{name:"fiscalPeriodId",type:"id",label:"Fiscal Period"},{name:"isAutoGenerated",type:"boolean",label:"Auto-Generated"}],relations:[{foreignKey:"fiscalPeriodId",collection:"gl/fiscalPeriod",type:"belongsTo",cascade:"restrict"}]},{collection:"gl/journalLine",module:"gl",version:2,fields:[{name:"journalEntryId",type:"id",required:!0,label:"Journal Entry"},{name:"accountId",type:"id",required:!0,label:"Account"},{name:"accountNumber",type:"string",label:"Account Number"},{name:"accountName",type:"string",label:"Account Name"},{name:"debit",type:"currency",label:"Debit"},{name:"credit",type:"currency",label:"Credit"},{name:"description",type:"string",label:"Line Description"},{name:"lineOrder",type:"number",label:"Line Order"}],relations:[{foreignKey:"journalEntryId",collection:"gl/journalEntry",type:"belongsTo",cascade:"cascade"},{foreignKey:"accountId",collection:"gl/account",type:"belongsTo",cascade:"restrict"}]},{collection:"gl/fiscalPeriod",module:"gl",version:2,fields:[{name:"name",type:"string",required:!0,label:"Period Name"},{name:"year",type:"number",required:!0,label:"Fiscal Year"},{name:"month",type:"number",label:"Month Number"},{name:"startDate",type:"date",required:!0,label:"Start Date"},{name:"endDate",type:"date",required:!0,label:"End Date"},{name:"status",type:"enum",enum:["open","closed","locked"],label:"Status"},{name:"closedAt",type:"date",label:"Closed At"}],relations:[]},{collection:"gl/recurringEntry",module:"gl",version:2,fields:[{name:"name",type:"string",required:!0,label:"Name"},{name:"description",type:"string",label:"Description"},{name:"frequency",type:"enum",enum:["daily","weekly","monthly","quarterly","yearly"],required:!0,label:"Frequency"},{name:"isActive",type:"boolean",label:"Active"},{name:"nextRunDate",type:"date",label:"Next Run Date"},{name:"lastRunDate",type:"date",label:"Last Run Date"},{name:"endDate",type:"date",label:"End Date"},{name:"templateLines",type:"array",label:"Template Lines"},{name:"runCount",type:"number",label:"Run Count"}],relations:[]},{collection:"gl/closingEntry",module:"gl",version:2,fields:[{name:"fiscalPeriodId",type:"id",required:!0,label:"Fiscal Period"},{name:"journalEntryId",type:"id",required:!0,label:"Journal Entry"},{name:"type",type:"enum",enum:["income-summary","retained-earnings"],label:"Closing Type"},{name:"periodName",type:"string",label:"Period Name"},{name:"totalAmount",type:"currency",label:"Total Amount"}],relations:[{foreignKey:"fiscalPeriodId",collection:"gl/fiscalPeriod",type:"belongsTo",cascade:"restrict"},{foreignKey:"journalEntryId",collection:"gl/journalEntry",type:"belongsTo",cascade:"cascade"}]}],Ee=[{collection:"job/job",module:"job",version:2,fields:[{name:"number",type:"string",required:!0,label:"Job Number"},{name:"name",type:"string",required:!0,label:"Job Name"},{name:"type",type:"enum",enum:["lump_sum","time_material","cost_plus","unit_price","design_build","gmp"],required:!0,label:"Job Type"},{name:"status",type:"enum",enum:["bidding","awarded","active","complete","closed"],label:"Status"},{name:"customerId",type:"id",label:"Customer"},{name:"entityId",type:"id",label:"Entity"},{name:"description",type:"string",label:"Description"},{name:"contractAmount",type:"currency",label:"Contract Amount"},{name:"startDate",type:"date",label:"Start Date"},{name:"endDate",type:"date",label:"End Date"},{name:"completionDate",type:"date",label:"Actual Completion Date"},{name:"ownerName",type:"string",label:"Owner Name"},{name:"address",type:"string",label:"Job Address"},{name:"city",type:"string",label:"City"},{name:"state",type:"string",label:"State"},{name:"zip",type:"string",label:"ZIP"},{name:"projectManagerId",type:"string",label:"Project Manager"},{name:"superintendentId",type:"string",label:"Superintendent"},{name:"retentionPct",type:"percentage",label:"Retention %"},{name:"percentComplete",type:"percentage",label:"% Complete"},{name:"totalBudget",type:"currency",label:"Total Budget"},{name:"totalActualCost",type:"currency",label:"Total Actual Cost"},{name:"totalCommitted",type:"currency",label:"Total Committed"},{name:"totalBilled",type:"currency",label:"Total Billed"}],relations:[{foreignKey:"customerId",collection:"ar/customer",type:"belongsTo",cascade:"nullify"},{foreignKey:"entityId",collection:"entity/entity",type:"belongsTo",cascade:"nullify"}]},{collection:"job/costCode",module:"job",version:2,fields:[{name:"code",type:"string",required:!0,label:"Cost Code"},{name:"description",type:"string",required:!0,label:"Description"},{name:"parentId",type:"id",label:"Parent Cost Code"},{name:"isStandard",type:"boolean",label:"Standard (CSI MasterFormat)"},{name:"depth",type:"number",label:"Depth"}],relations:[{foreignKey:"parentId",collection:"job/costCode",type:"belongsTo",cascade:"nullify"}]},{collection:"job/budget",module:"job",version:2,fields:[{name:"jobId",type:"id",required:!0,label:"Job"},{name:"name",type:"string",required:!0,label:"Budget Name"},{name:"status",type:"enum",enum:["draft","approved","revised"],label:"Status"},{name:"revision",type:"number",label:"Revision Number"},{name:"totalAmount",type:"currency",label:"Total Amount"},{name:"approvedAt",type:"date",label:"Approved Date"},{name:"approvedBy",type:"string",label:"Approved By"}],relations:[{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"cascade"}]},{collection:"job/budgetLine",module:"job",version:2,fields:[{name:"budgetId",type:"id",required:!0,label:"Budget"},{name:"jobId",type:"id",required:!0,label:"Job"},{name:"costCodeId",type:"id",required:!0,label:"Cost Code"},{name:"costType",type:"enum",enum:["labor","material","subcontract","equipment","other","overhead"],required:!0,label:"Cost Type"},{name:"amount",type:"currency",required:!0,label:"Budget Amount"},{name:"description",type:"string",label:"Description"},{name:"quantity",type:"number",label:"Quantity"},{name:"unitCost",type:"currency",label:"Unit Cost"}],relations:[{foreignKey:"budgetId",collection:"job/budget",type:"belongsTo",cascade:"cascade"},{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"cascade"},{foreignKey:"costCodeId",collection:"job/costCode",type:"belongsTo",cascade:"restrict"}]},{collection:"job/actualCost",module:"job",version:1,fields:[{name:"jobId",type:"id",required:!0,label:"Job"},{name:"costCodeId",type:"id",required:!0,label:"Cost Code"},{name:"costType",type:"enum",enum:["labor","material","subcontract","equipment","other","overhead"],required:!0,label:"Cost Type"},{name:"date",type:"date",required:!0,label:"Date"},{name:"amount",type:"currency",required:!0,label:"Amount"},{name:"description",type:"string",label:"Description"},{name:"source",type:"enum",enum:["ap","payroll","equipment","je","manual"],label:"Source"},{name:"sourceId",type:"string",label:"Source Reference ID"},{name:"vendorName",type:"string",label:"Vendor Name"},{name:"invoiceNumber",type:"string",label:"Invoice Number"},{name:"quantity",type:"number",label:"Quantity"},{name:"unitCost",type:"currency",label:"Unit Cost"}],relations:[{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"cascade"},{foreignKey:"costCodeId",collection:"job/costCode",type:"belongsTo",cascade:"restrict"}]},{collection:"job/committedCost",module:"job",version:1,fields:[{name:"jobId",type:"id",required:!0,label:"Job"},{name:"costCodeId",type:"id",required:!0,label:"Cost Code"},{name:"costType",type:"enum",enum:["labor","material","subcontract","equipment","other","overhead"],required:!0,label:"Cost Type"},{name:"type",type:"enum",enum:["purchase_order","subcontract"],required:!0,label:"Commitment Type"},{name:"referenceNumber",type:"string",label:"PO/Contract Number"},{name:"vendorName",type:"string",label:"Vendor/Sub Name"},{name:"amount",type:"currency",required:!0,label:"Committed Amount"},{name:"invoicedAmount",type:"currency",label:"Invoiced to Date"},{name:"remainingAmount",type:"currency",label:"Remaining"},{name:"date",type:"date",required:!0,label:"Date"},{name:"description",type:"string",label:"Description"},{name:"status",type:"enum",enum:["open","partial","closed","cancelled"],label:"Status"}],relations:[{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"cascade"},{foreignKey:"costCodeId",collection:"job/costCode",type:"belongsTo",cascade:"restrict"}]},{collection:"job/wip",module:"job",version:2,fields:[{name:"jobId",type:"id",required:!0,label:"Job"},{name:"periodId",type:"id",label:"Fiscal Period"},{name:"periodName",type:"string",label:"Period Name"},{name:"contractAmount",type:"currency",label:"Contract Amount"},{name:"totalBudget",type:"currency",label:"Total Budget"},{name:"actualCostToDate",type:"currency",label:"Actual Cost to Date"},{name:"estimateToComplete",type:"currency",label:"Estimate to Complete"},{name:"estimateAtCompletion",type:"currency",label:"Estimate at Completion"},{name:"percentComplete",type:"percentage",label:"% Complete"},{name:"earnedRevenue",type:"currency",label:"Earned Revenue"},{name:"billedToDate",type:"currency",label:"Billed to Date"},{name:"overUnderBilling",type:"currency",label:"Over/Under Billing"},{name:"projectedGrossProfit",type:"currency",label:"Projected Gross Profit"},{name:"projectedMarginPct",type:"percentage",label:"Projected Margin %"}],relations:[{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"cascade"},{foreignKey:"periodId",collection:"gl/fiscalPeriod",type:"belongsTo",cascade:"nullify"}]},{collection:"job/changeOrder",module:"job",version:1,fields:[{name:"jobId",type:"id",required:!0,label:"Job"},{name:"number",type:"string",required:!0,label:"CO Number"},{name:"description",type:"string",required:!0,label:"Description"},{name:"amount",type:"currency",required:!0,label:"Amount"},{name:"status",type:"enum",enum:["pending","approved","rejected"],label:"Status"},{name:"date",type:"date",label:"Date"},{name:"approvedAt",type:"date",label:"Approved Date"}],relations:[{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"cascade"}]},{collection:"job/estimate",module:"job",version:1,fields:[{name:"jobId",type:"id",required:!0,label:"Job"},{name:"name",type:"string",required:!0,label:"Estimate Name"},{name:"revision",type:"number",label:"Revision Number"},{name:"status",type:"enum",enum:["draft","submitted","won","lost","withdrawn"],label:"Status"},{name:"totalCost",type:"currency",label:"Total Cost"},{name:"totalMarkup",type:"currency",label:"Total Markup"},{name:"totalPrice",type:"currency",label:"Total Price"},{name:"marginPct",type:"percentage",label:"Margin %"},{name:"bidDate",type:"date",label:"Bid Date"},{name:"submittedDate",type:"date",label:"Submitted Date"},{name:"clientName",type:"string",label:"Client Name"},{name:"projectName",type:"string",label:"Project Name"},{name:"description",type:"string",label:"Description"},{name:"createdBy",type:"string",label:"Created By"},{name:"defaultMarkupPct",type:"percentage",label:"Default Markup %"},{name:"wonDate",type:"date",label:"Won Date"},{name:"lostDate",type:"date",label:"Lost Date"},{name:"lostReason",type:"string",label:"Lost Reason"},{name:"competitorName",type:"string",label:"Competitor Name"},{name:"competitorPrice",type:"currency",label:"Competitor Price"},{name:"transferredToBudget",type:"boolean",label:"Transferred to Budget"},{name:"budgetId",type:"id",label:"Linked Budget"}],relations:[{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"cascade"},{foreignKey:"budgetId",collection:"job/budget",type:"belongsTo",cascade:"nullify"}]},{collection:"job/estimateLine",module:"job",version:1,fields:[{name:"estimateId",type:"id",required:!0,label:"Estimate"},{name:"parentId",type:"id",label:"Parent (Assembly)"},{name:"costCodeId",type:"id",label:"Cost Code"},{name:"description",type:"string",required:!0,label:"Description"},{name:"costType",type:"enum",enum:["labor","material","equipment","subcontract","other"],required:!0,label:"Cost Type"},{name:"quantity",type:"number",label:"Quantity"},{name:"unit",type:"string",label:"Unit of Measure"},{name:"unitCost",type:"currency",label:"Unit Cost"},{name:"amount",type:"currency",label:"Amount (Cost)"},{name:"markupPct",type:"percentage",label:"Markup %"},{name:"markupAmount",type:"currency",label:"Markup Amount"},{name:"totalPrice",type:"currency",label:"Total Price"},{name:"isAssembly",type:"boolean",label:"Is Assembly"},{name:"assemblyName",type:"string",label:"Assembly Name"},{name:"sortOrder",type:"number",label:"Sort Order"},{name:"isAlternate",type:"boolean",label:"Is Alternate"},{name:"isAllowance",type:"boolean",label:"Is Allowance"},{name:"alternateGroup",type:"string",label:"Alternate Group"}],relations:[{foreignKey:"estimateId",collection:"job/estimate",type:"belongsTo",cascade:"cascade"},{foreignKey:"parentId",collection:"job/estimateLine",type:"belongsTo",cascade:"nullify"},{foreignKey:"costCodeId",collection:"job/costCode",type:"belongsTo",cascade:"nullify"}]},{collection:"job/bid",module:"job",version:1,fields:[{name:"estimateId",type:"id",required:!0,label:"Estimate"},{name:"vendorId",type:"id",label:"Vendor"},{name:"trade",type:"string",required:!0,label:"Trade"},{name:"description",type:"string",label:"Description"},{name:"amount",type:"currency",label:"Bid Amount"},{name:"status",type:"enum",enum:["solicited","received","selected","rejected"],label:"Status"},{name:"receivedDate",type:"date",label:"Received Date"},{name:"expirationDate",type:"date",label:"Expiration Date"},{name:"notes",type:"string",label:"Notes"},{name:"isLowBid",type:"boolean",label:"Is Low Bid"},{name:"scopeInclusions",type:"string",label:"Scope Inclusions"},{name:"scopeExclusions",type:"string",label:"Scope Exclusions"},{name:"bondIncluded",type:"boolean",label:"Bond Included"},{name:"contactName",type:"string",label:"Contact Name"},{name:"contactPhone",type:"string",label:"Contact Phone"},{name:"contactEmail",type:"string",label:"Contact Email"}],relations:[{foreignKey:"estimateId",collection:"job/estimate",type:"belongsTo",cascade:"cascade"},{foreignKey:"vendorId",collection:"ap/vendor",type:"belongsTo",cascade:"nullify"}]}],ke=[{collection:"entity/entity",module:"entity",version:2,fields:[{name:"name",type:"string",required:!0,label:"Entity Name"},{name:"code",type:"string",required:!0,label:"Entity Code"},{name:"type",type:"enum",enum:["holding","operating","subsidiary","division","branch","joint_venture","spe"],required:!0,label:"Entity Type"},{name:"parentId",type:"id",label:"Parent Entity"},{name:"status",type:"enum",enum:["active","inactive"],label:"Status"},{name:"description",type:"string",label:"Description"},{name:"taxId",type:"string",label:"Tax ID / EIN"},{name:"address",type:"string",label:"Address"},{name:"city",type:"string",label:"City"},{name:"state",type:"string",label:"State"},{name:"zip",type:"string",label:"ZIP"},{name:"country",type:"string",label:"Country"},{name:"phone",type:"string",label:"Phone"},{name:"email",type:"string",label:"Email"},{name:"currency",type:"string",label:"Currency Code"},{name:"fiscalYearEndMonth",type:"number",label:"Fiscal Year End Month"},{name:"fiscalYearEndDay",type:"number",label:"Fiscal Year End Day"},{name:"depth",type:"number",label:"Hierarchy Depth"},{name:"path",type:"string",label:"Hierarchy Path"},{name:"clonedFromId",type:"id",label:"Cloned From"}],relations:[{foreignKey:"parentId",collection:"entity/entity",type:"belongsTo",cascade:"nullify"}]},{collection:"entity/hierarchy",module:"entity",version:1,fields:[{name:"name",type:"string",required:!0,label:"Hierarchy Name"},{name:"rootEntityId",type:"id",required:!0,label:"Root Entity"},{name:"type",type:"enum",enum:["legal","management","reporting"],label:"Hierarchy Type"}],relations:[{foreignKey:"rootEntityId",collection:"entity/entity",type:"belongsTo",cascade:"restrict"}]},{collection:"entity/alias",module:"entity",version:1,fields:[{name:"entityId",type:"id",required:!0,label:"Entity"},{name:"alias",type:"string",required:!0,label:"Alias Name"},{name:"source",type:"string",label:"Source System"}],relations:[{foreignKey:"entityId",collection:"entity/entity",type:"belongsTo",cascade:"cascade"}]},{collection:"entity/coaOverride",module:"entity",version:1,fields:[{name:"entityId",type:"id",required:!0,label:"Entity"},{name:"accountId",type:"id",required:!0,label:"GL Account"},{name:"overrideName",type:"string",label:"Override Name"},{name:"isExcluded",type:"boolean",label:"Excluded from Entity COA"},{name:"defaultValue",type:"currency",label:"Default Value"}],relations:[{foreignKey:"entityId",collection:"entity/entity",type:"belongsTo",cascade:"cascade"},{foreignKey:"accountId",collection:"gl/account",type:"belongsTo",cascade:"cascade"}]},{collection:"entity/intercompany",module:"entity",version:1,fields:[{name:"fromEntityId",type:"id",required:!0,label:"From Entity"},{name:"toEntityId",type:"id",required:!0,label:"To Entity"},{name:"date",type:"date",required:!0,label:"Transaction Date"},{name:"description",type:"string",label:"Description"},{name:"amount",type:"currency",required:!0,label:"Amount"},{name:"fromJournalEntryId",type:"id",label:"From JE"},{name:"toJournalEntryId",type:"id",label:"To JE"},{name:"eliminationJournalEntryId",type:"id",label:"Elimination JE"},{name:"status",type:"enum",enum:["pending","posted","eliminated"],label:"Status"},{name:"reference",type:"string",label:"Reference"}],relations:[{foreignKey:"fromEntityId",collection:"entity/entity",type:"belongsTo",cascade:"restrict"},{foreignKey:"toEntityId",collection:"entity/entity",type:"belongsTo",cascade:"restrict"},{foreignKey:"fromJournalEntryId",collection:"gl/journalEntry",type:"belongsTo",cascade:"nullify"},{foreignKey:"toJournalEntryId",collection:"gl/journalEntry",type:"belongsTo",cascade:"nullify"},{foreignKey:"eliminationJournalEntryId",collection:"gl/journalEntry",type:"belongsTo",cascade:"nullify"}]}],Ne=[{collection:"ap/vendor",module:"ap",version:2,fields:[{name:"name",type:"string",required:!0,label:"Vendor Name"},{name:"code",type:"string",label:"Vendor Code"},{name:"taxId",type:"string",label:"Tax ID (EIN/SSN)"},{name:"vendorType",type:"enum",enum:["subcontractor","supplier","professional","utility","other"],label:"Vendor Type"},{name:"status",type:"enum",enum:["active","inactive","hold"],label:"Status"},{name:"address",type:"string",label:"Address"},{name:"city",type:"string",label:"City"},{name:"state",type:"string",label:"State"},{name:"zip",type:"string",label:"Zip"},{name:"country",type:"string",label:"Country"},{name:"phone",type:"string",label:"Phone"},{name:"email",type:"string",label:"Email"},{name:"website",type:"string",label:"Website"},{name:"contactName",type:"string",label:"Primary Contact"},{name:"contactPhone",type:"string",label:"Contact Phone"},{name:"contactEmail",type:"string",label:"Contact Email"},{name:"defaultTerms",type:"string",label:"Default Terms"},{name:"defaultPaymentMethod",type:"enum",enum:["check","ach","wire","credit-card"],label:"Default Payment Method"},{name:"is1099",type:"boolean",label:"1099 Vendor"},{name:"form1099Type",type:"enum",enum:["MISC","NEC","INT","DIV","R","S"],label:"1099 Form Type"},{name:"insuranceRequired",type:"boolean",label:"Insurance Required"},{name:"bondRequired",type:"boolean",label:"Bond Required"},{name:"entityId",type:"id",label:"Entity"},{name:"notes",type:"string",label:"Notes"},{name:"ytdPayments",type:"currency",label:"YTD Payments"},{name:"ytd1099Amount",type:"currency",label:"YTD 1099 Amount"}],relations:[{foreignKey:"entityId",collection:"entity/entity",type:"belongsTo",cascade:"nullify"}]},{collection:"ap/invoice",module:"ap",version:2,fields:[{name:"vendorId",type:"id",required:!0,label:"Vendor"},{name:"invoiceNumber",type:"string",required:!0,label:"Invoice Number"},{name:"invoiceDate",type:"date",required:!0,label:"Invoice Date"},{name:"dueDate",type:"date",label:"Due Date"},{name:"receivedDate",type:"date",label:"Received Date"},{name:"terms",type:"string",label:"Payment Terms"},{name:"description",type:"string",label:"Description"},{name:"amount",type:"currency",required:!0,label:"Amount"},{name:"taxAmount",type:"currency",label:"Tax Amount"},{name:"retentionAmount",type:"currency",label:"Retention Amount"},{name:"netAmount",type:"currency",label:"Net Amount"},{name:"paidAmount",type:"currency",label:"Paid Amount"},{name:"balanceDue",type:"currency",label:"Balance Due"},{name:"status",type:"enum",enum:["draft","pending","approved","partial","paid","voided"],label:"Status"},{name:"approvedBy",type:"string",label:"Approved By"},{name:"approvedAt",type:"date",label:"Approved At"},{name:"jobId",type:"id",label:"Job"},{name:"entityId",type:"id",label:"Entity"},{name:"duplicateFlag",type:"boolean",label:"Possible Duplicate"},{name:"duplicateOfId",type:"id",label:"Duplicate Of"}],relations:[{foreignKey:"vendorId",collection:"ap/vendor",type:"belongsTo",cascade:"restrict"},{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"nullify"},{foreignKey:"entityId",collection:"entity/entity",type:"belongsTo",cascade:"nullify"}]},{collection:"ap/invoiceLine",module:"ap",version:2,fields:[{name:"invoiceId",type:"id",required:!0,label:"Invoice"},{name:"description",type:"string",label:"Description"},{name:"amount",type:"currency",required:!0,label:"Amount"},{name:"jobId",type:"id",label:"Job"},{name:"costCodeId",type:"id",label:"Cost Code"},{name:"costType",type:"enum",enum:["labor","material","subcontract","equipment","other","overhead"],label:"Cost Type"},{name:"glAccountId",type:"id",label:"GL Account"},{name:"quantity",type:"number",label:"Quantity"},{name:"unitCost",type:"currency",label:"Unit Cost"}],relations:[{foreignKey:"invoiceId",collection:"ap/invoice",type:"belongsTo",cascade:"cascade"},{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"nullify"},{foreignKey:"costCodeId",collection:"job/costCode",type:"belongsTo",cascade:"nullify"},{foreignKey:"glAccountId",collection:"gl/account",type:"belongsTo",cascade:"nullify"}]},{collection:"ap/payment",module:"ap",version:2,fields:[{name:"vendorId",type:"id",required:!0,label:"Vendor"},{name:"date",type:"date",required:!0,label:"Payment Date"},{name:"amount",type:"currency",required:!0,label:"Amount"},{name:"method",type:"enum",enum:["check","ach","wire","credit-card"],label:"Method"},{name:"referenceNumber",type:"string",label:"Reference Number"},{name:"memo",type:"string",label:"Memo"},{name:"entityId",type:"id",label:"Entity"},{name:"status",type:"enum",enum:["pending","processed","voided"],label:"Status"}],relations:[{foreignKey:"vendorId",collection:"ap/vendor",type:"belongsTo",cascade:"restrict"},{foreignKey:"entityId",collection:"entity/entity",type:"belongsTo",cascade:"nullify"}]},{collection:"ap/paymentLine",module:"ap",version:2,fields:[{name:"paymentId",type:"id",required:!0,label:"Payment"},{name:"invoiceId",type:"id",required:!0,label:"Invoice"},{name:"amount",type:"currency",required:!0,label:"Amount Applied"},{name:"retentionAmount",type:"currency",label:"Retention Amount"},{name:"discountAmount",type:"currency",label:"Discount Amount"}],relations:[{foreignKey:"paymentId",collection:"ap/payment",type:"belongsTo",cascade:"cascade"},{foreignKey:"invoiceId",collection:"ap/invoice",type:"belongsTo",cascade:"restrict"}]},{collection:"ap/lienWaiver",module:"ap",version:2,fields:[{name:"vendorId",type:"id",required:!0,label:"Vendor"},{name:"jobId",type:"id",label:"Job"},{name:"type",type:"enum",enum:["conditional_partial","unconditional_partial","conditional_final","unconditional_final"],label:"Waiver Type"},{name:"status",type:"enum",enum:["requested","received","expired"],label:"Status"},{name:"amount",type:"currency",label:"Through Amount"},{name:"throughDate",type:"date",label:"Through Date"},{name:"receivedDate",type:"date",label:"Received Date"},{name:"paymentId",type:"id",label:"Associated Payment"},{name:"description",type:"string",label:"Description"}],relations:[{foreignKey:"vendorId",collection:"ap/vendor",type:"belongsTo",cascade:"restrict"},{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"nullify"},{foreignKey:"paymentId",collection:"ap/payment",type:"belongsTo",cascade:"nullify"}]},{collection:"ap/complianceCert",module:"ap",version:2,fields:[{name:"vendorId",type:"id",required:!0,label:"Vendor"},{name:"certType",type:"enum",enum:["insurance_gl","insurance_auto","insurance_umbrella","insurance_wc","license","bond","other"],required:!0,label:"Certificate Type"},{name:"policyNumber",type:"string",label:"Policy/License Number"},{name:"carrier",type:"string",label:"Carrier / Issuer"},{name:"agent",type:"string",label:"Agent"},{name:"effectiveDate",type:"date",label:"Effective Date"},{name:"expirationDate",type:"date",label:"Expiration Date"},{name:"coverageAmount",type:"currency",label:"Coverage Amount"},{name:"status",type:"enum",enum:["valid","expired","pending","revoked"],label:"Status"},{name:"jobId",type:"id",label:"Job"}],relations:[{foreignKey:"vendorId",collection:"ap/vendor",type:"belongsTo",cascade:"cascade"},{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"nullify"}]},{collection:"ap/retention",module:"ap",version:2,fields:[{name:"invoiceId",type:"id",required:!0,label:"Invoice"},{name:"vendorId",type:"id",required:!0,label:"Vendor"},{name:"jobId",type:"id",label:"Job"},{name:"amount",type:"currency",required:!0,label:"Retained Amount"},{name:"retentionPct",type:"number",label:"Retention %"},{name:"releasedAmount",type:"currency",label:"Released Amount"},{name:"remainingAmount",type:"currency",label:"Remaining Amount"},{name:"releaseDate",type:"date",label:"Release Date"},{name:"status",type:"enum",enum:["held","partial","released"],label:"Status"}],relations:[{foreignKey:"invoiceId",collection:"ap/invoice",type:"belongsTo",cascade:"cascade"},{foreignKey:"vendorId",collection:"ap/vendor",type:"belongsTo",cascade:"restrict"},{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"nullify"}]}],Pe=[{collection:"ar/customer",module:"ar",version:2,fields:[{name:"name",type:"string",required:!0,label:"Customer Name"},{name:"code",type:"string",label:"Customer Code"},{name:"status",type:"enum",enum:["active","inactive","hold"],label:"Status"},{name:"contactName",type:"string",label:"Contact Name"},{name:"contactEmail",type:"string",label:"Contact Email"},{name:"contactPhone",type:"string",label:"Contact Phone"},{name:"address",type:"string",label:"Address"},{name:"city",type:"string",label:"City"},{name:"state",type:"string",label:"State"},{name:"zip",type:"string",label:"Zip"},{name:"creditLimit",type:"currency",label:"Credit Limit"},{name:"terms",type:"string",label:"Payment Terms"},{name:"entityId",type:"id",label:"Entity"},{name:"ytdBillings",type:"currency",label:"YTD Billings"},{name:"ytdPayments",type:"currency",label:"YTD Payments"}],relations:[{foreignKey:"entityId",collection:"entity/entity",type:"belongsTo",cascade:"nullify"}]},{collection:"ar/invoice",module:"ar",version:2,fields:[{name:"customerId",type:"id",required:!0,label:"Customer"},{name:"jobId",type:"id",label:"Job"},{name:"invoiceNumber",type:"string",required:!0,label:"Invoice Number"},{name:"invoiceDate",type:"date",required:!0,label:"Invoice Date"},{name:"dueDate",type:"date",label:"Due Date"},{name:"billingType",type:"enum",enum:["progress","tm","unit_price","cost_plus","lump_sum"],label:"Billing Type"},{name:"amount",type:"currency",required:!0,label:"Amount"},{name:"retainageAmount",type:"currency",label:"Retainage Amount"},{name:"taxAmount",type:"currency",label:"Tax Amount"},{name:"netAmount",type:"currency",label:"Net Amount"},{name:"paidAmount",type:"currency",label:"Paid Amount"},{name:"balanceDue",type:"currency",label:"Balance Due"},{name:"status",type:"enum",enum:["draft","sent","partial","paid","overdue","voided"],label:"Status"}],relations:[{foreignKey:"customerId",collection:"ar/customer",type:"belongsTo",cascade:"restrict"},{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"nullify"}]},{collection:"ar/invoiceLine",module:"ar",version:2,fields:[{name:"invoiceId",type:"id",required:!0,label:"Invoice"},{name:"description",type:"string",label:"Description"},{name:"quantity",type:"number",label:"Quantity"},{name:"unitPrice",type:"currency",label:"Unit Price"},{name:"amount",type:"currency",required:!0,label:"Amount"},{name:"costCodeId",type:"id",label:"Cost Code"},{name:"jobId",type:"id",label:"Job"},{name:"costType",type:"enum",enum:["labor","material","subcontract","equipment","other","overhead"],label:"Cost Type"},{name:"markupPct",type:"number",label:"Markup %"}],relations:[{foreignKey:"invoiceId",collection:"ar/invoice",type:"belongsTo",cascade:"cascade"},{foreignKey:"costCodeId",collection:"job/costCode",type:"belongsTo",cascade:"nullify"},{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"nullify"}]},{collection:"ar/payment",module:"ar",version:2,fields:[{name:"customerId",type:"id",required:!0,label:"Customer"},{name:"date",type:"date",required:!0,label:"Payment Date"},{name:"amount",type:"currency",required:!0,label:"Amount"},{name:"method",type:"enum",enum:["check","ach","wire","credit-card"],label:"Method"},{name:"referenceNumber",type:"string",label:"Reference Number"},{name:"memo",type:"string",label:"Memo"},{name:"status",type:"enum",enum:["pending","applied","voided"],label:"Status"}],relations:[{foreignKey:"customerId",collection:"ar/customer",type:"belongsTo",cascade:"restrict"}]},{collection:"ar/aiaApplication",module:"ar",version:2,fields:[{name:"jobId",type:"id",required:!0,label:"Job"},{name:"applicationNumber",type:"number",required:!0,label:"Application Number"},{name:"periodTo",type:"date",label:"Period To"},{name:"contractSum",type:"currency",label:"Original Contract Sum"},{name:"changeOrderTotal",type:"currency",label:"Change Order Total"},{name:"completedPreviousPeriod",type:"currency",label:"Completed Previous Period"},{name:"completedThisPeriod",type:"currency",label:"Completed This Period"},{name:"materialStored",type:"currency",label:"Materials Presently Stored"},{name:"totalCompleted",type:"currency",label:"Total Completed and Stored"},{name:"retainagePct",type:"number",label:"Retainage %"},{name:"retainageAmount",type:"currency",label:"Retainage Amount"},{name:"status",type:"enum",enum:["draft","submitted","approved","paid"],label:"Status"}],relations:[{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"restrict"}]},{collection:"ar/retainage",module:"ar",version:2,fields:[{name:"invoiceId",type:"id",required:!0,label:"Invoice"},{name:"customerId",type:"id",required:!0,label:"Customer"},{name:"jobId",type:"id",label:"Job"},{name:"amount",type:"currency",required:!0,label:"Retainage Amount"},{name:"pct",type:"number",label:"Retainage %"},{name:"releasedAmount",type:"currency",label:"Released Amount"},{name:"remainingAmount",type:"currency",label:"Remaining Amount"},{name:"status",type:"enum",enum:["held","partial","released"],label:"Status"}],relations:[{foreignKey:"invoiceId",collection:"ar/invoice",type:"belongsTo",cascade:"cascade"},{foreignKey:"customerId",collection:"ar/customer",type:"belongsTo",cascade:"restrict"},{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"nullify"}]},{collection:"ar/billingSchedule",module:"ar",version:2,fields:[{name:"jobId",type:"id",required:!0,label:"Job"},{name:"customerId",type:"id",required:!0,label:"Customer"},{name:"name",type:"string",required:!0,label:"Schedule Name"},{name:"frequency",type:"enum",enum:["monthly","milestone","progress"],label:"Frequency"},{name:"billingType",type:"enum",enum:["progress","tm","unit_price","cost_plus","lump_sum"],label:"Billing Type"},{name:"startDate",type:"date",label:"Start Date"},{name:"endDate",type:"date",label:"End Date"}],relations:[{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"cascade"},{foreignKey:"customerId",collection:"ar/customer",type:"belongsTo",cascade:"restrict"}]},{collection:"ar/billingMilestone",module:"ar",version:2,fields:[{name:"scheduleId",type:"id",required:!0,label:"Billing Schedule"},{name:"description",type:"string",required:!0,label:"Milestone Description"},{name:"amount",type:"currency",required:!0,label:"Amount"},{name:"dueDate",type:"date",label:"Due Date"},{name:"percentOfContract",type:"number",label:"% of Contract"},{name:"status",type:"enum",enum:["pending","reached","billed","paid"],label:"Status"}],relations:[{foreignKey:"scheduleId",collection:"ar/billingSchedule",type:"belongsTo",cascade:"cascade"}]}],Re=[{collection:"payroll/employee",module:"payroll",version:2,fields:[{name:"firstName",type:"string",required:!0,label:"First Name"},{name:"lastName",type:"string",required:!0,label:"Last Name"},{name:"middleName",type:"string",label:"Middle Name"},{name:"ssn",type:"string",required:!0,label:"SSN"},{name:"status",type:"enum",enum:["active","inactive","terminated"],required:!0,label:"Status"},{name:"hireDate",type:"date",required:!0,label:"Hire Date"},{name:"terminationDate",type:"date",label:"Termination Date"},{name:"department",type:"string",label:"Department"},{name:"jobTitle",type:"string",label:"Job Title"},{name:"payType",type:"enum",enum:["hourly","salary"],required:!0,label:"Pay Type"},{name:"payRate",type:"currency",required:!0,label:"Pay Rate"},{name:"payFrequency",type:"enum",enum:["weekly","biweekly","semimonthly","monthly"],required:!0,label:"Pay Frequency"},{name:"federalFilingStatus",type:"string",label:"Federal Filing Status"},{name:"stateFilingStatus",type:"string",label:"State Filing Status"},{name:"allowances",type:"number",label:"Allowances"},{name:"entityId",type:"id",label:"Entity"},{name:"unionId",type:"string",label:"Union Affiliation"},{name:"wcClassCode",type:"string",label:"WC Class Code"},{name:"address",type:"string",label:"Address"},{name:"city",type:"string",label:"City"},{name:"state",type:"string",label:"State"},{name:"zip",type:"string",label:"ZIP Code"},{name:"phone",type:"string",label:"Phone"},{name:"email",type:"string",label:"Email"},{name:"emergencyContact",type:"string",label:"Emergency Contact"}],relations:[{foreignKey:"entityId",collection:"entity/entity",type:"belongsTo",cascade:"nullify"}],indexes:[{fields:["ssn"],unique:!0,name:"idx_employee_ssn"},{fields:["status"],name:"idx_employee_status"},{fields:["entityId"],name:"idx_employee_entity"},{fields:["department"],name:"idx_employee_department"}]},{collection:"payroll/timeEntry",module:"payroll",version:2,fields:[{name:"employeeId",type:"id",required:!0,label:"Employee"},{name:"jobId",type:"id",label:"Job"},{name:"costCodeId",type:"id",label:"Cost Code"},{name:"date",type:"date",required:!0,label:"Date"},{name:"hours",type:"number",required:!0,label:"Hours"},{name:"payType",type:"enum",enum:["regular","overtime","doubletime","premium","perdiem"],required:!0,label:"Pay Type"},{name:"workClassification",type:"string",label:"Work Classification"},{name:"description",type:"string",label:"Description"},{name:"approved",type:"boolean",label:"Approved"},{name:"approvedBy",type:"string",label:"Approved By"}],relations:[{foreignKey:"employeeId",collection:"payroll/employee",type:"belongsTo",cascade:"restrict"},{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"nullify"}],indexes:[{fields:["employeeId"],name:"idx_timeEntry_employee"},{fields:["jobId"],name:"idx_timeEntry_job"},{fields:["date"],name:"idx_timeEntry_date"},{fields:["approved"],name:"idx_timeEntry_approved"}]},{collection:"payroll/payRun",module:"payroll",version:2,fields:[{name:"periodStart",type:"date",required:!0,label:"Period Start"},{name:"periodEnd",type:"date",required:!0,label:"Period End"},{name:"payDate",type:"date",required:!0,label:"Pay Date"},{name:"status",type:"enum",enum:["draft","processing","completed","voided"],required:!0,label:"Status"},{name:"totalGross",type:"currency",label:"Total Gross"},{name:"totalNet",type:"currency",label:"Total Net"},{name:"totalTaxes",type:"currency",label:"Total Taxes"},{name:"totalDeductions",type:"currency",label:"Total Deductions"},{name:"employeeCount",type:"number",label:"Employee Count"},{name:"entityId",type:"id",label:"Entity"}],relations:[{foreignKey:"entityId",collection:"entity/entity",type:"belongsTo",cascade:"nullify"}],indexes:[{fields:["status"],name:"idx_payRun_status"},{fields:["payDate"],name:"idx_payRun_payDate"},{fields:["entityId"],name:"idx_payRun_entity"}]},{collection:"payroll/payCheck",module:"payroll",version:2,fields:[{name:"payRunId",type:"id",required:!0,label:"Pay Run"},{name:"employeeId",type:"id",required:!0,label:"Employee"},{name:"grossPay",type:"currency",required:!0,label:"Gross Pay"},{name:"federalTax",type:"currency",label:"Federal Tax"},{name:"stateTax",type:"currency",label:"State Tax"},{name:"localTax",type:"currency",label:"Local Tax"},{name:"ficaSS",type:"currency",label:"FICA SS"},{name:"ficaMed",type:"currency",label:"FICA Medicare"},{name:"totalDeductions",type:"currency",label:"Total Deductions"},{name:"netPay",type:"currency",required:!0,label:"Net Pay"},{name:"hours",type:"number",label:"Regular Hours"},{name:"overtimeHours",type:"number",label:"Overtime Hours"}],relations:[{foreignKey:"payRunId",collection:"payroll/payRun",type:"belongsTo",cascade:"cascade"},{foreignKey:"employeeId",collection:"payroll/employee",type:"belongsTo",cascade:"restrict"}],indexes:[{fields:["payRunId"],name:"idx_payCheck_payRun"},{fields:["employeeId"],name:"idx_payCheck_employee"}]},{collection:"payroll/earning",module:"payroll",version:2,fields:[{name:"name",type:"string",required:!0,label:"Earning Name"},{name:"code",type:"string",required:!0,label:"Earning Code"},{name:"type",type:"enum",enum:["regular","overtime","doubletime","premium","perdiem","piecerate","commission"],required:!0,label:"Earning Type"},{name:"multiplier",type:"number",label:"Rate Multiplier"},{name:"isTaxable",type:"boolean",label:"Is Taxable"},{name:"isOvertime",type:"boolean",label:"Is Overtime"}],relations:[],indexes:[{fields:["code"],unique:!0,name:"idx_earning_code"},{fields:["type"],name:"idx_earning_type"}]},{collection:"payroll/deduction",module:"payroll",version:2,fields:[{name:"name",type:"string",required:!0,label:"Deduction Name"},{name:"code",type:"string",required:!0,label:"Deduction Code"},{name:"type",type:"enum",enum:["pretax","posttax","garnishment"],required:!0,label:"Deduction Type"},{name:"method",type:"enum",enum:["flat","percent"],required:!0,label:"Calculation Method"},{name:"amount",type:"currency",required:!0,label:"Amount"},{name:"maxPerPeriod",type:"currency",label:"Max Per Period"},{name:"maxPerYear",type:"currency",label:"Max Per Year"}],relations:[],indexes:[{fields:["code"],unique:!0,name:"idx_deduction_code"},{fields:["type"],name:"idx_deduction_type"}]},{collection:"payroll/benefit",module:"payroll",version:2,fields:[{name:"name",type:"string",required:!0,label:"Benefit Name"},{name:"code",type:"string",required:!0,label:"Benefit Code"},{name:"type",type:"enum",enum:["health","dental","vision","life","retirement","hsa","fsa","other"],required:!0,label:"Benefit Type"},{name:"employeeContribution",type:"currency",label:"Employee Contribution"},{name:"employerContribution",type:"currency",label:"Employer Contribution"},{name:"method",type:"enum",enum:["flat","percent"],required:!0,label:"Calculation Method"}],relations:[],indexes:[{fields:["code"],unique:!0,name:"idx_benefit_code"},{fields:["type"],name:"idx_benefit_type"}]},{collection:"payroll/taxTable",module:"payroll",version:2,fields:[{name:"jurisdiction",type:"enum",enum:["federal","state","local"],required:!0,label:"Jurisdiction"},{name:"state",type:"string",label:"State"},{name:"locality",type:"string",label:"Locality"},{name:"year",type:"number",required:!0,label:"Tax Year"},{name:"type",type:"enum",enum:["income","fica_ss","fica_med","futa","suta"],required:!0,label:"Tax Type"},{name:"rate",type:"percentage",required:!0,label:"Rate"},{name:"wageBase",type:"currency",label:"Wage Base"},{name:"filingStatus",type:"string",label:"Filing Status"}],relations:[],indexes:[{fields:["jurisdiction","type","year"],name:"idx_taxTable_jurisdiction_type_year"},{fields:["state"],name:"idx_taxTable_state"}]},{collection:"payroll/taxFiling",module:"payroll",version:2,fields:[{name:"type",type:"enum",enum:["941","940","w2","state_quarterly"],required:!0,label:"Filing Type"},{name:"period",type:"string",required:!0,label:"Period"},{name:"year",type:"number",required:!0,label:"Tax Year"},{name:"quarter",type:"number",label:"Quarter"},{name:"status",type:"enum",enum:["draft","filed"],required:!0,label:"Status"},{name:"totalWages",type:"currency",label:"Total Wages"},{name:"totalTax",type:"currency",label:"Total Tax"},{name:"dueDate",type:"date",label:"Due Date"}],relations:[],indexes:[{fields:["type","year","quarter"],name:"idx_taxFiling_type_year_quarter"},{fields:["status"],name:"idx_taxFiling_status"}]},{collection:"payroll/workerComp",module:"payroll",version:2,fields:[{name:"classCode",type:"string",required:!0,label:"Class Code"},{name:"description",type:"string",label:"Description"},{name:"rate",type:"percentage",required:!0,label:"Rate"},{name:"stateCode",type:"string",label:"State Code"},{name:"effectiveDate",type:"date",label:"Effective Date"},{name:"expirationDate",type:"date",label:"Expiration Date"}],relations:[],indexes:[{fields:["classCode"],name:"idx_workerComp_classCode"},{fields:["stateCode"],name:"idx_workerComp_state"}]}],Ke=[{collection:"union/union",module:"union",version:2,fields:[{name:"name",type:"string",required:!0,label:"Union Name"},{name:"localNumber",type:"string",required:!0,label:"Local Number"},{name:"trade",type:"string",required:!0,label:"Trade"},{name:"jurisdiction",type:"string",label:"Jurisdiction"},{name:"contactName",type:"string",label:"Contact Name"},{name:"contactPhone",type:"string",label:"Contact Phone"},{name:"contactEmail",type:"string",label:"Contact Email"},{name:"address",type:"string",label:"Address"},{name:"city",type:"string",label:"City"},{name:"state",type:"string",label:"State"},{name:"zip",type:"string",label:"ZIP"},{name:"status",type:"enum",enum:["active","inactive"],required:!0,label:"Status"}],relations:[],indexes:[{fields:["localNumber"],unique:!0,name:"idx_union_localNumber"},{fields:["trade"],name:"idx_union_trade"},{fields:["status"],name:"idx_union_status"}]},{collection:"union/rateTable",module:"union",version:2,fields:[{name:"unionId",type:"id",required:!0,label:"Union"},{name:"name",type:"string",required:!0,label:"Rate Table Name"},{name:"effectiveDate",type:"date",required:!0,label:"Effective Date"},{name:"expirationDate",type:"date",label:"Expiration Date"},{name:"classification",type:"string",required:!0,label:"Classification"},{name:"journeymanRate",type:"currency",label:"Journeyman Rate"},{name:"apprenticePct",type:"percentage",label:"Apprentice Percentage"},{name:"status",type:"enum",enum:["active","expired"],required:!0,label:"Status"}],relations:[{foreignKey:"unionId",collection:"union/union",type:"belongsTo",cascade:"cascade"}],indexes:[{fields:["unionId","classification","effectiveDate"],name:"idx_rateTable_lookup"},{fields:["status"],name:"idx_rateTable_status"}]},{collection:"union/rateTableLine",module:"union",version:2,fields:[{name:"rateTableId",type:"id",required:!0,label:"Rate Table"},{name:"category",type:"enum",enum:["base_wage","fringe","vacation","training","pension","annuity","health","other"],required:!0,label:"Category"},{name:"description",type:"string",label:"Description"},{name:"rate",type:"currency",required:!0,label:"Rate"},{name:"method",type:"enum",enum:["hourly","percent","flat"],required:!0,label:"Method"},{name:"payableTo",type:"enum",enum:["employee","fund"],required:!0,label:"Payable To"},{name:"fundName",type:"string",label:"Fund Name"}],relations:[{foreignKey:"rateTableId",collection:"union/rateTable",type:"belongsTo",cascade:"cascade"}],indexes:[{fields:["rateTableId"],name:"idx_rateTableLine_rateTableId"},{fields:["category"],name:"idx_rateTableLine_category"}]},{collection:"union/fringeBenefit",module:"union",version:2,fields:[{name:"unionId",type:"id",required:!0,label:"Union"},{name:"name",type:"string",required:!0,label:"Benefit Name"},{name:"rate",type:"currency",required:!0,label:"Rate"},{name:"method",type:"enum",enum:["hourly","percent"],required:!0,label:"Method"},{name:"payableTo",type:"enum",enum:["employee","fund"],required:!0,label:"Payable To"},{name:"allocationMethod",type:"enum",enum:["cash","plan","split"],required:!0,label:"Allocation Method"},{name:"fundName",type:"string",label:"Fund Name"},{name:"fundAddress",type:"string",label:"Fund Address"},{name:"fundAccountNumber",type:"string",label:"Fund Account Number"}],relations:[{foreignKey:"unionId",collection:"union/union",type:"belongsTo",cascade:"cascade"}],indexes:[{fields:["unionId"],name:"idx_fringeBenefit_unionId"}]},{collection:"union/prevailingWage",module:"union",version:2,fields:[{name:"jurisdiction",type:"string",required:!0,label:"Jurisdiction"},{name:"state",type:"string",required:!0,label:"State"},{name:"county",type:"string",label:"County"},{name:"projectType",type:"enum",enum:["federal","state","local"],required:!0,label:"Project Type"},{name:"classification",type:"string",required:!0,label:"Classification"},{name:"trade",type:"string",required:!0,label:"Trade"},{name:"baseRate",type:"currency",required:!0,label:"Base Rate"},{name:"fringeRate",type:"currency",required:!0,label:"Fringe Rate"},{name:"totalRate",type:"currency",required:!0,label:"Total Rate"},{name:"effectiveDate",type:"date",required:!0,label:"Effective Date"},{name:"expirationDate",type:"date",label:"Expiration Date"},{name:"source",type:"enum",enum:["davis_bacon","state","local"],required:!0,label:"Source"}],relations:[],indexes:[{fields:["jurisdiction","classification","effectiveDate"],name:"idx_prevWage_lookup"},{fields:["state","county"],name:"idx_prevWage_location"},{fields:["source"],name:"idx_prevWage_source"}]},{collection:"union/certifiedPayroll",module:"union",version:2,fields:[{name:"jobId",type:"id",required:!0,label:"Job"},{name:"weekEndingDate",type:"date",required:!0,label:"Week Ending Date"},{name:"contractorName",type:"string",required:!0,label:"Contractor Name"},{name:"projectName",type:"string",required:!0,label:"Project Name"},{name:"projectNumber",type:"string",label:"Project Number"},{name:"reportNumber",type:"string",label:"Report Number"},{name:"status",type:"enum",enum:["draft","submitted","approved"],required:!0,label:"Status"},{name:"totalGross",type:"currency",required:!0,label:"Total Gross"},{name:"totalFringe",type:"currency",required:!0,label:"Total Fringe"},{name:"totalNet",type:"currency",required:!0,label:"Total Net"}],relations:[{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"restrict"}],indexes:[{fields:["jobId","weekEndingDate"],name:"idx_certPayroll_jobWeek"},{fields:["status"],name:"idx_certPayroll_status"}]},{collection:"union/apprentice",module:"union",version:2,fields:[{name:"employeeId",type:"id",required:!0,label:"Employee"},{name:"unionId",type:"id",required:!0,label:"Union"},{name:"trade",type:"string",required:!0,label:"Trade"},{name:"startDate",type:"date",required:!0,label:"Start Date"},{name:"periodNumber",type:"number",required:!0,label:"Period Number"},{name:"totalPeriods",type:"number",required:!0,label:"Total Periods"},{name:"currentRatio",type:"number",label:"Current Ratio"},{name:"requiredRatio",type:"number",label:"Required Ratio"},{name:"status",type:"enum",enum:["active","completed","terminated"],required:!0,label:"Status"}],relations:[{foreignKey:"employeeId",collection:"payroll/employee",type:"belongsTo",cascade:"restrict"},{foreignKey:"unionId",collection:"union/union",type:"belongsTo",cascade:"restrict"}],indexes:[{fields:["employeeId"],name:"idx_apprentice_employeeId"},{fields:["unionId"],name:"idx_apprentice_unionId"},{fields:["status"],name:"idx_apprentice_status"}]},{collection:"union/remittance",module:"union",version:2,fields:[{name:"unionId",type:"id",required:!0,label:"Union"},{name:"periodStart",type:"date",required:!0,label:"Period Start"},{name:"periodEnd",type:"date",required:!0,label:"Period End"},{name:"dueDate",type:"date",label:"Due Date"},{name:"totalHours",type:"number",required:!0,label:"Total Hours"},{name:"totalAmount",type:"currency",required:!0,label:"Total Amount"},{name:"status",type:"enum",enum:["draft","submitted","paid"],required:!0,label:"Status"},{name:"employeeCount",type:"number",label:"Employee Count"}],relations:[{foreignKey:"unionId",collection:"union/union",type:"belongsTo",cascade:"restrict"}],indexes:[{fields:["unionId","periodEnd"],name:"idx_remittance_unionPeriod"},{fields:["status"],name:"idx_remittance_status"}]}],Me=[{collection:"equip/equipment",module:"equip",version:2,fields:[{name:"equipmentNumber",type:"string",required:!0,label:"Equipment Number"},{name:"description",type:"string",required:!0,label:"Description"},{name:"year",type:"number",label:"Year"},{name:"make",type:"string",label:"Make"},{name:"model",type:"string",label:"Model"},{name:"serialNumber",type:"string",label:"Serial Number"},{name:"vin",type:"string",label:"VIN"},{name:"licensePlate",type:"string",label:"License Plate"},{name:"category",type:"enum",enum:["owned","leased","rented","idle"],required:!0,label:"Category"},{name:"status",type:"enum",enum:["active","inactive","disposed"],required:!0,label:"Status"},{name:"entityId",type:"id",label:"Entity"},{name:"purchaseDate",type:"date",label:"Purchase Date"},{name:"purchasePrice",type:"currency",label:"Purchase Price"},{name:"currentValue",type:"currency",label:"Current Value"},{name:"salvageValue",type:"currency",label:"Salvage Value"},{name:"usefulLifeMonths",type:"number",label:"Useful Life (Months)"},{name:"depreciationMethod",type:"enum",enum:["straight_line","macrs","declining_balance"],label:"Depreciation Method"},{name:"assignedJobId",type:"id",label:"Assigned Job"},{name:"meterReading",type:"number",label:"Meter Reading"},{name:"meterUnit",type:"enum",enum:["hours","miles"],label:"Meter Unit"},{name:"locationDescription",type:"string",label:"Location Description"}],relations:[{foreignKey:"entityId",collection:"entity/entity",type:"belongsTo",cascade:"nullify"},{foreignKey:"assignedJobId",collection:"job/job",type:"belongsTo",cascade:"nullify"}],indexes:[{fields:["equipmentNumber"],unique:!0,name:"idx_equipment_number"},{fields:["category"],name:"idx_equipment_category"},{fields:["status"],name:"idx_equipment_status"}]},{collection:"equip/rateTable",module:"equip",version:2,fields:[{name:"equipmentId",type:"id",required:!0,label:"Equipment"},{name:"effectiveDate",type:"date",required:!0,label:"Effective Date"},{name:"hourlyRate",type:"currency",label:"Hourly Rate"},{name:"dailyRate",type:"currency",label:"Daily Rate"},{name:"weeklyRate",type:"currency",label:"Weekly Rate"},{name:"monthlyRate",type:"currency",label:"Monthly Rate"},{name:"operatorIncluded",type:"boolean",label:"Operator Included"},{name:"fhwaRate",type:"currency",label:"FHWA Rate"},{name:"notes",type:"string",label:"Notes"}],relations:[{foreignKey:"equipmentId",collection:"equip/equipment",type:"belongsTo",cascade:"cascade"}],indexes:[{fields:["equipmentId","effectiveDate"],name:"idx_rate_equip_date"}]},{collection:"equip/usage",module:"equip",version:2,fields:[{name:"equipmentId",type:"id",required:!0,label:"Equipment"},{name:"jobId",type:"id",label:"Job"},{name:"costCodeId",type:"id",label:"Cost Code"},{name:"date",type:"date",required:!0,label:"Date"},{name:"hours",type:"number",label:"Hours"},{name:"days",type:"number",label:"Days"},{name:"rate",type:"currency",label:"Rate"},{name:"amount",type:"currency",label:"Amount"},{name:"operatorId",type:"id",label:"Operator"},{name:"description",type:"string",label:"Description"},{name:"posted",type:"boolean",label:"Posted"}],relations:[{foreignKey:"equipmentId",collection:"equip/equipment",type:"belongsTo",cascade:"restrict"},{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"nullify"}],indexes:[{fields:["equipmentId","date"],name:"idx_usage_equip_date"},{fields:["jobId","date"],name:"idx_usage_job_date"},{fields:["posted"],name:"idx_usage_posted"}]},{collection:"equip/maintenance",module:"equip",version:2,fields:[{name:"equipmentId",type:"id",required:!0,label:"Equipment"},{name:"type",type:"enum",enum:["preventive","repair","inspection"],required:!0,label:"Maintenance Type"},{name:"description",type:"string",label:"Description"},{name:"scheduledDate",type:"date",label:"Scheduled Date"},{name:"completedDate",type:"date",label:"Completed Date"},{name:"cost",type:"currency",label:"Cost"},{name:"vendorId",type:"id",label:"Vendor"},{name:"meterAtService",type:"number",label:"Meter at Service"},{name:"nextServiceMeter",type:"number",label:"Next Service Meter"},{name:"nextServiceDate",type:"date",label:"Next Service Date"},{name:"status",type:"enum",enum:["scheduled","in_progress","completed","overdue"],required:!0,label:"Status"}],relations:[{foreignKey:"equipmentId",collection:"equip/equipment",type:"belongsTo",cascade:"cascade"},{foreignKey:"vendorId",collection:"ap/vendor",type:"belongsTo",cascade:"nullify"}],indexes:[{fields:["equipmentId","status"],name:"idx_maint_equip_status"},{fields:["scheduledDate"],name:"idx_maint_scheduled"}]},{collection:"equip/workOrder",module:"equip",version:2,fields:[{name:"equipmentId",type:"id",required:!0,label:"Equipment"},{name:"number",type:"string",required:!0,label:"Work Order Number"},{name:"description",type:"string",required:!0,label:"Description"},{name:"priority",type:"enum",enum:["low","medium","high","critical"],required:!0,label:"Priority"},{name:"assignedTo",type:"string",label:"Assigned To"},{name:"reportedDate",type:"date",label:"Reported Date"},{name:"completedDate",type:"date",label:"Completed Date"},{name:"laborHours",type:"number",label:"Labor Hours"},{name:"partsCost",type:"currency",label:"Parts Cost"},{name:"totalCost",type:"currency",label:"Total Cost"},{name:"status",type:"enum",enum:["open","in_progress","completed","cancelled"],required:!0,label:"Status"}],relations:[{foreignKey:"equipmentId",collection:"equip/equipment",type:"belongsTo",cascade:"cascade"}],indexes:[{fields:["equipmentId","status"],name:"idx_wo_equip_status"},{fields:["number"],unique:!0,name:"idx_wo_number"}]},{collection:"equip/fuelLog",module:"equip",version:2,fields:[{name:"equipmentId",type:"id",required:!0,label:"Equipment"},{name:"date",type:"date",required:!0,label:"Date"},{name:"gallons",type:"number",required:!0,label:"Gallons"},{name:"costPerGallon",type:"currency",label:"Cost Per Gallon"},{name:"totalCost",type:"currency",label:"Total Cost"},{name:"meterReading",type:"number",label:"Meter Reading"},{name:"locationDescription",type:"string",label:"Location"},{name:"vendorName",type:"string",label:"Vendor Name"}],relations:[{foreignKey:"equipmentId",collection:"equip/equipment",type:"belongsTo",cascade:"cascade"}],indexes:[{fields:["equipmentId","date"],name:"idx_fuel_equip_date"}]},{collection:"equip/depreciation",module:"equip",version:2,fields:[{name:"equipmentId",type:"id",required:!0,label:"Equipment"},{name:"periodStart",type:"date",required:!0,label:"Period Start"},{name:"periodEnd",type:"date",required:!0,label:"Period End"},{name:"method",type:"enum",enum:["straight_line","macrs","declining_balance"],required:!0,label:"Method"},{name:"beginningValue",type:"currency",label:"Beginning Value"},{name:"depreciationAmount",type:"currency",label:"Depreciation Amount"},{name:"accumulatedDepreciation",type:"currency",label:"Accumulated Depreciation"},{name:"endingValue",type:"currency",label:"Ending Value"}],relations:[{foreignKey:"equipmentId",collection:"equip/equipment",type:"belongsTo",cascade:"cascade"}],indexes:[{fields:["equipmentId","periodStart"],name:"idx_depr_equip_period"}]}],Le=[{collection:"sub/subcontract",module:"sub",version:2,fields:[{name:"vendorId",type:"id",required:!0,label:"Subcontractor (Vendor)"},{name:"jobId",type:"id",required:!0,label:"Job"},{name:"number",type:"string",required:!0,label:"Subcontract Number"},{name:"description",type:"string",label:"Description"},{name:"scope",type:"string",label:"Scope of Work"},{name:"contractAmount",type:"currency",required:!0,label:"Original Contract Amount"},{name:"retentionPct",type:"percentage",label:"Retention %"},{name:"startDate",type:"date",label:"Start Date"},{name:"endDate",type:"date",label:"End Date"},{name:"status",type:"enum",enum:["draft","active","complete","closed","terminated"],label:"Status"},{name:"approvedChangeOrders",type:"currency",label:"Approved Change Orders Total"},{name:"revisedAmount",type:"currency",label:"Revised Contract Amount"},{name:"billedToDate",type:"currency",label:"Billed to Date"},{name:"paidToDate",type:"currency",label:"Paid to Date"},{name:"retainageHeld",type:"currency",label:"Retainage Held"},{name:"entityId",type:"id",label:"Entity"}],relations:[{foreignKey:"vendorId",collection:"ap/vendor",type:"belongsTo",cascade:"restrict"},{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"restrict"}],indexes:[{fields:["jobId","number"],unique:!0,name:"idx_sub_job_number"},{fields:["vendorId"],name:"idx_sub_vendor"},{fields:["status"],name:"idx_sub_status"}]},{collection:"sub/changeOrder",module:"sub",version:2,fields:[{name:"subcontractId",type:"id",required:!0,label:"Subcontract"},{name:"number",type:"number",required:!0,label:"CO Number"},{name:"description",type:"string",required:!0,label:"Description"},{name:"amount",type:"currency",required:!0,label:"Amount"},{name:"type",type:"enum",enum:["addition","deduction","time_extension"],required:!0,label:"Type"},{name:"status",type:"enum",enum:["pending","approved","rejected"],label:"Status"},{name:"date",type:"date",required:!0,label:"Date"},{name:"approvedAt",type:"date",label:"Approved At"},{name:"approvedBy",type:"string",label:"Approved By"}],relations:[{foreignKey:"subcontractId",collection:"sub/subcontract",type:"belongsTo",cascade:"cascade"}],indexes:[{fields:["subcontractId","number"],unique:!0,name:"idx_co_sub_number"},{fields:["status"],name:"idx_co_status"}]},{collection:"sub/payApp",module:"sub",version:2,fields:[{name:"subcontractId",type:"id",required:!0,label:"Subcontract"},{name:"applicationNumber",type:"number",required:!0,label:"Application Number"},{name:"periodTo",type:"date",required:!0,label:"Period To"},{name:"previouslyBilled",type:"currency",label:"Previously Billed"},{name:"currentBilled",type:"currency",required:!0,label:"Current Billed"},{name:"materialStored",type:"currency",label:"Material Stored"},{name:"totalBilled",type:"currency",label:"Total Completed & Stored"},{name:"retainageAmount",type:"currency",label:"Retainage Amount"},{name:"netPayable",type:"currency",label:"Net Payable"},{name:"status",type:"enum",enum:["draft","submitted","approved","paid"],label:"Status"}],relations:[{foreignKey:"subcontractId",collection:"sub/subcontract",type:"belongsTo",cascade:"cascade"}],indexes:[{fields:["subcontractId","applicationNumber"],unique:!0,name:"idx_payapp_sub_appnum"},{fields:["status"],name:"idx_payapp_status"}]},{collection:"sub/backcharge",module:"sub",version:2,fields:[{name:"subcontractId",type:"id",required:!0,label:"Subcontract"},{name:"description",type:"string",required:!0,label:"Description"},{name:"amount",type:"currency",required:!0,label:"Amount"},{name:"date",type:"date",required:!0,label:"Date"},{name:"category",type:"string",label:"Category"},{name:"status",type:"enum",enum:["pending","approved","deducted"],label:"Status"},{name:"invoiceId",type:"id",label:"Related Invoice"}],relations:[{foreignKey:"subcontractId",collection:"sub/subcontract",type:"belongsTo",cascade:"cascade"}],indexes:[{fields:["subcontractId"],name:"idx_backcharge_sub"},{fields:["status"],name:"idx_backcharge_status"}]},{collection:"sub/prequalification",module:"sub",version:2,fields:[{name:"vendorId",type:"id",required:!0,label:"Subcontractor (Vendor)"},{name:"submittedDate",type:"date",label:"Submitted Date"},{name:"reviewedDate",type:"date",label:"Reviewed Date"},{name:"score",type:"number",label:"Qualification Score"},{name:"status",type:"enum",enum:["pending","approved","rejected","expired"],label:"Status"},{name:"emr",type:"number",label:"Experience Modification Rate (EMR)"},{name:"bondingCapacity",type:"currency",label:"Bonding Capacity"},{name:"yearsInBusiness",type:"number",label:"Years in Business"},{name:"revenueAvg3Year",type:"currency",label:"3-Year Avg Revenue"}],relations:[{foreignKey:"vendorId",collection:"ap/vendor",type:"belongsTo",cascade:"restrict"}],indexes:[{fields:["vendorId"],name:"idx_prequal_vendor"},{fields:["status"],name:"idx_prequal_status"}]},{collection:"sub/compliance",module:"sub",version:2,fields:[{name:"vendorId",type:"id",required:!0,label:"Subcontractor (Vendor)"},{name:"subcontractId",type:"id",label:"Subcontract"},{name:"type",type:"enum",enum:["insurance_gl","insurance_auto","insurance_umbrella","insurance_wc","license","bond","osha","everify","other"],required:!0,label:"Compliance Type"},{name:"status",type:"enum",enum:["valid","expired","pending","missing"],label:"Status"},{name:"documentId",type:"string",label:"Document Reference"},{name:"expirationDate",type:"date",label:"Expiration Date"},{name:"notes",type:"string",label:"Notes"}],relations:[{foreignKey:"vendorId",collection:"ap/vendor",type:"belongsTo",cascade:"restrict"},{foreignKey:"subcontractId",collection:"sub/subcontract",type:"belongsTo",cascade:"cascade"}],indexes:[{fields:["vendorId"],name:"idx_compliance_vendor"},{fields:["subcontractId"],name:"idx_compliance_sub"},{fields:["type","status"],name:"idx_compliance_type_status"},{fields:["expirationDate"],name:"idx_compliance_expiration"}]}],Be=[{collection:"po/purchaseOrder",module:"po",version:2,fields:[{name:"vendorId",type:"id",required:!0,label:"Vendor"},{name:"jobId",type:"id",label:"Job"},{name:"entityId",type:"id",label:"Entity"},{name:"poNumber",type:"string",required:!0,label:"PO Number"},{name:"type",type:"enum",enum:["standard","blanket","service"],required:!0,label:"PO Type"},{name:"description",type:"string",label:"Description"},{name:"amount",type:"currency",required:!0,label:"Amount"},{name:"taxAmount",type:"currency",label:"Tax Amount"},{name:"shippingAmount",type:"currency",label:"Shipping Amount"},{name:"totalAmount",type:"currency",label:"Total Amount"},{name:"status",type:"enum",enum:["draft","pending_approval","approved","partial_receipt","received","closed","cancelled"],required:!0,label:"Status"},{name:"terms",type:"string",label:"Terms"},{name:"shipTo",type:"string",label:"Ship To"},{name:"approvedBy",type:"string",label:"Approved By"},{name:"approvedAt",type:"date",label:"Approved At"},{name:"issuedDate",type:"date",label:"Issued Date"},{name:"expectedDate",type:"date",label:"Expected Date"}],relations:[{foreignKey:"vendorId",collection:"ap/vendor",type:"belongsTo",cascade:"restrict"},{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"nullify"},{foreignKey:"entityId",collection:"entity/entity",type:"belongsTo",cascade:"nullify"}],indexes:[{fields:["poNumber"],unique:!0,name:"idx_po_number"},{fields:["vendorId"],name:"idx_po_vendor"},{fields:["jobId"],name:"idx_po_job"},{fields:["status"],name:"idx_po_status"}]},{collection:"po/poLine",module:"po",version:2,fields:[{name:"purchaseOrderId",type:"id",required:!0,label:"Purchase Order"},{name:"lineNumber",type:"number",required:!0,label:"Line Number"},{name:"description",type:"string",required:!0,label:"Description"},{name:"costCodeId",type:"id",label:"Cost Code"},{name:"costType",type:"enum",enum:["labor","material","subcontract","equipment","other","overhead"],label:"Cost Type"},{name:"quantity",type:"number",required:!0,label:"Quantity"},{name:"unitCost",type:"currency",required:!0,label:"Unit Cost"},{name:"amount",type:"currency",required:!0,label:"Amount"},{name:"receivedQuantity",type:"number",label:"Received Quantity"},{name:"invoicedQuantity",type:"number",label:"Invoiced Quantity"},{name:"glAccountId",type:"id",label:"GL Account"}],relations:[{foreignKey:"purchaseOrderId",collection:"po/purchaseOrder",type:"belongsTo",cascade:"cascade"},{foreignKey:"costCodeId",collection:"job/costCode",type:"belongsTo",cascade:"nullify"},{foreignKey:"glAccountId",collection:"gl/account",type:"belongsTo",cascade:"nullify"}],indexes:[{fields:["purchaseOrderId"],name:"idx_poline_po"},{fields:["costCodeId"],name:"idx_poline_costcode"}]},{collection:"po/receipt",module:"po",version:2,fields:[{name:"purchaseOrderId",type:"id",required:!0,label:"Purchase Order"},{name:"receiptNumber",type:"string",required:!0,label:"Receipt Number"},{name:"receivedDate",type:"date",required:!0,label:"Received Date"},{name:"receivedBy",type:"string",label:"Received By"},{name:"notes",type:"string",label:"Notes"},{name:"status",type:"enum",enum:["partial","complete"],required:!0,label:"Status"}],relations:[{foreignKey:"purchaseOrderId",collection:"po/purchaseOrder",type:"belongsTo",cascade:"cascade"}],indexes:[{fields:["purchaseOrderId"],name:"idx_receipt_po"},{fields:["receiptNumber"],unique:!0,name:"idx_receipt_number"}]},{collection:"po/receiptLine",module:"po",version:2,fields:[{name:"receiptId",type:"id",required:!0,label:"Receipt"},{name:"poLineId",type:"id",required:!0,label:"PO Line"},{name:"quantity",type:"number",required:!0,label:"Quantity Received"},{name:"description",type:"string",label:"Description"},{name:"condition",type:"enum",enum:["good","damaged","rejected"],required:!0,label:"Condition"}],relations:[{foreignKey:"receiptId",collection:"po/receipt",type:"belongsTo",cascade:"cascade"},{foreignKey:"poLineId",collection:"po/poLine",type:"belongsTo",cascade:"restrict"}],indexes:[{fields:["receiptId"],name:"idx_receiptline_receipt"},{fields:["poLineId"],name:"idx_receiptline_poline"}]},{collection:"po/amendment",module:"po",version:2,fields:[{name:"purchaseOrderId",type:"id",required:!0,label:"Purchase Order"},{name:"amendmentNumber",type:"number",required:!0,label:"Amendment Number"},{name:"description",type:"string",label:"Description"},{name:"amountChange",type:"currency",required:!0,label:"Amount Change"},{name:"newTotal",type:"currency",required:!0,label:"New Total"},{name:"reason",type:"string",label:"Reason"},{name:"status",type:"enum",enum:["pending","approved","rejected"],required:!0,label:"Status"},{name:"approvedBy",type:"string",label:"Approved By"},{name:"approvedAt",type:"date",label:"Approved At"}],relations:[{foreignKey:"purchaseOrderId",collection:"po/purchaseOrder",type:"belongsTo",cascade:"cascade"}],indexes:[{fields:["purchaseOrderId"],name:"idx_amendment_po"},{fields:["status"],name:"idx_amendment_status"}]}],$e=[{collection:"doc/document",module:"doc",version:2,fields:[{name:"title",type:"string",required:!0,label:"Title"},{name:"category",type:"enum",required:!0,enum:["contract","change_order","rfi","submittal","drawing","photo","report","correspondence","insurance","permit","other"],label:"Category"},{name:"description",type:"string",label:"Description"},{name:"fileName",type:"string",label:"File Name"},{name:"fileSize",type:"number",label:"File Size (bytes)"},{name:"mimeType",type:"string",label:"MIME Type"},{name:"jobId",type:"id",label:"Job"},{name:"entityId",type:"id",label:"Entity"},{name:"vendorId",type:"id",label:"Vendor"},{name:"employeeId",type:"id",label:"Employee"},{name:"tags",type:"array",label:"Tags"},{name:"expirationDate",type:"date",label:"Expiration Date"},{name:"status",type:"enum",enum:["active","archived","expired"],label:"Status"},{name:"uploadedBy",type:"string",label:"Uploaded By"},{name:"uploadedAt",type:"date",label:"Uploaded At"}],relations:[{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"nullify"},{foreignKey:"entityId",collection:"entity/entity",type:"belongsTo",cascade:"nullify"},{foreignKey:"vendorId",collection:"ap/vendor",type:"belongsTo",cascade:"nullify"},{foreignKey:"employeeId",collection:"payroll/employee",type:"belongsTo",cascade:"nullify"}],indexes:[{fields:["category"],name:"idx_doc_category"},{fields:["jobId"],name:"idx_doc_job"},{fields:["entityId"],name:"idx_doc_entity"},{fields:["vendorId"],name:"idx_doc_vendor"},{fields:["status"],name:"idx_doc_status"},{fields:["expirationDate"],name:"idx_doc_expiration"}]},{collection:"doc/revision",module:"doc",version:2,fields:[{name:"documentId",type:"id",required:!0,label:"Document"},{name:"revisionNumber",type:"number",required:!0,label:"Revision Number"},{name:"description",type:"string",label:"Change Description"},{name:"fileName",type:"string",label:"File Name"},{name:"fileSize",type:"number",label:"File Size (bytes)"},{name:"uploadedBy",type:"string",label:"Uploaded By"},{name:"uploadedAt",type:"date",label:"Uploaded At"},{name:"notes",type:"string",label:"Notes"}],relations:[{foreignKey:"documentId",collection:"doc/document",type:"belongsTo",cascade:"cascade"}],indexes:[{fields:["documentId"],name:"idx_revision_document"},{fields:["documentId","revisionNumber"],unique:!0,name:"idx_revision_unique"}]},{collection:"doc/template",module:"doc",version:2,fields:[{name:"name",type:"string",required:!0,label:"Template Name"},{name:"category",type:"enum",enum:["contract","change_order","rfi","submittal","drawing","photo","report","correspondence","insurance","permit","lien_waiver","aia_form","other"],label:"Category"},{name:"description",type:"string",label:"Description"},{name:"content",type:"string",label:"Template Content"},{name:"variables",type:"array",label:"Template Variables (JSON)"},{name:"isActive",type:"boolean",label:"Is Active"}],relations:[],indexes:[{fields:["category"],name:"idx_template_category"},{fields:["isActive"],name:"idx_template_active"}]},{collection:"doc/transmittal",module:"doc",version:2,fields:[{name:"number",type:"string",required:!0,label:"Transmittal Number"},{name:"jobId",type:"id",label:"Job"},{name:"toName",type:"string",required:!0,label:"To Name"},{name:"toCompany",type:"string",label:"To Company"},{name:"fromName",type:"string",label:"From Name"},{name:"date",type:"date",required:!0,label:"Date"},{name:"subject",type:"string",label:"Subject"},{name:"notes",type:"string",label:"Notes"},{name:"status",type:"enum",enum:["draft","sent","acknowledged"],label:"Status"},{name:"items",type:"array",label:"Document IDs (JSON array)"}],relations:[{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"nullify"}],indexes:[{fields:["number"],unique:!0,name:"idx_transmittal_number"},{fields:["jobId"],name:"idx_transmittal_job"},{fields:["status"],name:"idx_transmittal_status"}]},{collection:"doc/photo",module:"doc",version:2,fields:[{name:"documentId",type:"id",required:!0,label:"Document"},{name:"jobId",type:"id",label:"Job"},{name:"dateTaken",type:"date",required:!0,label:"Date Taken"},{name:"location",type:"string",label:"Location"},{name:"description",type:"string",label:"Description"},{name:"latitude",type:"number",label:"Latitude"},{name:"longitude",type:"number",label:"Longitude"},{name:"takenBy",type:"string",label:"Taken By"}],relations:[{foreignKey:"documentId",collection:"doc/document",type:"belongsTo",cascade:"cascade"},{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"nullify"}],indexes:[{fields:["documentId"],name:"idx_photo_document"},{fields:["jobId"],name:"idx_photo_job"},{fields:["dateTaken"],name:"idx_photo_date"}]}],Oe=[{collection:"proj/project",module:"proj",version:1,fields:[{name:"name",type:"string",required:!0,label:"Project Name"},{name:"jobId",type:"id",label:"Job"},{name:"startDate",type:"date",label:"Start Date"},{name:"status",type:"enum",enum:["planning","active","on-hold","complete"],label:"Status"}],relations:[{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"nullify"}]},{collection:"proj/phase",module:"proj",version:1,fields:[{name:"projectId",type:"id",required:!0,label:"Project"},{name:"name",type:"string",required:!0,label:"Phase Name"},{name:"order",type:"number",label:"Sort Order"},{name:"status",type:"enum",enum:["pending","active","complete"],label:"Status"}],relations:[{foreignKey:"projectId",collection:"proj/project",type:"belongsTo",cascade:"cascade"}]},{collection:"proj/task",module:"proj",version:1,fields:[{name:"phaseId",type:"id",label:"Phase"},{name:"name",type:"string",required:!0,label:"Task Name"},{name:"assigneeId",type:"id",label:"Assignee"},{name:"status",type:"enum",enum:["todo","in-progress","done","blocked"],label:"Status"}],relations:[{foreignKey:"phaseId",collection:"proj/phase",type:"belongsTo",cascade:"cascade"}]},{collection:"proj/milestone",module:"proj",version:1,fields:[{name:"projectId",type:"id",required:!0,label:"Project"},{name:"name",type:"string",required:!0,label:"Milestone Name"},{name:"dueDate",type:"date",label:"Due Date"},{name:"status",type:"enum",enum:["upcoming","reached","missed"],label:"Status"}],relations:[{foreignKey:"projectId",collection:"proj/project",type:"belongsTo",cascade:"cascade"}]},{collection:"proj/rfi",module:"proj",version:1,fields:[{name:"projectId",type:"id",required:!0,label:"Project"},{name:"number",type:"number",required:!0,label:"RFI Number"},{name:"subject",type:"string",required:!0,label:"Subject"},{name:"status",type:"enum",enum:["draft","open","answered","closed"],label:"Status"}],relations:[{foreignKey:"projectId",collection:"proj/project",type:"belongsTo",cascade:"cascade"}]},{collection:"proj/submittal",module:"proj",version:1,fields:[{name:"projectId",type:"id",required:!0,label:"Project"},{name:"number",type:"number",required:!0,label:"Submittal Number"},{name:"description",type:"string",label:"Description"},{name:"status",type:"enum",enum:["pending","submitted","approved","rejected","revise-resubmit"],label:"Status"}],relations:[{foreignKey:"projectId",collection:"proj/project",type:"belongsTo",cascade:"cascade"}]},{collection:"proj/dailyLog",module:"proj",version:1,fields:[{name:"projectId",type:"id",required:!0,label:"Project"},{name:"date",type:"date",required:!0,label:"Date"},{name:"weather",type:"string",label:"Weather"},{name:"notes",type:"string",label:"Notes"}],relations:[{foreignKey:"projectId",collection:"proj/project",type:"belongsTo",cascade:"cascade"}]},{collection:"proj/meetingMinutes",module:"proj",version:1,fields:[{name:"projectId",type:"id",required:!0,label:"Project"},{name:"date",type:"date",required:!0,label:"Meeting Date"},{name:"subject",type:"string",required:!0,label:"Subject"},{name:"attendees",type:"array",label:"Attendees"}],relations:[{foreignKey:"projectId",collection:"proj/project",type:"belongsTo",cascade:"cascade"}]},{collection:"proj/punchList",module:"proj",version:1,fields:[{name:"projectId",type:"id",required:!0,label:"Project"},{name:"description",type:"string",required:!0,label:"Description"},{name:"assigneeId",type:"id",label:"Assignee"},{name:"status",type:"enum",enum:["open","in-progress","complete","verified"],label:"Status"}],relations:[{foreignKey:"projectId",collection:"proj/project",type:"belongsTo",cascade:"cascade"}]}],Fe=[{collection:"svc/serviceAgreement",module:"svc",version:1,fields:[{name:"customerId",type:"id",required:!0,label:"Customer"},{name:"name",type:"string",required:!0,label:"Agreement Name"},{name:"startDate",type:"date",label:"Start Date"},{name:"status",type:"enum",enum:["active","expired","cancelled"],label:"Status"}],relations:[{foreignKey:"customerId",collection:"ar/customer",type:"belongsTo",cascade:"restrict"}]},{collection:"svc/workOrder",module:"svc",version:1,fields:[{name:"agreementId",type:"id",label:"Service Agreement"},{name:"description",type:"string",required:!0,label:"Description"},{name:"priority",type:"enum",enum:["low","medium","high","emergency"],label:"Priority"},{name:"status",type:"enum",enum:["new","assigned","in-progress","complete","invoiced"],label:"Status"}],relations:[{foreignKey:"agreementId",collection:"svc/serviceAgreement",type:"belongsTo",cascade:"nullify"}]},{collection:"svc/dispatch",module:"svc",version:1,fields:[{name:"workOrderId",type:"id",required:!0,label:"Work Order"},{name:"technicianId",type:"id",label:"Technician"},{name:"scheduledDate",type:"date",label:"Scheduled Date"},{name:"status",type:"enum",enum:["scheduled","dispatched","arrived","complete"],label:"Status"}],relations:[{foreignKey:"workOrderId",collection:"svc/workOrder",type:"belongsTo",cascade:"cascade"}]},{collection:"svc/call",module:"svc",version:1,fields:[{name:"customerId",type:"id",required:!0,label:"Customer"},{name:"subject",type:"string",required:!0,label:"Subject"},{name:"type",type:"enum",enum:["service-request","complaint","inquiry","emergency"],label:"Call Type"},{name:"status",type:"enum",enum:["new","assigned","resolved","closed"],label:"Status"}],relations:[{foreignKey:"customerId",collection:"ar/customer",type:"belongsTo",cascade:"restrict"}]},{collection:"svc/invoice",module:"svc",version:1,fields:[{name:"workOrderId",type:"id",required:!0,label:"Work Order"},{name:"amount",type:"currency",required:!0,label:"Amount"},{name:"status",type:"enum",enum:["draft","sent","paid","voided"],label:"Status"}],relations:[{foreignKey:"workOrderId",collection:"svc/workOrder",type:"belongsTo",cascade:"cascade"}]}],He=[{collection:"inv/item",module:"inv",version:1,fields:[{name:"sku",type:"string",required:!0,label:"SKU"},{name:"description",type:"string",required:!0,label:"Description"},{name:"unitOfMeasure",type:"string",label:"Unit of Measure"},{name:"unitCost",type:"currency",label:"Unit Cost"}],relations:[]},{collection:"inv/location",module:"inv",version:1,fields:[{name:"name",type:"string",required:!0,label:"Location Name"},{name:"type",type:"enum",enum:["warehouse","jobsite","yard","vehicle"],label:"Location Type"},{name:"address",type:"string",label:"Address"}],relations:[]},{collection:"inv/receipt",module:"inv",version:1,fields:[{name:"itemId",type:"id",required:!0,label:"Item"},{name:"locationId",type:"id",required:!0,label:"Location"},{name:"quantity",type:"number",required:!0,label:"Quantity"},{name:"date",type:"date",required:!0,label:"Receipt Date"}],relations:[{foreignKey:"itemId",collection:"inv/item",type:"belongsTo",cascade:"restrict"},{foreignKey:"locationId",collection:"inv/location",type:"belongsTo",cascade:"restrict"}]},{collection:"inv/issue",module:"inv",version:1,fields:[{name:"itemId",type:"id",required:!0,label:"Item"},{name:"locationId",type:"id",required:!0,label:"From Location"},{name:"quantity",type:"number",required:!0,label:"Quantity"},{name:"jobId",type:"id",label:"Job"}],relations:[{foreignKey:"itemId",collection:"inv/item",type:"belongsTo",cascade:"restrict"},{foreignKey:"locationId",collection:"inv/location",type:"belongsTo",cascade:"restrict"},{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"nullify"}]},{collection:"inv/transfer",module:"inv",version:1,fields:[{name:"itemId",type:"id",required:!0,label:"Item"},{name:"fromLocationId",type:"id",required:!0,label:"From Location"},{name:"toLocationId",type:"id",required:!0,label:"To Location"},{name:"quantity",type:"number",required:!0,label:"Quantity"}],relations:[{foreignKey:"itemId",collection:"inv/item",type:"belongsTo",cascade:"restrict"},{foreignKey:"fromLocationId",collection:"inv/location",type:"belongsTo",cascade:"restrict"},{foreignKey:"toLocationId",collection:"inv/location",type:"belongsTo",cascade:"restrict"}]},{collection:"inv/count",module:"inv",version:1,fields:[{name:"locationId",type:"id",required:!0,label:"Location"},{name:"date",type:"date",required:!0,label:"Count Date"},{name:"status",type:"enum",enum:["draft","in-progress","complete","posted"],label:"Status"}],relations:[{foreignKey:"locationId",collection:"inv/location",type:"belongsTo",cascade:"restrict"}]}],Ue=[{collection:"hr/position",module:"hr",version:1,fields:[{name:"title",type:"string",required:!0,label:"Position Title"},{name:"department",type:"string",label:"Department"},{name:"status",type:"enum",enum:["open","filled","closed"],label:"Status"},{name:"payGrade",type:"string",label:"Pay Grade"}],relations:[]},{collection:"hr/certification",module:"hr",version:1,fields:[{name:"employeeId",type:"id",required:!0,label:"Employee"},{name:"name",type:"string",required:!0,label:"Certification Name"},{name:"issuedDate",type:"date",label:"Issued Date"},{name:"expirationDate",type:"date",label:"Expiration Date"}],relations:[{foreignKey:"employeeId",collection:"payroll/employee",type:"belongsTo",cascade:"cascade"}]},{collection:"hr/training",module:"hr",version:1,fields:[{name:"name",type:"string",required:!0,label:"Training Name"},{name:"type",type:"enum",enum:["required","optional","safety","professional"],label:"Training Type"},{name:"durationHours",type:"number",label:"Duration (Hours)"}],relations:[]},{collection:"hr/benefit",module:"hr",version:1,fields:[{name:"employeeId",type:"id",required:!0,label:"Employee"},{name:"planId",type:"id",label:"Benefit Plan"},{name:"enrollmentDate",type:"date",label:"Enrollment Date"},{name:"status",type:"enum",enum:["active","waived","terminated"],label:"Status"}],relations:[{foreignKey:"employeeId",collection:"payroll/employee",type:"belongsTo",cascade:"cascade"}]},{collection:"hr/leave",module:"hr",version:1,fields:[{name:"employeeId",type:"id",required:!0,label:"Employee"},{name:"type",type:"enum",enum:["vacation","sick","personal","fmla","bereavement"],label:"Leave Type"},{name:"startDate",type:"date",required:!0,label:"Start Date"},{name:"status",type:"enum",enum:["requested","approved","denied","cancelled"],label:"Status"}],relations:[{foreignKey:"employeeId",collection:"payroll/employee",type:"belongsTo",cascade:"cascade"}]},{collection:"hr/applicant",module:"hr",version:1,fields:[{name:"name",type:"string",required:!0,label:"Applicant Name"},{name:"positionId",type:"id",label:"Applied Position"},{name:"status",type:"enum",enum:["applied","screening","interview","offered","hired","rejected"],label:"Status"},{name:"applicationDate",type:"date",label:"Application Date"}],relations:[{foreignKey:"positionId",collection:"hr/position",type:"belongsTo",cascade:"nullify"}]}],Je=[{collection:"safety/incident",module:"safety",version:1,fields:[{name:"date",type:"date",required:!0,label:"Incident Date"},{name:"description",type:"string",required:!0,label:"Description"},{name:"severity",type:"enum",enum:["near-miss","minor","moderate","serious","fatal"],label:"Severity"},{name:"jobId",type:"id",label:"Job"}],relations:[{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"nullify"}]},{collection:"safety/inspection",module:"safety",version:1,fields:[{name:"jobId",type:"id",required:!0,label:"Job"},{name:"date",type:"date",required:!0,label:"Inspection Date"},{name:"inspectorId",type:"id",label:"Inspector"},{name:"result",type:"enum",enum:["pass","fail","conditional"],label:"Result"}],relations:[{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"restrict"}]},{collection:"safety/oshaLog",module:"safety",version:1,fields:[{name:"year",type:"number",required:!0,label:"Year"},{name:"formType",type:"enum",enum:["300","300A","301"],required:!0,label:"Form Type"},{name:"status",type:"enum",enum:["draft","final","submitted"],label:"Status"}],relations:[]},{collection:"safety/toolboxTalk",module:"safety",version:1,fields:[{name:"topic",type:"string",required:!0,label:"Topic"},{name:"date",type:"date",required:!0,label:"Date"},{name:"jobId",type:"id",label:"Job"},{name:"attendees",type:"array",label:"Attendees"}],relations:[{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"nullify"}]},{collection:"safety/corrective",module:"safety",version:1,fields:[{name:"incidentId",type:"id",label:"Incident"},{name:"description",type:"string",required:!0,label:"Corrective Action"},{name:"assigneeId",type:"id",label:"Assignee"},{name:"status",type:"enum",enum:["open","in-progress","complete","verified"],label:"Status"}],relations:[{foreignKey:"incidentId",collection:"safety/incident",type:"belongsTo",cascade:"cascade"}]},{collection:"safety/drugTest",module:"safety",version:1,fields:[{name:"employeeId",type:"id",required:!0,label:"Employee"},{name:"date",type:"date",required:!0,label:"Test Date"},{name:"type",type:"enum",enum:["pre-employment","random","post-incident","reasonable-suspicion"],label:"Test Type"},{name:"result",type:"enum",enum:["negative","positive","pending"],label:"Result"}],relations:[{foreignKey:"employeeId",collection:"payroll/employee",type:"belongsTo",cascade:"restrict"}]}],ze=[{collection:"bond/surety",module:"bond",version:1,fields:[{name:"name",type:"string",required:!0,label:"Surety Name"},{name:"agentName",type:"string",label:"Agent Name"},{name:"bondingCapacity",type:"currency",label:"Bonding Capacity"},{name:"status",type:"enum",enum:["active","inactive"],label:"Status"}],relations:[]},{collection:"bond/bondPolicy",module:"bond",version:1,fields:[{name:"suretyId",type:"id",required:!0,label:"Surety"},{name:"jobId",type:"id",label:"Job"},{name:"type",type:"enum",enum:["bid","performance","payment","maintenance"],required:!0,label:"Bond Type"},{name:"amount",type:"currency",required:!0,label:"Bond Amount"}],relations:[{foreignKey:"suretyId",collection:"bond/surety",type:"belongsTo",cascade:"restrict"},{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"nullify"}]},{collection:"bond/claim",module:"bond",version:1,fields:[{name:"bondPolicyId",type:"id",required:!0,label:"Bond Policy"},{name:"claimantName",type:"string",required:!0,label:"Claimant"},{name:"amount",type:"currency",label:"Claim Amount"},{name:"status",type:"enum",enum:["filed","under-review","settled","denied"],label:"Status"}],relations:[{foreignKey:"bondPolicyId",collection:"bond/bondPolicy",type:"belongsTo",cascade:"restrict"}]},{collection:"bond/insurance",module:"bond",version:1,fields:[{name:"carrier",type:"string",required:!0,label:"Carrier"},{name:"policyNumber",type:"string",required:!0,label:"Policy Number"},{name:"type",type:"enum",enum:["general-liability","auto","umbrella","workers-comp","professional","builders-risk"],label:"Policy Type"},{name:"expirationDate",type:"date",label:"Expiration Date"}],relations:[]},{collection:"bond/coi",module:"bond",version:1,fields:[{name:"vendorId",type:"id",required:!0,label:"Vendor / Sub"},{name:"carrier",type:"string",label:"Carrier"},{name:"expirationDate",type:"date",required:!0,label:"Expiration Date"},{name:"status",type:"enum",enum:["valid","expired","pending"],label:"Status"}],relations:[{foreignKey:"vendorId",collection:"ap/vendor",type:"belongsTo",cascade:"restrict"}]}],Ve=[{collection:"bank/account",module:"bank",version:1,fields:[{name:"name",type:"string",required:!0,label:"Account Name"},{name:"accountNumber",type:"string",required:!0,label:"Account Number"},{name:"bankName",type:"string",label:"Bank Name"},{name:"type",type:"enum",enum:["checking","savings","money-market","line-of-credit"],label:"Account Type"}],relations:[]},{collection:"bank/statement",module:"bank",version:1,fields:[{name:"accountId",type:"id",required:!0,label:"Bank Account"},{name:"periodStart",type:"date",required:!0,label:"Period Start"},{name:"periodEnd",type:"date",required:!0,label:"Period End"},{name:"endingBalance",type:"currency",label:"Ending Balance"}],relations:[{foreignKey:"accountId",collection:"bank/account",type:"belongsTo",cascade:"cascade"}]},{collection:"bank/statementLine",module:"bank",version:1,fields:[{name:"statementId",type:"id",required:!0,label:"Statement"},{name:"date",type:"date",required:!0,label:"Date"},{name:"description",type:"string",label:"Description"},{name:"amount",type:"currency",required:!0,label:"Amount"}],relations:[{foreignKey:"statementId",collection:"bank/statement",type:"belongsTo",cascade:"cascade"}]},{collection:"bank/reconciliation",module:"bank",version:1,fields:[{name:"accountId",type:"id",required:!0,label:"Bank Account"},{name:"statementId",type:"id",label:"Statement"},{name:"date",type:"date",required:!0,label:"Reconciliation Date"},{name:"status",type:"enum",enum:["in-progress","balanced","unbalanced","posted"],label:"Status"}],relations:[{foreignKey:"accountId",collection:"bank/account",type:"belongsTo",cascade:"restrict"},{foreignKey:"statementId",collection:"bank/statement",type:"belongsTo",cascade:"nullify"}]},{collection:"bank/matchRule",module:"bank",version:1,fields:[{name:"name",type:"string",required:!0,label:"Rule Name"},{name:"pattern",type:"string",required:!0,label:"Match Pattern"},{name:"targetAccountId",type:"id",label:"Target GL Account"},{name:"priority",type:"number",label:"Priority"}],relations:[{foreignKey:"targetAccountId",collection:"gl/account",type:"belongsTo",cascade:"nullify"}]}],We=[{collection:"contract/contract",module:"contract",version:1,fields:[{name:"number",type:"string",required:!0,label:"Contract Number"},{name:"jobId",type:"id",required:!0,label:"Job"},{name:"amount",type:"currency",required:!0,label:"Contract Amount"},{name:"status",type:"enum",enum:["draft","executed","active","complete","closed"],label:"Status"}],relations:[{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"restrict"}]},{collection:"contract/sov",module:"contract",version:1,fields:[{name:"contractId",type:"id",required:!0,label:"Contract"},{name:"lineNumber",type:"number",required:!0,label:"Line Number"},{name:"description",type:"string",required:!0,label:"Description"},{name:"scheduledValue",type:"currency",required:!0,label:"Scheduled Value"}],relations:[{foreignKey:"contractId",collection:"contract/contract",type:"belongsTo",cascade:"cascade"}]},{collection:"contract/amendment",module:"contract",version:1,fields:[{name:"contractId",type:"id",required:!0,label:"Contract"},{name:"number",type:"number",required:!0,label:"Amendment Number"},{name:"amountChange",type:"currency",label:"Amount Change"},{name:"status",type:"enum",enum:["pending","approved","rejected"],label:"Status"}],relations:[{foreignKey:"contractId",collection:"contract/contract",type:"belongsTo",cascade:"cascade"}]},{collection:"contract/milestone",module:"contract",version:1,fields:[{name:"contractId",type:"id",required:!0,label:"Contract"},{name:"name",type:"string",required:!0,label:"Milestone Name"},{name:"dueDate",type:"date",label:"Due Date"},{name:"status",type:"enum",enum:["upcoming","reached","missed"],label:"Status"}],relations:[{foreignKey:"contractId",collection:"contract/contract",type:"belongsTo",cascade:"cascade"}]},{collection:"contract/closeout",module:"contract",version:1,fields:[{name:"contractId",type:"id",required:!0,label:"Contract"},{name:"status",type:"enum",enum:["pending","in-progress","complete"],label:"Status"},{name:"completionDate",type:"date",label:"Completion Date"}],relations:[{foreignKey:"contractId",collection:"contract/contract",type:"belongsTo",cascade:"cascade"}]},{collection:"contract/warranty",module:"contract",version:1,fields:[{name:"contractId",type:"id",required:!0,label:"Contract"},{name:"description",type:"string",required:!0,label:"Description"},{name:"startDate",type:"date",label:"Start Date"},{name:"expirationDate",type:"date",label:"Expiration Date"}],relations:[{foreignKey:"contractId",collection:"contract/contract",type:"belongsTo",cascade:"cascade"}]}],Ge=[{collection:"fleet/asset",module:"fleet",version:1,fields:[{name:"vin",type:"string",required:!0,label:"VIN"},{name:"description",type:"string",required:!0,label:"Description"},{name:"type",type:"enum",enum:["truck","van","trailer","car","heavy-equipment"],label:"Vehicle Type"},{name:"status",type:"enum",enum:["active","maintenance","retired"],label:"Status"}],relations:[]},{collection:"fleet/inspection",module:"fleet",version:1,fields:[{name:"assetId",type:"id",required:!0,label:"Fleet Asset"},{name:"date",type:"date",required:!0,label:"Inspection Date"},{name:"type",type:"enum",enum:["pre-trip","post-trip","annual","dot"],label:"Inspection Type"},{name:"result",type:"enum",enum:["pass","fail","conditional"],label:"Result"}],relations:[{foreignKey:"assetId",collection:"fleet/asset",type:"belongsTo",cascade:"cascade"}]},{collection:"fleet/fuelCard",module:"fleet",version:1,fields:[{name:"cardNumber",type:"string",required:!0,label:"Card Number"},{name:"assetId",type:"id",label:"Assigned Vehicle"},{name:"status",type:"enum",enum:["active","suspended","cancelled"],label:"Status"}],relations:[{foreignKey:"assetId",collection:"fleet/asset",type:"belongsTo",cascade:"nullify"}]},{collection:"fleet/assignment",module:"fleet",version:1,fields:[{name:"assetId",type:"id",required:!0,label:"Fleet Asset"},{name:"employeeId",type:"id",required:!0,label:"Employee"},{name:"startDate",type:"date",required:!0,label:"Start Date"},{name:"endDate",type:"date",label:"End Date"}],relations:[{foreignKey:"assetId",collection:"fleet/asset",type:"belongsTo",cascade:"cascade"},{foreignKey:"employeeId",collection:"payroll/employee",type:"belongsTo",cascade:"restrict"}]},{collection:"fleet/depreciation",module:"fleet",version:1,fields:[{name:"assetId",type:"id",required:!0,label:"Fleet Asset"},{name:"method",type:"enum",enum:["straight-line","declining-balance","mileage-based"],label:"Method"},{name:"currentValue",type:"currency",label:"Current Value"},{name:"usefulLife",type:"number",label:"Useful Life (months)"}],relations:[{foreignKey:"assetId",collection:"fleet/asset",type:"belongsTo",cascade:"cascade"}]}],Qe=[{collection:"analytics/dashboard",module:"analytics",version:2,fields:[{name:"name",type:"string",required:!0,label:"Dashboard Name"},{name:"description",type:"string",label:"Description"},{name:"layout",type:"enum",enum:["grid","list","free"],label:"Layout Mode"},{name:"entityId",type:"id",label:"Entity Filter"},{name:"isDefault",type:"boolean",label:"Default Dashboard"},{name:"widgets",type:"object",label:"Widget Placement Configs (JSON array)"}],relations:[],indexes:[{fields:["name"],unique:!0,name:"idx_dashboard_name"},{fields:["entityId"],name:"idx_dashboard_entity"},{fields:["isDefault"],name:"idx_dashboard_default"}]},{collection:"analytics/widget",module:"analytics",version:2,fields:[{name:"dashboardId",type:"id",required:!0,label:"Dashboard"},{name:"type",type:"enum",enum:["kpi_card","chart","table","gauge","trend"],required:!0,label:"Widget Type"},{name:"title",type:"string",required:!0,label:"Widget Title"},{name:"config",type:"object",label:"Widget Config (JSON - dataSource, filters, thresholds, format)"},{name:"position",type:"object",label:"Position (row, col, width, height)"}],relations:[{foreignKey:"dashboardId",collection:"analytics/dashboard",type:"belongsTo",cascade:"cascade"}],indexes:[{fields:["dashboardId"],name:"idx_widget_dashboard"},{fields:["type"],name:"idx_widget_type"}]},{collection:"analytics/savedReport",module:"analytics",version:2,fields:[{name:"name",type:"string",required:!0,label:"Report Name"},{name:"reportType",type:"string",required:!0,label:"Report Type"},{name:"config",type:"object",required:!0,label:"Report Config (JSON)"},{name:"createdBy",type:"string",label:"Created By"},{name:"isShared",type:"boolean",label:"Shared Report"}],relations:[],indexes:[{fields:["name"],unique:!0,name:"idx_savedreport_name"},{fields:["reportType"],name:"idx_savedreport_type"},{fields:["createdBy"],name:"idx_savedreport_creator"}]},{collection:"analytics/kpiDef",module:"analytics",version:2,fields:[{name:"code",type:"string",required:!0,label:"KPI Code"},{name:"name",type:"string",required:!0,label:"KPI Name"},{name:"description",type:"string",label:"Description"},{name:"category",type:"enum",enum:["financial","operational","safety","hr"],required:!0,label:"Category"},{name:"formula",type:"string",required:!0,label:"Formula"},{name:"format",type:"enum",enum:["currency","percent","number","days"],required:!0,label:"Display Format"},{name:"thresholdWarning",type:"number",label:"Warning Threshold"},{name:"thresholdCritical",type:"number",label:"Critical Threshold"},{name:"higherIsBetter",type:"boolean",label:"Higher Is Better"}],relations:[],indexes:[{fields:["code"],unique:!0,name:"idx_kpidef_code"},{fields:["category"],name:"idx_kpidef_category"}]},{collection:"analytics/benchmark",module:"analytics",version:2,fields:[{name:"kpiCode",type:"string",required:!0,label:"KPI Code"},{name:"entityId",type:"id",label:"Entity"},{name:"period",type:"string",required:!0,label:"Period"},{name:"value",type:"number",required:!0,label:"Actual Value"},{name:"target",type:"number",label:"Target Value"},{name:"industry",type:"string",label:"Industry Benchmark"}],relations:[],indexes:[{fields:["kpiCode","period"],name:"idx_benchmark_kpi_period"},{fields:["entityId"],name:"idx_benchmark_entity"},{fields:["kpiCode"],name:"idx_benchmark_kpi"}]}],Ye=[{collection:"workflow/template",module:"workflow",version:1,fields:[{name:"name",type:"string",required:!0,label:"Template Name"},{name:"description",type:"string",label:"Description"},{name:"triggerCollection",type:"string",label:"Trigger Collection"},{name:"status",type:"enum",enum:["active","draft","archived"],label:"Status"}],relations:[]},{collection:"workflow/instance",module:"workflow",version:1,fields:[{name:"templateId",type:"id",required:!0,label:"Template"},{name:"entityId",type:"id",label:"Related Entity"},{name:"status",type:"enum",enum:["active","complete","cancelled","error"],label:"Status"},{name:"currentStepId",type:"id",label:"Current Step"}],relations:[{foreignKey:"templateId",collection:"workflow/template",type:"belongsTo",cascade:"restrict"}]},{collection:"workflow/step",module:"workflow",version:1,fields:[{name:"templateId",type:"id",required:!0,label:"Template"},{name:"name",type:"string",required:!0,label:"Step Name"},{name:"type",type:"enum",enum:["approval","notification","action","condition"],required:!0,label:"Step Type"},{name:"order",type:"number",label:"Sort Order"}],relations:[{foreignKey:"templateId",collection:"workflow/template",type:"belongsTo",cascade:"cascade"}]},{collection:"workflow/approval",module:"workflow",version:1,fields:[{name:"instanceId",type:"id",required:!0,label:"Workflow Instance"},{name:"stepId",type:"id",required:!0,label:"Step"},{name:"approverId",type:"id",label:"Approver"},{name:"decision",type:"enum",enum:["pending","approved","rejected","delegated"],label:"Decision"}],relations:[{foreignKey:"instanceId",collection:"workflow/instance",type:"belongsTo",cascade:"cascade"},{foreignKey:"stepId",collection:"workflow/step",type:"belongsTo",cascade:"restrict"}]},{collection:"workflow/escalation",module:"workflow",version:1,fields:[{name:"approvalId",type:"id",required:!0,label:"Approval"},{name:"escalatedToId",type:"id",label:"Escalated To"},{name:"reason",type:"string",label:"Reason"},{name:"status",type:"enum",enum:["pending","resolved"],label:"Status"}],relations:[{foreignKey:"approvalId",collection:"workflow/approval",type:"belongsTo",cascade:"cascade"}]}],Ze=[{collection:"integration/endpoint",module:"integration",version:1,fields:[{name:"name",type:"string",required:!0,label:"Endpoint Name"},{name:"url",type:"string",required:!0,label:"URL"},{name:"method",type:"enum",enum:["GET","POST","PUT","PATCH","DELETE"],label:"HTTP Method"},{name:"status",type:"enum",enum:["active","inactive","error"],label:"Status"}],relations:[]},{collection:"integration/webhook",module:"integration",version:1,fields:[{name:"name",type:"string",required:!0,label:"Webhook Name"},{name:"url",type:"string",required:!0,label:"Callback URL"},{name:"events",type:"array",label:"Subscribed Events"},{name:"status",type:"enum",enum:["active","inactive"],label:"Status"}],relations:[]},{collection:"integration/apiKey",module:"integration",version:1,fields:[{name:"name",type:"string",required:!0,label:"Key Name"},{name:"prefix",type:"string",required:!0,label:"Key Prefix"},{name:"expiresAt",type:"date",label:"Expires At"},{name:"status",type:"enum",enum:["active","revoked","expired"],label:"Status"}],relations:[]},{collection:"integration/syncLog",module:"integration",version:1,fields:[{name:"endpointId",type:"id",required:!0,label:"Endpoint"},{name:"direction",type:"enum",enum:["inbound","outbound"],required:!0,label:"Direction"},{name:"recordCount",type:"number",label:"Record Count"},{name:"status",type:"enum",enum:["success","partial","failed"],label:"Status"}],relations:[{foreignKey:"endpointId",collection:"integration/endpoint",type:"belongsTo",cascade:"cascade"}]},{collection:"integration/mapping",module:"integration",version:1,fields:[{name:"endpointId",type:"id",required:!0,label:"Endpoint"},{name:"sourceField",type:"string",required:!0,label:"Source Field"},{name:"targetField",type:"string",required:!0,label:"Target Field"},{name:"transform",type:"string",label:"Transform Expression"}],relations:[{foreignKey:"endpointId",collection:"integration/endpoint",type:"belongsTo",cascade:"cascade"}]},{collection:"integration/importBatch",module:"integration",version:1,fields:[{name:"name",type:"string",required:!0,label:"Batch Name"},{name:"sourceFormat",type:"enum",enum:["csv","json","iif","qb","sage","foundation","tsv","fixed"],required:!0,label:"Source Format"},{name:"collection",type:"string",required:!0,label:"Target Collection"},{name:"status",type:"enum",enum:["pending","validating","preview","importing","completed","failed","reverted"],required:!0,label:"Status"},{name:"totalRows",type:"number",required:!0,label:"Total Rows"},{name:"importedRows",type:"number",required:!0,label:"Imported Rows"},{name:"skippedRows",type:"number",required:!0,label:"Skipped Rows"},{name:"errorRows",type:"number",required:!0,label:"Error Rows"},{name:"mergeStrategy",type:"enum",enum:["skip","overwrite","append","manual"],required:!0,label:"Merge Strategy"},{name:"compositeKeys",type:"array",label:"Composite Keys"},{name:"delimiter",type:"string",label:"Custom Delimiter"},{name:"rawData",type:"array",label:"Raw Parsed Rows"},{name:"importedIds",type:"array",label:"Imported Record IDs"},{name:"startedAt",type:"date",label:"Started At"},{name:"completedAt",type:"date",label:"Completed At"},{name:"revertedAt",type:"date",label:"Reverted At"}],relations:[]},{collection:"integration/importError",module:"integration",version:1,fields:[{name:"batchId",type:"id",required:!0,label:"Batch"},{name:"rowNumber",type:"number",required:!0,label:"Row Number"},{name:"field",type:"string",required:!0,label:"Field"},{name:"value",type:"string",label:"Value"},{name:"error",type:"string",required:!0,label:"Error Message"},{name:"severity",type:"enum",enum:["warning","error"],required:!0,label:"Severity"}],relations:[{foreignKey:"batchId",collection:"integration/importBatch",type:"belongsTo",cascade:"cascade"}]},{collection:"integration/exportJob",module:"integration",version:1,fields:[{name:"name",type:"string",required:!0,label:"Export Name"},{name:"format",type:"enum",enum:["csv","json","pdf","tsv","api"],required:!0,label:"Format"},{name:"collection",type:"string",required:!0,label:"Collection"},{name:"filters",type:"object",label:"Filters"},{name:"columns",type:"array",label:"Selected Columns"},{name:"status",type:"enum",enum:["pending","processing","completed","failed"],required:!0,label:"Status"},{name:"fileSize",type:"number",label:"File Size (bytes)"},{name:"resultData",type:"string",label:"Result Data"},{name:"startedAt",type:"date",label:"Started At"},{name:"completedAt",type:"date",label:"Completed At"}],relations:[]},{collection:"integration/fieldMapping",module:"integration",version:1,fields:[{name:"batchId",type:"id",required:!0,label:"Batch"},{name:"sourceField",type:"string",required:!0,label:"Source Field"},{name:"targetField",type:"string",required:!0,label:"Target Field"},{name:"transform",type:"enum",enum:["none","lowercase","uppercase","date","number","trim"],required:!0,label:"Transform"}],relations:[{foreignKey:"batchId",collection:"integration/importBatch",type:"belongsTo",cascade:"cascade"}]}],Xe=[{collection:"plugin/manifest",module:"plugin",version:1,fields:[{name:"name",type:"string",required:!0,label:"Plugin Name"},{name:"version",type:"string",required:!0,label:"Version"},{name:"author",type:"string",label:"Author"},{name:"status",type:"enum",enum:["installed","active","disabled","error"],label:"Status"}],relations:[]},{collection:"plugin/config",module:"plugin",version:1,fields:[{name:"pluginId",type:"id",required:!0,label:"Plugin"},{name:"key",type:"string",required:!0,label:"Key"},{name:"value",type:"object",label:"Value"}],relations:[{foreignKey:"pluginId",collection:"plugin/manifest",type:"belongsTo",cascade:"cascade"}]},{collection:"plugin/customObject",module:"plugin",version:1,fields:[{name:"pluginId",type:"id",required:!0,label:"Plugin"},{name:"name",type:"string",required:!0,label:"Object Name"},{name:"schema",type:"object",required:!0,label:"Schema Definition"}],relations:[{foreignKey:"pluginId",collection:"plugin/manifest",type:"belongsTo",cascade:"cascade"}]},{collection:"plugin/customField",module:"plugin",version:1,fields:[{name:"pluginId",type:"id",required:!0,label:"Plugin"},{name:"collection",type:"string",required:!0,label:"Target Collection"},{name:"fieldName",type:"string",required:!0,label:"Field Name"},{name:"fieldType",type:"enum",enum:["string","number","boolean","date","enum"],label:"Field Type"}],relations:[{foreignKey:"pluginId",collection:"plugin/manifest",type:"belongsTo",cascade:"cascade"}]},{collection:"plugin/script",module:"plugin",version:1,fields:[{name:"pluginId",type:"id",required:!0,label:"Plugin"},{name:"name",type:"string",required:!0,label:"Script Name"},{name:"trigger",type:"enum",enum:["beforeSave","afterSave","beforeDelete","afterDelete","scheduled"],label:"Trigger"},{name:"code",type:"string",label:"Script Code"}],relations:[{foreignKey:"pluginId",collection:"plugin/manifest",type:"belongsTo",cascade:"cascade"}]}],et=[{collection:"auth/user",module:"auth",version:1,fields:[{name:"email",type:"string",required:!0,label:"Email"},{name:"username",type:"string",required:!0,label:"Username"},{name:"displayName",type:"string",required:!0,label:"Display Name"},{name:"passwordHash",type:"string",label:"Password Hash"},{name:"roleId",type:"id",label:"Role"},{name:"status",type:"enum",enum:["active","inactive","locked","pending"],label:"Status"},{name:"mfaEnabled",type:"boolean",label:"MFA Enabled"},{name:"mfaSecret",type:"string",label:"MFA Secret"},{name:"lastLoginAt",type:"date",label:"Last Login"},{name:"failedLoginAttempts",type:"number",label:"Failed Login Attempts"},{name:"lockedUntil",type:"date",label:"Locked Until"},{name:"passwordChangedAt",type:"date",label:"Password Changed At"},{name:"phone",type:"string",label:"Phone"},{name:"avatar",type:"string",label:"Avatar URL"},{name:"department",type:"string",label:"Department"},{name:"title",type:"string",label:"Title"},{name:"entityId",type:"id",label:"Entity"},{name:"ssoProvider",type:"enum",enum:["none","saml","oidc","google","microsoft"],label:"SSO Provider"},{name:"ssoExternalId",type:"string",label:"SSO External ID"},{name:"preferences",type:"string",label:"Preferences JSON"}],relations:[{foreignKey:"roleId",collection:"auth/role",type:"belongsTo",cascade:"nullify"},{foreignKey:"entityId",collection:"entity/entity",type:"belongsTo",cascade:"nullify"}]},{collection:"auth/role",module:"auth",version:1,fields:[{name:"name",type:"string",required:!0,label:"Role Name"},{name:"description",type:"string",label:"Description"},{name:"permissions",type:"string",required:!0,label:"Permissions JSON"},{name:"isBuiltIn",type:"boolean",label:"Built-in Role"},{name:"priority",type:"number",label:"Priority"}],relations:[]},{collection:"auth/session",module:"auth",version:1,fields:[{name:"userId",type:"id",required:!0,label:"User"},{name:"token",type:"string",required:!0,label:"Session Token"},{name:"ipAddress",type:"string",label:"IP Address"},{name:"userAgent",type:"string",label:"User Agent"},{name:"expiresAt",type:"date",required:!0,label:"Expires At"},{name:"lastActivityAt",type:"date",label:"Last Activity"},{name:"isActive",type:"boolean",label:"Is Active"}],relations:[{foreignKey:"userId",collection:"auth/user",type:"belongsTo",cascade:"cascade"}]},{collection:"auth/apiKey",module:"auth",version:1,fields:[{name:"userId",type:"id",required:!0,label:"User"},{name:"name",type:"string",required:!0,label:"Key Name"},{name:"keyHash",type:"string",required:!0,label:"Key Hash"},{name:"keyPrefix",type:"string",label:"Key Prefix"},{name:"permissions",type:"string",label:"Permissions JSON"},{name:"expiresAt",type:"date",label:"Expires At"},{name:"lastUsedAt",type:"date",label:"Last Used"},{name:"isRevoked",type:"boolean",label:"Is Revoked"},{name:"revokedAt",type:"date",label:"Revoked At"}],relations:[{foreignKey:"userId",collection:"auth/user",type:"belongsTo",cascade:"cascade"}]},{collection:"auth/auditLog",module:"auth",version:1,fields:[{name:"userId",type:"id",label:"User"},{name:"username",type:"string",label:"Username"},{name:"action",type:"string",required:!0,label:"Action"},{name:"resource",type:"string",label:"Resource"},{name:"resourceId",type:"string",label:"Resource ID"},{name:"details",type:"string",label:"Details JSON"},{name:"ipAddress",type:"string",label:"IP Address"},{name:"userAgent",type:"string",label:"User Agent"},{name:"timestamp",type:"date",required:!0,label:"Timestamp"},{name:"severity",type:"enum",enum:["info","warning","critical"],label:"Severity"}],relations:[{foreignKey:"userId",collection:"auth/user",type:"belongsTo",cascade:"nullify"}]}],tt=[{collection:"project/project",module:"project",version:1,fields:[{name:"name",type:"string",required:!0,label:"Project Name"},{name:"jobId",type:"id",label:"Job"},{name:"status",type:"enum",enum:["planning","active","on_hold","completed","cancelled"],label:"Status"},{name:"startDate",type:"date",label:"Start Date"},{name:"endDate",type:"date",label:"End Date"},{name:"baselineStartDate",type:"date",label:"Baseline Start Date"},{name:"baselineEndDate",type:"date",label:"Baseline End Date"},{name:"manager",type:"string",label:"Project Manager"},{name:"percentComplete",type:"number",label:"Percent Complete"},{name:"percentCompleteMethod",type:"enum",enum:["cost","units","manual"],label:"Percent Complete Method"},{name:"budgetedCost",type:"currency",label:"Budgeted Cost"},{name:"actualCost",type:"currency",label:"Actual Cost"},{name:"earnedValue",type:"currency",label:"Earned Value"},{name:"description",type:"string",label:"Description"}],relations:[{foreignKey:"jobId",collection:"job/job",type:"belongsTo",cascade:"nullify"}]},{collection:"project/milestone",module:"project",version:1,fields:[{name:"projectId",type:"id",required:!0,label:"Project"},{name:"name",type:"string",required:!0,label:"Milestone Name"},{name:"dueDate",type:"date",label:"Due Date"},{name:"actualDate",type:"date",label:"Actual Date"},{name:"status",type:"enum",enum:["pending","completed","late"],label:"Status"},{name:"isCritical",type:"boolean",label:"Critical Path"},{name:"description",type:"string",label:"Description"}],relations:[{foreignKey:"projectId",collection:"project/project",type:"belongsTo",cascade:"cascade"}]},{collection:"project/task",module:"project",version:1,fields:[{name:"projectId",type:"id",required:!0,label:"Project"},{name:"milestoneId",type:"id",label:"Milestone"},{name:"name",type:"string",required:!0,label:"Task Name"},{name:"description",type:"string",label:"Description"},{name:"assignee",type:"string",label:"Assignee"},{name:"startDate",type:"date",label:"Start Date"},{name:"endDate",type:"date",label:"End Date"},{name:"baselineStart",type:"date",label:"Baseline Start"},{name:"baselineEnd",type:"date",label:"Baseline End"},{name:"duration",type:"number",label:"Duration (days)"},{name:"actualStart",type:"date",label:"Actual Start"},{name:"actualEnd",type:"date",label:"Actual End"},{name:"percentComplete",type:"number",label:"Percent Complete"},{name:"status",type:"enum",enum:["not_started","in_progress","completed","delayed"],label:"Status"},{name:"isCriticalPath",type:"boolean",label:"Critical Path"},{name:"resourceType",type:"enum",enum:["labor","equipment","material"],label:"Resource Type"},{name:"budgetHours",type:"number",label:"Budget Hours"},{name:"actualHours",type:"number",label:"Actual Hours"},{name:"budgetCost",type:"currency",label:"Budget Cost"},{name:"actualCost",type:"currency",label:"Actual Cost"},{name:"sortOrder",type:"number",label:"Sort Order"}],relations:[{foreignKey:"projectId",collection:"project/project",type:"belongsTo",cascade:"cascade"},{foreignKey:"milestoneId",collection:"project/milestone",type:"belongsTo",cascade:"nullify"}]},{collection:"project/taskDependency",module:"project",version:1,fields:[{name:"taskId",type:"id",required:!0,label:"Task"},{name:"predecessorId",type:"id",required:!0,label:"Predecessor"},{name:"type",type:"enum",enum:["FS","FF","SS","SF"],label:"Dependency Type"},{name:"lag",type:"number",label:"Lag (days)"}],relations:[{foreignKey:"taskId",collection:"project/task",type:"belongsTo",cascade:"cascade"},{foreignKey:"predecessorId",collection:"project/task",type:"belongsTo",cascade:"cascade"}]},{collection:"project/dailyLog",module:"project",version:1,fields:[{name:"projectId",type:"id",required:!0,label:"Project"},{name:"date",type:"date",required:!0,label:"Date"},{name:"weather",type:"string",label:"Weather Conditions"},{name:"temperature",type:"string",label:"Temperature"},{name:"crew",type:"string",label:"Crew"},{name:"workPerformed",type:"string",label:"Work Performed"},{name:"visitors",type:"string",label:"Visitors"},{name:"incidents",type:"string",label:"Incidents"},{name:"notes",type:"string",label:"Notes"},{name:"photos",type:"array",label:"Photos"}],relations:[{foreignKey:"projectId",collection:"project/project",type:"belongsTo",cascade:"cascade"}]},{collection:"project/rfi",module:"project",version:1,fields:[{name:"projectId",type:"id",required:!0,label:"Project"},{name:"number",type:"number",required:!0,label:"RFI Number"},{name:"subject",type:"string",required:!0,label:"Subject"},{name:"question",type:"string",label:"Question"},{name:"requestedBy",type:"string",label:"Requested By"},{name:"assignedTo",type:"string",label:"Assigned To"},{name:"dueDate",type:"date",label:"Due Date"},{name:"status",type:"enum",enum:["open","answered","closed","overdue"],label:"Status"},{name:"priority",type:"enum",enum:["low","medium","high","urgent"],label:"Priority"},{name:"response",type:"string",label:"Response"},{name:"responseDate",type:"date",label:"Response Date"}],relations:[{foreignKey:"projectId",collection:"project/project",type:"belongsTo",cascade:"cascade"}]},{collection:"project/submittal",module:"project",version:1,fields:[{name:"projectId",type:"id",required:!0,label:"Project"},{name:"number",type:"number",required:!0,label:"Submittal Number"},{name:"specSection",type:"string",label:"Spec Section"},{name:"description",type:"string",label:"Description"},{name:"submittedBy",type:"string",label:"Submitted By"},{name:"status",type:"enum",enum:["pending","approved","approved_as_noted","rejected","resubmit"],label:"Status"},{name:"submittedDate",type:"date",label:"Submitted Date"},{name:"reviewedDate",type:"date",label:"Reviewed Date"},{name:"reviewer",type:"string",label:"Reviewer"},{name:"notes",type:"string",label:"Notes"}],relations:[{foreignKey:"projectId",collection:"project/project",type:"belongsTo",cascade:"cascade"}]},{collection:"project/meetingMinutes",module:"project",version:1,fields:[{name:"projectId",type:"id",required:!0,label:"Project"},{name:"date",type:"date",required:!0,label:"Meeting Date"},{name:"type",type:"enum",enum:["progress","safety","owner","pre_construction"],label:"Meeting Type"},{name:"attendees",type:"array",label:"Attendees"},{name:"topics",type:"array",label:"Topics"},{name:"actionItems",type:"array",label:"Action Items"},{name:"nextMeetingDate",type:"date",label:"Next Meeting Date"},{name:"notes",type:"string",label:"Notes"}],relations:[{foreignKey:"projectId",collection:"project/project",type:"belongsTo",cascade:"cascade"}]},{collection:"project/weatherDelay",module:"project",version:1,fields:[{name:"projectId",type:"id",required:!0,label:"Project"},{name:"date",type:"date",required:!0,label:"Date"},{name:"type",type:"enum",enum:["rain","snow","wind","extreme_heat","extreme_cold","other"],label:"Weather Type"},{name:"hoursLost",type:"number",label:"Hours Lost"},{name:"description",type:"string",label:"Description"},{name:"impactedTasks",type:"array",label:"Impacted Tasks"}],relations:[{foreignKey:"projectId",collection:"project/project",type:"belongsTo",cascade:"cascade"}]},{collection:"project/resourceAllocation",module:"project",version:1,fields:[{name:"projectId",type:"id",required:!0,label:"Project"},{name:"taskId",type:"id",label:"Task"},{name:"resourceType",type:"enum",enum:["labor","equipment"],label:"Resource Type"},{name:"resourceId",type:"string",label:"Resource ID"},{name:"hours",type:"number",label:"Hours"},{name:"startDate",type:"date",label:"Start Date"},{name:"endDate",type:"date",label:"End Date"}],relations:[{foreignKey:"projectId",collection:"project/project",type:"belongsTo",cascade:"cascade"},{foreignKey:"taskId",collection:"project/task",type:"belongsTo",cascade:"nullify"}]}],nt=[...De,..._e,...Ee,...ke,...Ne,...Pe,...Re,...Ke,...Me,...Le,...Be,...$e,...Oe,...Fe,...He,...Ue,...Je,...ze,...Ve,...We,...Ge,...Qe,...Ye,...Ze,...Xe,...et,...tt];class at{schemas=new Map;migrationEngine;constructor(){this.migrationEngine=new Ae(this.schemas)}register(e){if(this.schemas.has(e.collection))throw new Error(`Schema collision: collection "${e.collection}" is already registered`);this.schemas.set(e.collection,e)}get(e){return this.schemas.get(e)}getAll(){return Array.from(this.schemas.values())}getByModule(e){return this.getAll().filter(t=>t.module===e)}has(e){return this.schemas.has(e)}validate(e,t){const n=this.schemas.get(e);return n?je(t,n):[`Unknown collection: ${e}`]}getRelationsFor(e){const t=this.schemas.get(e);return t?t.relations:[]}registerCoreSchemas(){for(const e of nt)this.schemas.has(e.collection)||this.schemas.set(e.collection,e)}migrate(e,t){const n=this.schemas.get(e);if(!n)throw new Error(`Schema not found for collection: ${e}`);return this.migrationEngine.run(e,t,0,n.version)}addField(e,t){const n=this.schemas.get(e);if(!n)throw new Error(`Cannot add field: collection "${e}" not found`);if(n.fields.some(r=>r.name===t.name))throw new Error(`Field "${t.name}" already exists in collection "${e}"`);n.fields.push(t)}addCollection(e){this.register(e)}}const rt=new Set(["concrete.core","concrete.ui","concrete.store","concrete.router"]);class it{modules;events;store;schemas;logger;constructor(e,t,n,a){this.modules=new Map,this.events=e,this.store=t,this.schemas=n,this.logger=a}register(e){if(!e.id||typeof e.id!="string")throw new Error('Module manifest must have a non-empty string "id".');if(!e.name||typeof e.name!="string")throw new Error(`Module "${e.id}": manifest must have a non-empty "name".`);if(!e.version||typeof e.version!="string")throw new Error(`Module "${e.id}": manifest must have a "version" string.`);if(this.modules.has(e.id))throw new Error(`Module "${e.id}" is already registered. Disable and unregister it first if you need to replace it.`);this.modules.set(e.id,{manifest:e,status:"registered"}),this.logger.info("modules",`Registered module: ${e.id}@${e.version}`),this.events.emit("module.registered",{moduleId:e.id,version:e.version})}async enable(e){const t=this.modules.get(e);if(!t)throw new Error(`Cannot enable unknown module: ${e}`);if(t.status==="active"){this.logger.warn("modules",`Module "${e}" is already active.`);return}this.assertDependenciesMet(t.manifest),t.status="loading";try{const n=this.schemas;if(n&&typeof n.register=="function")for(const a of t.manifest.collections)n.register(a,t.manifest.id);for(const a of t.manifest.hooks)this.events.on(a.event,a.handler,a.priority??0);typeof t.manifest.activate=="function"&&await t.manifest.activate(),t.status="active",this.logger.info("modules",`Activated module: ${e}`),this.events.emit("module.activated",{moduleId:e,version:t.manifest.version})}catch(n){throw t.status="error",this.logger.error("modules",`Failed to activate module: ${e}`,n),this.events.emit("module.error",{moduleId:e,version:t.manifest.version,error:n instanceof Error?n:new Error(String(n))}),n}}async disable(e){const t=this.modules.get(e);if(!t)throw new Error(`Cannot disable unknown module: ${e}`);if(t.status==="disabled"){this.logger.warn("modules",`Module "${e}" is already disabled.`);return}if(this.isCoreModule(e))throw new Error(`Cannot disable core module: ${e}`);const n=this.getActiveDependants(e);if(n.length>0)throw new Error(`Cannot disable module "${e}" because the following active modules depend on it: `+n.join(", "));try{typeof t.manifest.deactivate=="function"&&await t.manifest.deactivate(),t.status="disabled",this.logger.info("modules",`Deactivated module: ${e}`),this.events.emit("module.deactivated",{moduleId:e})}catch(a){throw t.status="error",this.logger.error("modules",`Failed to deactivate module: ${e}`,a),a}}isEnabled(e){return this.modules.get(e)?.status==="active"}getStatus(e){return this.modules.get(e)?.status}getAll(){return Array.from(this.modules.values()).map(e=>({manifest:e.manifest,status:e.status}))}getActive(){const e=[];for(const t of this.modules.values())t.status==="active"&&e.push(t.manifest);return e}get(e){return this.modules.get(e)?.manifest}getStore(){return this.store}resolveDependencyOrder(e){const t=new Set(e),n=new Map,a=new Map;for(const o of e){n.has(o)||n.set(o,0),a.has(o)||a.set(o,[]);const s=this.modules.get(o);if(s)for(const c of s.manifest.dependencies)t.has(c)&&(a.has(c)||a.set(c,[]),a.get(c).push(o),n.set(o,(n.get(o)??0)+1))}const r=[];for(const[o,s]of n)s===0&&r.push(o);const i=[];for(;r.length>0;){const o=r.shift();i.push(o);for(const s of a.get(o)??[]){const c=(n.get(s)??1)-1;n.set(s,c),c===0&&r.push(s)}}if(i.length!==e.length){const o=e.filter(s=>!i.includes(s));throw new Error(`Cyclic dependency detected among modules: ${o.join(", ")}`)}return i}async healthCheck(){const e=new Map;for(const[t,n]of this.modules)if(n.status==="active")try{for(const a of n.manifest.dependencies)if(!this.isEnabled(a)){e.set(t,{healthy:!1,message:`Dependency "${a}" is not active.`});continue}e.has(t)||e.set(t,{healthy:!0})}catch(a){e.set(t,{healthy:!1,message:a instanceof Error?a.message:String(a)})}return e}isCoreModule(e){return rt.has(e)}assertDependenciesMet(e){for(const t of e.dependencies){const n=this.modules.get(t);if(!n)throw new Error(`Module "${e.id}" depends on "${t}", which is not registered.`);if(n.status!=="active")throw new Error(`Module "${e.id}" depends on "${t}", which is not active (status: ${n.status}).`)}}getActiveDependants(e){const t=[];for(const[n,a]of this.modules)n!==e&&a.status==="active"&&a.manifest.dependencies.includes(e)&&t.push(n);return t}}function ot(l,e){const t=l.split("/").filter(Boolean);if(t.length===0)return[{label:"Home",path:"/",active:!0}];const n=[],a=K("/",e)!==null;n.push({label:a?K("/",e).title??"Home":"Home",path:"/",active:!1});let r="";for(let i=0;i<t.length;i++){r+="/"+t[i];const o=i===t.length-1,c=K(r,e)?.title??lt(t[i]);n.push({label:c,path:o?void 0:r,active:o})}return n}function K(l,e){for(const[,t]of e)if(t.pattern.test(l))return t;return null}function lt(l){return/^[0-9a-f-]+$/i.test(l)&&/\d/.test(l)?l:l.replace(/[-_]/g," ").replace(/\b\w/g,e=>e.toUpperCase())}class st{routes=new Map;currentRoute=null;previousRoute=null;navigationHistory=[];globalFilters={};events;modules;permissions;started=!1;hashChangeHandler;constructor(e,t,n){this.events=e,this.modules=t,this.permissions=n,this.hashChangeHandler=this.onHashChange.bind(this)}register(e){const{paramNames:t,regex:n}=this.compilePath(e.path),a=()=>{const i=e.component();return i instanceof Promise?i:Promise.resolve(i)},r={path:e.path,pattern:n,paramNames:t,component:a,title:e.title,icon:e.icon,guard:e.guard,meta:e.meta};this.routes.set(e.path,r)}start(){if(this.started)return;this.started=!0,window.addEventListener("hashchange",this.hashChangeHandler);const{path:e,query:t}=this.parseHash(window.location.hash);this.navigate(e||"/",t)}stop(){this.started&&(this.started=!1,window.removeEventListener("hashchange",this.hashChangeHandler))}async navigate(e,t){const n=this.matchRoute(e);if(!n){this.handleNotFound(e);return}const a={...this.globalFilters,...t},r={route:n.route,params:n.params,query:a},i={to:r,from:this.currentRoute,cancelled:!1};if(this.events.emit("navigation.before",i),i.cancelled)return;if(n.route.guard){const c=n.route.guard(r,this.currentRoute);if(c===!1)return;if(typeof c=="string"){this.navigate(c);return}}const o=n.route.meta?.moduleId;if(o){const c=this.permissions;if(typeof c.canAccessModule=="function"&&!c.canAccessModule(o)){this.events.emit("navigation.forbidden",{path:e,moduleId:o});return}}const s="#"+this.buildHash(e,a);window.location.hash!==s&&(window.removeEventListener("hashchange",this.hashChangeHandler),window.location.hash=s,queueMicrotask(()=>{this.started&&window.addEventListener("hashchange",this.hashChangeHandler)})),this.previousRoute=this.currentRoute,this.currentRoute=r,this.navigationHistory.push(r),n.route.title&&(document.title=`${n.route.title} | Concrete`),this.events.emit("navigation.after",{to:r,from:this.previousRoute})}back(){if(this.previousRoute){const e=this.previousRoute.route.path;this.navigate(e,this.previousRoute.query)}else window.history.back()}getCurrent(){return this.currentRoute}getModules(){return this.modules}getPrevious(){return this.previousRoute}getBreadcrumbs(){if(!this.currentRoute)return[];const e=this.resolveCurrentPath();return ot(e,this.routes)}getState(){return{currentRoute:this.currentRoute,history:[...this.navigationHistory],breadcrumbs:this.getBreadcrumbs()}}setGlobalFilter(e,t){this.globalFilters[e]=t,this.events.emit("navigation.filterChanged",{key:e,value:t,filters:{...this.globalFilters}})}removeGlobalFilter(e){delete this.globalFilters[e],this.events.emit("navigation.filterChanged",{key:e,value:void 0,filters:{...this.globalFilters}})}getGlobalFilters(){return{...this.globalFilters}}onHashChange(){const{path:e,query:t}=this.parseHash(window.location.hash);this.navigate(e||"/",t)}parseHash(e){let t=e.startsWith("#")?e.slice(1):e;t.startsWith("/")||(t="/"+t);const n=t.indexOf("?"),a=n>=0?t.slice(0,n):t,r=n>=0?t.slice(n+1):"",i={};return r&&new URLSearchParams(r).forEach((s,c)=>{i[c]=s}),{path:this.normalizePath(a),query:i}}buildHash(e,t){const n=this.normalizePath(e),a=Object.entries(t).filter(([,i])=>i!==void 0&&i!=="");if(a.length===0)return n;const r=new URLSearchParams(a).toString();return`${n}?${r}`}normalizePath(e){let t=e;return t.startsWith("/")||(t="/"+t),t.length>1&&t.endsWith("/")&&(t=t.slice(0,-1)),t}matchRoute(e){const t=this.normalizePath(e),n=[...this.routes.values()].sort((a,r)=>a.paramNames.length-r.paramNames.length);for(const a of n){const r=t.match(a.pattern);if(r){const i={};return a.paramNames.forEach((o,s)=>{i[o]=decodeURIComponent(r[s+1]??"")}),{route:a,params:i}}}return null}compilePath(e){const t=[],a=this.normalizePath(e).split("/").map(r=>r.startsWith(":")?(t.push(r.slice(1)),"([^/]+)"):r==="*"?(t.push("wildcard"),"(.*)"):r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("/");return{regex:new RegExp("^"+a+"$"),paramNames:t}}resolveCurrentPath(){if(!this.currentRoute)return"/";const e=this.currentRoute.route.path,t=this.currentRoute.params;return e.replace(/:([^/]+)/g,(n,a)=>t[a]??a)}handleNotFound(e){this.events.emit("navigation.notFound",{path:e});const t=this.routes.get("/*")??this.routes.get("*");if(t){const n={route:{path:t.path,pattern:t.pattern,component:t.component,title:t.title,icon:t.icon,guard:t.guard,meta:t.meta},params:{wildcard:e},query:{...this.globalFilters}};this.previousRoute=this.currentRoute,this.currentRoute=n,this.navigationHistory.push(n),this.events.emit("navigation.after",{to:n,from:this.previousRoute})}}}function M(l,e){if(l==="*"||l===e)return!0;if(l.includes("*")){const n="^"+l.replace(/[.+?^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*")+"$";return new RegExp(n).test(e)}return!1}class ct{currentUser=null;roles=new Map;segregationRules=[];_store;events;constructor(e,t){this._store=e,this.events=t,this.registerDefaultRoles()}get store(){return this._store}setUser(e){this.currentUser=e,this.events.emit("permissions.user.changed",{userId:e.userId})}clearUser(){this.currentUser=null,this.events.emit("permissions.user.cleared",{})}registerRole(e){this.roles.set(e.id,e)}unregisterRole(e){this.roles.delete(e)}getRole(e){return this.roles.get(e)}getAllRoles(){return Array.from(this.roles.values())}addSegregationRule(e){this.segregationRules.push(e)}can(e,t,n){if(!this.currentUser)return{allowed:!0};if(!this.getEffectivePermissions().some(o=>M(o.resource,t)&&(o.action===e||o.action==="admin")))return{allowed:!1,reason:`Missing permission: ${e} on ${t}`};const i=this.checkSegregation(e,t,n);return i?{allowed:!1,reason:i}:{allowed:!0}}canDo(e,t){return this.can(e,t).allowed}canAccessEntity(e){return!this.currentUser||!this.currentUser.entityScope||this.currentUser.entityScope.length===0?!0:this.currentUser.entityScope.includes(e)}canSeeField(e,t){if(!this.currentUser)return"full";const n=this.currentUser.roles.map(r=>this.roles.get(r)).filter(Boolean);let a="full";for(const r of n){if(!r.fieldRestrictions)continue;const i=r.fieldRestrictions.find(o=>o.collection===e&&o.field===t);if(i){if(i.access==="hidden")return"hidden";i.access==="readonly"&&(a="readonly")}}return a}canAccessModule(e){return this.can("read",e).allowed}filterEntities(e){return e.filter(t=>this.canAccessEntity(t))}applyFieldRestrictions(e,t){const n={};for(const[a,r]of Object.entries(t))this.canSeeField(e,a)!=="hidden"&&(n[a]=r);return n}getCurrentUser(){return this.currentUser}getEffectivePermissions(){if(!this.currentUser)return[];const e=[...this.currentUser.directPermissions??[]];for(const t of this.currentUser.roles){const n=this.roles.get(t);n&&e.push(...n.permissions)}return e}checkSegregation(e,t,n){if(!this.currentUser||this.segregationRules.length===0)return null;const a=this.getEffectivePermissions();for(const r of this.segregationRules){if(!M(r.resource,t)||!r.actions.includes(e))continue;const i=r.actions.filter(o=>o!==e);for(const o of i)if(a.some(c=>M(c.resource,t)&&(c.action===o||c.action==="admin")))return`Segregation of duties violation: user cannot hold both "${e}" and "${o}" on "${t}"`}return null}registerDefaultRoles(){this.registerRole({id:"admin",name:"Administrator",description:"Full system access",permissions:[{resource:"*",action:"admin"}]}),this.registerRole({id:"controller",name:"Financial Controller",description:"Full financial access, module management",permissions:[{resource:"gl/*",action:"admin"},{resource:"job/*",action:"admin"},{resource:"ap/*",action:"admin"},{resource:"ar/*",action:"admin"},{resource:"payroll/*",action:"read"},{resource:"payroll/*",action:"approve"}]}),this.registerRole({id:"project_manager",name:"Project Manager",description:"Job and project management",permissions:[{resource:"job/*",action:"read"},{resource:"job/*",action:"update"},{resource:"sub/*",action:"read"},{resource:"sub/*",action:"update"},{resource:"proj/*",action:"admin"},{resource:"doc/*",action:"admin"}]}),this.registerRole({id:"ap_clerk",name:"AP Clerk",description:"Accounts payable data entry",permissions:[{resource:"ap/*",action:"create"},{resource:"ap/*",action:"read"},{resource:"ap/*",action:"update"}]}),this.registerRole({id:"ar_clerk",name:"AR Clerk",description:"Accounts receivable and billing",permissions:[{resource:"ar/*",action:"create"},{resource:"ar/*",action:"read"},{resource:"ar/*",action:"update"}]}),this.registerRole({id:"payroll_admin",name:"Payroll Administrator",description:"Full payroll access",permissions:[{resource:"payroll/*",action:"admin"},{resource:"union/*",action:"admin"}],fieldRestrictions:[]}),this.registerRole({id:"payroll_clerk",name:"Payroll Clerk",description:"Payroll data entry and time processing",permissions:[{resource:"payroll/timeEntry",action:"create"},{resource:"payroll/timeEntry",action:"read"},{resource:"payroll/timeEntry",action:"update"},{resource:"payroll/employee",action:"read"},{resource:"payroll/check",action:"read"},{resource:"union/rate",action:"read"}],fieldRestrictions:[{collection:"payroll/employee",field:"ssn",access:"hidden"},{collection:"payroll/employee",field:"salary",access:"hidden"}]}),this.registerRole({id:"estimator",name:"Estimator",description:"Estimating and bidding",permissions:[{resource:"job/estimate",action:"admin"},{resource:"job/bid",action:"admin"},{resource:"job/costCode",action:"read"},{resource:"sub/prequalification",action:"read"}]}),this.registerRole({id:"foreman",name:"Field Foreman",description:"Field operations",permissions:[{resource:"payroll/timeEntry",action:"create"},{resource:"payroll/timeEntry",action:"read"},{resource:"proj/dailyLog",action:"create"},{resource:"proj/dailyLog",action:"read"},{resource:"safety/*",action:"create"},{resource:"safety/*",action:"read"},{resource:"equip/usage",action:"create"}]}),this.registerRole({id:"technician",name:"Field Technician",description:"Equipment operation and maintenance logging",permissions:[{resource:"equip/usage",action:"create"},{resource:"equip/usage",action:"read"},{resource:"equip/maintenance",action:"create"},{resource:"equip/maintenance",action:"read"},{resource:"safety/incident",action:"create"},{resource:"safety/incident",action:"read"}]}),this.registerRole({id:"readonly",name:"Read Only",description:"View-only access to all data",permissions:[{resource:"*",action:"read"}]})}}const U={critical:0,"action-required":1,warning:2,info:3,success:4};class dt{notifications=[];rules=[];preferences=new Map;events;_config;toastQueue=[];constructor(e,t){this.events=e,this._config=t}get config(){return this._config}notify(e){const t={id:x(),createdAt:g(),updatedAt:g(),version:1,type:e.type,title:e.title,message:e.message,source:e.source??"system",entityId:e.entityId,link:e.link,read:!1,acknowledged:!1,channel:e.channel??"panel"};return this.notifications.push(t),this.events.emit("notification.created",t),(e.type==="critical"||e.type==="action-required")&&(this.toastQueue.push(t),this.events.emit("toast.show",{id:t.id,type:e.type,title:e.title,message:e.message})),t}getAll(e){let t=[...this.notifications];return e?.unreadOnly&&(t=t.filter(n=>!n.read)),e?.type&&(t=t.filter(n=>n.type===e.type)),e?.source&&(t=t.filter(n=>n.source===e.source)),t.sort((n,a)=>{const r=U[n.type]??99,i=U[a.type]??99;return r!==i?r-i:a.createdAt.localeCompare(n.createdAt)}),e?.limit&&e.limit>0&&(t=t.slice(0,e.limit)),t}getUnreadCount(){return this.notifications.filter(e=>!e.read).length}getUnreadCountByType(){const e={critical:0,"action-required":0,warning:0,info:0,success:0};for(const t of this.notifications)t.read||(e[t.type]+=1);return e}getById(e){return this.notifications.find(t=>t.id===e)}markRead(e){const t=this.notifications.find(n=>n.id===e);t&&!t.read&&(t.read=!0,t.updatedAt=g(),t.version+=1,this.events.emit("notification.read",{id:e}))}markAllRead(){let e=!1;for(const t of this.notifications)t.read||(t.read=!0,t.updatedAt=g(),t.version+=1,e=!0);e&&this.events.emit("notification.allRead",{})}acknowledge(e){const t=this.notifications.find(n=>n.id===e);t&&!t.acknowledged&&(t.acknowledged=!0,t.read=!0,t.updatedAt=g(),t.version+=1,this.events.emit("notification.acknowledged",{id:e}))}snooze(e,t){const n=this.notifications.find(a=>a.id===e);n&&(n.snoozedUntil=t,n.read=!0,n.updatedAt=g(),n.version+=1,this.events.emit("notification.snoozed",{id:e,until:t}))}remove(e){const t=this.notifications.findIndex(n=>n.id===e);t!==-1&&(this.notifications.splice(t,1),this.events.emit("notification.removed",{id:e}))}clear(){this.notifications=[],this.toastQueue=[],this.events.emit("notification.cleared",{})}dequeueToast(){return this.toastQueue.shift()}peekToastQueue(){return this.toastQueue}addRule(e){const t=this.rules.findIndex(n=>n.id===e.id);t!==-1?this.rules[t]=e:this.rules.push(e),this.events.emit("alertRule.added",{id:e.id})}removeRule(e){const t=this.rules.findIndex(n=>n.id===e);t!==-1&&(this.rules.splice(t,1),this.events.emit("alertRule.removed",{id:e}))}toggleRule(e,t){const n=this.rules.find(a=>a.id===e);n&&(n.enabled=t)}getRules(){return[...this.rules]}evaluateRules(e,t){const n=[];for(const a of this.rules){if(!a.enabled||a.collection!==e)continue;const r=t[a.field];if(r==null)continue;let i=!1;switch(a.operator){case"<":i=typeof r=="number"&&typeof a.value=="number"&&r<a.value;break;case"<=":i=typeof r=="number"&&typeof a.value=="number"&&r<=a.value;break;case">":i=typeof r=="number"&&typeof a.value=="number"&&r>a.value;break;case">=":i=typeof r=="number"&&typeof a.value=="number"&&r>=a.value;break;case"=":i=r===a.value;break;case"!=":i=r!==a.value;break;case"contains":i=typeof r=="string"&&typeof a.value=="string"&&r.includes(a.value);break;case"not_contains":i=typeof r=="string"&&typeof a.value=="string"&&!r.includes(a.value);break}if(i){const o=this.notify({type:a.notificationType,title:a.name,message:`${a.field} is ${a.operator} ${String(a.value)} (current: ${String(r)})`,source:"alert-rule",entityId:t.id??void 0});n.push(o)}}return n}setPreference(e){const t=`${e.userId}::${e.notificationType}`;this.preferences.set(t,e)}getPreference(e,t){const n=`${e}::${t}`;return this.preferences.get(n)}getUserPreferences(e){const t=[];for(const n of this.preferences.values())n.userId===e&&t.push(n);return t}shouldDeliver(e,t,n){const a=this.getPreference(e,t);return a?a.enabled?a.channels.includes(n):!1:!0}}const ut=new Set(["a","an","the","and","or","but","in","on","at","to","for","of","with","by","from","is","it","as","be","was","are","were","been","has","had","have","do","does","did","will","would","could","should","may","might","can","this","that","these","those","not","no","if","so","up","out","then"]);class mt{index;titleCache;subtitleCache;dataCache;store;schemas;constructor(e,t){this.index=new Map,this.titleCache=new Map,this.subtitleCache=new Map,this.dataCache=new Map,this.store=e,this.schemas=t}async buildIndex(){this.index.clear(),this.titleCache.clear(),this.subtitleCache.clear(),this.dataCache.clear();const e=this.schemas.getAll();for(const t of e){const n=t.collection,a=t.fields.filter(i=>i.type==="string"||i.type==="id").map(i=>i.name);if(a.length===0)continue;let r;try{r=await this.store.getAll(n)}catch{continue}for(const i of r){if(i.deletedAt!=null)continue;const o=i.id;if(!o)continue;const s=`${n}:${o}`;this.dataCache.set(s,i);const c=i.name??i.title??i.description??i.number??o;this.titleCache.set(s,String(c));const y=[];i.number&&i.name&&y.push(String(i.number)),i.status&&y.push(String(i.status)),y.length>0&&this.subtitleCache.set(s,y.join(" | "));for(const b of a){const u=i[b];if(typeof u!="string"||u.length===0)continue;const m=this.tokenize(u);for(const d of m){const p=this.index.get(d),v={collection:n,id:o,field:b};p?p.push(v):this.index.set(d,[v])}}}}}updateRecord(e,t){const n=t.id;if(!n||(this.removeRecord(e,n),t.deletedAt!=null))return;const a=`${e}:${n}`;this.dataCache.set(a,t);const r=t.name??t.title??t.description??t.number??n;this.titleCache.set(a,String(r));const i=[];t.number&&t.name&&i.push(String(t.number)),t.status&&i.push(String(t.status)),i.length>0&&this.subtitleCache.set(a,i.join(" | "));const o=this.schemas.get(e),s=o?o.fields.filter(c=>c.type==="string"||c.type==="id").map(c=>c.name):Object.keys(t).filter(c=>typeof t[c]=="string");for(const c of s){const y=t[c];if(typeof y!="string"||y.length===0)continue;const b=this.tokenize(y);for(const u of b){const m=this.index.get(u),d={collection:e,id:n,field:c};m?m.push(d):this.index.set(u,[d])}}}removeRecord(e,t){const n=`${e}:${t}`;this.titleCache.delete(n),this.subtitleCache.delete(n),this.dataCache.delete(n);for(const[a,r]of this.index){const i=r.filter(o=>!(o.collection===e&&o.id===t));i.length===0?this.index.delete(a):i.length!==r.length&&this.index.set(a,i)}}search(e,t){if(!e||e.trim().length===0)return[];const n=this.tokenize(e);if(n.length===0)return[];const a=t?.limit??50,r=t?.fuzzy??!0,i=t?.collections?new Set(t.collections):null,o=new Map,s=new Map;for(const u of n){const m=new Set;for(const[d,p]of this.index){const v=this.scoreMatch(u,d,r);if(v!==0)for(const A of p){if(i&&!i.has(A.collection))continue;const D=`${A.collection}:${A.id}`;m.add(D);const w=o.get(D)??0;o.set(D,w+v)}}s.set(u,m)}const c=[...s.values()];if(c.length===0)return[];let y=c[0];for(let u=1;u<c.length;u++){const m=c[u],d=new Set;for(const p of y)m.has(p)&&d.add(p);y=d}const b=[];for(const u of y){const m=o.get(u)??0,[d,p]=this.splitCacheKey(u);b.push({id:p,collection:d,title:this.titleCache.get(u)??p,subtitle:this.subtitleCache.get(u),score:m,data:this.dataCache.get(u)})}return b.sort((u,m)=>m.score-u.score),b.slice(0,a)}tokenize(e){return e.toLowerCase().split(/[\s,.\-_/\\|;:!?'"()\[\]{}#@&*+=<>~`]+/).filter(a=>a.length>0&&a.length<=100&&!ut.has(a))}scoreMatch(e,t,n){if(e===t)return 100;if(t.startsWith(e))return 80;if(t.includes(e))return 60;if(n&&e.length>=3&&t.length>=3){const a=this.levenshtein(e,t),r=Math.max(e.length,t.length),i=1-a/r;if(i>=.7)return Math.round(40*i)}return 0}levenshtein(e,t){const n=e.length,a=t.length,r=new Array(a+1),i=new Array(a+1);for(let o=0;o<=a;o++)r[o]=o;for(let o=1;o<=n;o++){i[0]=o;for(let s=1;s<=a;s++){const c=e[o-1]===t[s-1]?0:1;i[s]=Math.min(r[s]+1,i[s-1]+1,r[s-1]+c)}for(let s=0;s<=a;s++)r[s]=i[s]}return r[a]}splitCacheKey(e){const t=e.indexOf(":");return t===-1?[e,""]:[e.substring(0,t),e.substring(t+1)]}}class pt{shortcuts=new Map;customBindings=new Map;activeScope="global";installed=!1;bindingsStorageKey="concrete_keybindings";keydownHandler;constructor(){this.keydownHandler=this.onKeydown.bind(this),this.loadCustomBindings()}install(){this.installed||(this.installed=!0,document.addEventListener("keydown",this.keydownHandler))}uninstall(){this.installed&&(this.installed=!1,document.removeEventListener("keydown",this.keydownHandler))}register(e){const t={...e,scope:e.scope??"global",enabled:e.enabled??!0},n=this.customBindings.get(e.id);n&&(t.keys=n),this.shortcuts.set(e.id,t)}unregister(e){this.shortcuts.delete(e)}setScope(e){this.activeScope=e}getScope(){return this.activeScope}getAll(){return[...this.shortcuts.values()]}getByScope(e){return[...this.shortcuts.values()].filter(t=>t.scope===e)}rebind(e,t){const n=this.shortcuts.get(e);n&&(n.keys=t),this.customBindings.set(e,t),this.persistCustomBindings()}resetBinding(e){this.customBindings.delete(e),this.persistCustomBindings()}registerDefaults(){this.register({id:"global.commandPalette",keys:"ctrl+k",description:"Open command palette",scope:"global",handler:e=>{e.preventDefault(),document.dispatchEvent(new CustomEvent("concrete:command-palette",{detail:{action:"toggle"}}))}}),this.register({id:"global.undo",keys:"ctrl+z",description:"Undo last action",scope:"global",handler:e=>{const t=e.target;this.isEditableElement(t)||(e.preventDefault(),document.dispatchEvent(new CustomEvent("concrete:undo")))}}),this.register({id:"global.redo",keys:"ctrl+shift+z",description:"Redo last undone action",scope:"global",handler:e=>{const t=e.target;this.isEditableElement(t)||(e.preventDefault(),document.dispatchEvent(new CustomEvent("concrete:redo")))}}),this.register({id:"global.save",keys:"ctrl+s",description:"Save current form",scope:"global",handler:e=>{e.preventDefault(),document.dispatchEvent(new CustomEvent("concrete:save"))}}),this.register({id:"global.escape",keys:"escape",description:"Close modal or dismiss",scope:"global",handler:e=>{document.dispatchEvent(new CustomEvent("concrete:escape"))}}),this.register({id:"global.help",keys:"shift+/",description:"Show keyboard shortcuts help",scope:"global",handler:e=>{const t=e.target;this.isEditableElement(t)||(e.preventDefault(),document.dispatchEvent(new CustomEvent("concrete:shortcuts-help")))}})}onKeydown(e){const t=this.parseEvent(e);for(const n of this.shortcuts.values()){if(!n.enabled||n.scope!=="global"&&n.scope!==this.activeScope)continue;const a=this.normalizeKeys(n.keys);if(t===a){n.handler(e);return}}}parseEvent(e){const t=[];(e.ctrlKey||e.metaKey)&&t.push("ctrl"),e.altKey&&t.push("alt"),e.shiftKey&&t.push("shift");let n=e.key.toLowerCase();return n={escape:"escape",esc:"escape",enter:"enter",return:"enter",backspace:"backspace",delete:"delete",tab:"tab",arrowup:"up",arrowdown:"down",arrowleft:"left",arrowright:"right"," ":"space","/":"/"}[n]??n,["control","alt","shift","meta"].includes(n)||t.push(n),t.join("+")}normalizeKeys(e){const t=e.toLowerCase().split("+").map(r=>r.trim()),n=[];let a="";for(const r of t)["ctrl","cmd","meta","control"].includes(r)?n.push("ctrl"):r==="alt"||r==="option"?n.push("alt"):r==="shift"?n.push("shift"):a=r;return n.sort(),a&&n.push(a),n.join("+")}isEditableElement(e){const t=e.tagName.toLowerCase();return!!(t==="input"||t==="textarea"||t==="select"||e.isContentEditable)}loadCustomBindings(){try{if(typeof localStorage>"u")return;const e=localStorage.getItem(this.bindingsStorageKey);if(e){const t=JSON.parse(e);if(t&&typeof t=="object")for(const[n,a]of Object.entries(t))this.customBindings.set(n,a)}}catch{}}persistCustomBindings(){try{if(typeof localStorage>"u")return;const e={};for(const[t,n]of this.customBindings)e[t]=n;localStorage.setItem(this.bindingsStorageKey,JSON.stringify(e))}catch{}}}const yt=(l,e,t)=>{const n=l[e];return n?typeof n=="function"?n():Promise.resolve(n):new Promise((a,r)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(r.bind(null,new Error("Unknown variable dynamic import: "+e+(e.split("/").length!==t?". Note that variables only represent file names one level deep.":""))))})};class bt{translations={};fallback={};locale="en-US";storageKey="concrete_locale";constructor(){this.restoreLocale()}async load(e){if(Object.keys(this.fallback).length===0)try{const t=await L(()=>import("./en-US-CtoLYdsg.js"),[],import.meta.url);this.fallback=this.flattenTranslations(t.default??t)}catch{}if(e==="en-US")this.translations={...this.fallback};else try{const t=await yt(Object.assign({"../../locales/en-US.json":()=>L(()=>import("./en-US-CtoLYdsg.js"),[],import.meta.url)}),`../../locales/${e}.json`,4);this.translations=this.flattenTranslations(t.default??t)}catch{this.translations={...this.fallback}}this.locale=e,this.persistLocale()}t(e,t){let n=this.translations[e]??this.fallback[e]??e;if(t)for(const[a,r]of Object.entries(t))n=n.replace(new RegExp(`\\{\\{${a}\\}\\}`,"g"),String(r));return n}getLocale(){return this.locale}async setLocale(e){await this.load(e)}registerTranslations(e,t){for(const[n,a]of Object.entries(t)){const r=`${e}.${n}`;this.translations[r]=a,this.locale==="en-US"&&(this.fallback[r]=a)}}has(e){return e in this.translations||e in this.fallback}getKeys(){return[...new Set([...Object.keys(this.translations),...Object.keys(this.fallback)])].sort()}getTranslations(){return{...this.fallback,...this.translations}}flattenTranslations(e,t=""){const n={};for(const[a,r]of Object.entries(e)){const i=t?`${t}.${a}`:a;typeof r=="string"?n[i]=r:r!==null&&typeof r=="object"&&!Array.isArray(r)&&Object.assign(n,this.flattenTranslations(r,i))}return n}persistLocale(){try{if(typeof localStorage>"u")return;localStorage.setItem(this.storageKey,this.locale)}catch{}}restoreLocale(){try{if(typeof localStorage>"u")return;const e=localStorage.getItem(this.storageKey);e&&(this.locale=e)}catch{}}}class gt{undoStack=[];redoStack=[];maxHistory;store;events;constructor(e,t,n=100){this.store=e,this.events=t,this.maxHistory=n}async execute(e){await e.execute(),this.undoStack.push(e),this.undoStack.length>this.maxHistory&&this.undoStack.splice(0,this.undoStack.length-this.maxHistory),this.redoStack=[],this.events.emit("history.executed",{timestamp:g(),commandId:e.id,description:e.description})}async undo(){const e=this.undoStack.pop();return e?(await e.undo(),this.redoStack.push(e),this.events.emit("history.undone",{timestamp:g(),commandId:e.id,description:e.description}),e):null}async redo(){const e=this.redoStack.pop();return e?(await e.execute(),this.undoStack.push(e),this.events.emit("history.redone",{timestamp:g(),commandId:e.id,description:e.description}),e):null}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}getUndoStack(){return this.undoStack.map(e=>({id:e.id,description:e.description,timestamp:e.timestamp}))}getRedoStack(){return this.redoStack.map(e=>({id:e.id,description:e.description,timestamp:e.timestamp}))}createInsertCommand(e,t){const n=this.store,a=t.id??x(),r={...t,id:a};return{id:x(),description:`Insert into ${e}`,timestamp:Date.now(),async execute(){await n.insert(e,r)},async undo(){await n.remove(e,a)}}}createUpdateCommand(e,t,n,a){const r=this.store,i={},o={};for(const s of Object.keys(a))a[s]!==n[s]&&(i[s]=a[s],o[s]=n[s]);return{id:x(),description:`Update ${e}/${t}`,timestamp:Date.now(),async execute(){await r.update(e,t,i)},async undo(){await r.update(e,t,o)}}}createDeleteCommand(e,t){const n=this.store,a=t.id,r={...t};return{id:x(),description:`Delete from ${e}/${a}`,timestamp:Date.now(),async execute(){await n.remove(e,a)},async undo(){await n.insert(e,r)}}}createBatchCommand(e,t){return{id:x(),description:e,timestamp:Date.now(),async execute(){for(const n of t)await n.execute()},async undo(){for(let n=t.length-1;n>=0;n--)await t[n].undo()}}}clear(){this.undoStack=[],this.redoStack=[],this.events.emit("history.cleared",{timestamp:g()})}}class ft{static async register(){if(!("serviceWorker"in navigator))return null;try{const e=await navigator.serviceWorker.register("/sw.js",{scope:"/"});return e.addEventListener("updatefound",()=>{const t=e.installing;t&&t.addEventListener("statechange",()=>{t.state==="activated"&&console.info("Concrete updated. Refresh for new version.")})}),e}catch(e){return console.warn("Service worker registration failed:",e),null}}static async unregister(){if(!("serviceWorker"in navigator))return;const e=await navigator.serviceWorker.getRegistrations();for(const t of e)await t.unregister()}static isOffline(){return!navigator.onLine}static onConnectivityChange(e){const t=()=>e(!0),n=()=>e(!1);return window.addEventListener("online",t),window.addEventListener("offline",n),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",n)}}}class ht{rootEl=null;topNav=null;contentArea=null;alertsPanel=null;modalLayer=null;mount(e){this.rootEl=e,e.innerHTML="",e.className="flex flex-col min-h-screen bg-[var(--surface)]",this.topNav=this.createTopNav(),e.appendChild(this.topNav),this.contentArea=document.createElement("main"),this.contentArea.id="content",this.contentArea.className="flex-1 overflow-auto p-4 lg:p-6",e.appendChild(this.contentArea),this.alertsPanel=this.createAlertsPanel(),e.appendChild(this.alertsPanel),this.modalLayer=document.createElement("div"),this.modalLayer.id="modal-layer",this.modalLayer.className="fixed inset-0 z-50 hidden",e.appendChild(this.modalLayer);const t=this.topNav.querySelector("#alerts-btn");t&&t.addEventListener("click",()=>this.toggleAlerts());const n=this.alertsPanel.querySelector("#close-alerts");n&&n.addEventListener("click",()=>this.toggleAlerts(!1))}getRoot(){return this.rootEl}getContentArea(){return this.contentArea}getModalLayer(){return this.modalLayer}getAlertsPanel(){return this.alertsPanel}getTopNav(){return this.topNav}createTopNav(){const e=document.createElement("nav");e.className="flex items-center gap-4 px-4 h-14 bg-[var(--surface-raised)] border-b border-[var(--border)] sticky top-0 z-40";const t=document.createElement("div");t.className="font-bold text-lg tracking-tight text-[var(--accent)] flex-shrink-0",t.textContent="Concrete",e.appendChild(t);const n=document.createElement("div");n.id="nav-tabs",n.className="flex items-center gap-1 overflow-x-auto flex-1 px-2",e.appendChild(n);const a=document.createElement("div");a.id="global-filters",a.className="flex items-center gap-2 flex-shrink-0",e.appendChild(a);const r=document.createElement("button");r.id="alerts-btn",r.className="btn-ghost relative p-2 rounded-md",r.setAttribute("aria-label","Notifications"),r.innerHTML='<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg>',e.appendChild(r);const i=document.createElement("button");return i.id="cmd-palette-btn",i.className="btn-ghost p-2 rounded-md text-xs",i.setAttribute("aria-label","Command palette"),i.innerHTML='<kbd class="px-1.5 py-0.5 bg-[var(--surface)] rounded text-2xs border border-[var(--border)]">K</kbd>',e.appendChild(i),e}createAlertsPanel(){const e=document.createElement("div");e.id="alerts-panel",e.className="fixed right-0 top-14 bottom-0 w-80 bg-[var(--surface-raised)] border-l border-[var(--border)] transform translate-x-full transition-transform z-30 overflow-y-auto";const t=document.createElement("div");t.className="flex items-center justify-between p-4 border-b border-[var(--border)]",t.innerHTML='<h2 class="font-semibold">Notifications</h2><button class="btn-ghost p-1 rounded" id="close-alerts">&times;</button>',e.appendChild(t);const n=document.createElement("div");return n.id="alerts-content",n.className="p-4 space-y-3",e.appendChild(n),e}toggleAlerts(e){if(!this.alertsPanel)return;const t=this.alertsPanel.classList.contains("translate-x-full"),n=e??t;this.alertsPanel.classList.toggle("translate-x-full",!n),this.alertsPanel.classList.toggle("translate-x-0",n)}}let P;async function J(){const l=new k,e=new pe(l);e.install(),l.info("app","Concrete booting...");try{const t=new ge,n=new fe,a=new ye(n),r=new be(a);await a.load(),l.info("app",`Environment: ${t.mode}, Build: ${t.buildTarget}`);const i=new at;i.registerCoreSchemas();const o=new Se(i,n,l);await o.initialize();const s=new bt;await s.load(a.get("locale","en-US"));const c=new ct(o.getAdapter(),n),y=new dt(n,a),b=new mt(o.getAdapter(),i),u=new gt(o.getAdapter(),n),m=new pt,d=new it(n,o,i,l);d.register(V),d.register(W),d.register(G),d.register(Q),d.register(Y),d.register(Z),d.register(X),d.register(ee),d.register(te),d.register(ne),d.register(ae),d.register(re),d.register(ie),d.register(oe),d.register(le),d.register(se),d.register(ce),d.register(de),d.register(ue),d.register(me);const p=new st(n,d,c);for(const w of d.getAll())for(const h of w.manifest.routes)p.register({path:h.path,component:h.component,title:h.title,icon:h.icon});p.register({path:"/",component:()=>Promise.resolve(null),title:"Home",meta:{redirect:"/gl"}});const v=new ht;P={logger:l,errorBoundary:e,config:a,features:r,env:t,events:n,store:o,schemas:i,modules:d,router:p,permissions:c,notifications:y,search:b,keyboard:m,i18n:s,undo:u,shell:v},t.isDev&&(window.concrete=P),n.emit("app.boot",{app:P}),t.isProd&&ft.register().catch(w=>{l.warn("sw","Service worker registration failed",w)});const A=document.getElementById("app");A&&v.mount(A);const D=document.getElementById("nav-tabs");if(D){const w=d.getAll().flatMap(f=>f.manifest.navItems).filter(f=>!f.parent).sort((f,q)=>f.order-q.order);for(const f of w){const q=document.createElement("a");q.href=`#${f.path}`,q.className="px-3 py-1.5 rounded-md text-sm font-medium text-[var(--text-muted)] hover:text-[var(--text)] hover:bg-[var(--surface)] transition-colors whitespace-nowrap",q.dataset.navId=f.id,q.textContent=f.label,D.appendChild(q)}const h=document.createElement("div");h.id="sub-nav",h.className="flex items-center gap-1 px-4 py-1.5 bg-[var(--surface)] border-b border-[var(--border)] text-sm overflow-x-auto",h.style.display="none",v.getTopNav()?.insertAdjacentElement("afterend",h)}n.on("navigation.after",async w=>{const{to:h}=w;if(h.route.meta?.redirect){p.navigate(h.route.meta.redirect);return}const f=v.getContentArea();if(!f)return;f.innerHTML='<div class="flex items-center justify-center h-64"><div class="text-[var(--text-muted)]">Loading...</div></div>';try{const S=await h.route.component();S?.default?.render?(f.innerHTML="",S.default.render(f)):f.innerHTML='<div class="p-4 text-[var(--text-muted)]">View not found.</div>'}catch(I){l.error("router","Failed to load view",I),f.innerHTML=`<div class="p-4 text-[var(--negative)]">Failed to load view: ${I instanceof Error?I.message:String(I)}</div>`}const q=document.getElementById("nav-tabs");if(q){const I=h.route.path;for(const S of q.querySelectorAll("a[data-nav-id]")){const N=S.getAttribute("href")?.slice(1)||"",T=I.startsWith(N);S.className=T?"px-3 py-1.5 rounded-md text-sm font-medium text-[var(--accent)] bg-[var(--accent)]/10 whitespace-nowrap":"px-3 py-1.5 rounded-md text-sm font-medium text-[var(--text-muted)] hover:text-[var(--text)] hover:bg-[var(--surface)] transition-colors whitespace-nowrap"}}const _=document.getElementById("sub-nav");if(_){const I=h.route.path,S=d.getAll().flatMap(T=>T.manifest.navItems),N=S.find(T=>!T.parent&&I.startsWith(T.path));if(N){const T=S.filter(C=>C.parent===N.id).sort((C,E)=>C.order-E.order);if(T.length>0){_.innerHTML="",_.style.display="flex";for(const C of T){const E=document.createElement("a");E.href=`#${C.path}`;const z=I===C.path||I.startsWith(C.path+"/");E.className=z?"px-2.5 py-1 rounded text-xs font-medium text-[var(--accent)] bg-[var(--accent)]/10 whitespace-nowrap":"px-2.5 py-1 rounded text-xs text-[var(--text-muted)] hover:text-[var(--text)] hover:bg-[var(--surface-raised)] whitespace-nowrap",E.textContent=C.label,_.appendChild(E)}}else _.style.display="none"}else _.style.display="none"}}),p.start(),n.emit("app.ready",{app:P}),l.info("app","Concrete ready")}catch(t){l.fatal("app","Boot failed",t),e.showFatalError(t)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>void J()):J();export{R as a,ve as b,j as g};
